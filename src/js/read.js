var Cassis=function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(i,r,function(t){return e[t]}.bind(null,r));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}({"./node_modules/uuid/index.js":function(e,t,n){var i=n("./node_modules/uuid/v1.js"),r=n("./node_modules/uuid/v4.js"),o=r;o.v1=i,o.v4=r,e.exports=o},"./node_modules/uuid/lib/bytesToUuid.js":function(e){function t(e,t){var i=t||0,r=n;return[r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]]].join("")}for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);e.exports=t},"./node_modules/uuid/lib/rng-browser.js":function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},"./node_modules/uuid/v1.js":function(e,t,n){function i(e,t,n){var i=t&&n||0,u=t||[];e=e||{};var h=e.node||r,d=e.clockseq!==undefined?e.clockseq:o;if(null==h||null==d){var f=s();null==h&&(h=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==d&&(d=o=16383&(f[6]<<8|f[7]))}var p=e.msecs!==undefined?e.msecs:(new Date).getTime(),g=e.nsecs!==undefined?e.nsecs:c+1,b=p-l+(g-c)/1e4;if(b<0&&e.clockseq===undefined&&(d=d+1&16383),(b<0||p>l)&&e.nsecs===undefined&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=p,c=g,o=d,p+=122192928e5;var m=(1e4*(268435455&p)+g)%4294967296;u[i++]=m>>>24&255,u[i++]=m>>>16&255,u[i++]=m>>>8&255,u[i++]=255&m;var v=p/4294967296*1e4&268435455;u[i++]=v>>>8&255,u[i++]=255&v,u[i++]=v>>>24&15|16,u[i++]=v>>>16&255,u[i++]=d>>>8|128,u[i++]=255&d;for(var y=0;y<6;++y)u[i+y]=h[y];return t||a(u)}var r,o,s=n("./node_modules/uuid/lib/rng-browser.js"),a=n("./node_modules/uuid/lib/bytesToUuid.js"),l=0,c=0;e.exports=i},"./node_modules/uuid/v4.js":function(e,t,n){function i(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null),e=e||{};var s=e.random||(e.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[i+a]=s[a];return t||o(s)}var r=n("./node_modules/uuid/lib/rng-browser.js"),o=n("./node_modules/uuid/lib/bytesToUuid.js");e.exports=i},"./node_modules/whatwg-fetch/fetch.js":function(){!function(e){"use strict";function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function n(e){return"string"!=typeof e&&(e=String(e)),e}function i(e){var t={next:function(){var t=e.shift();return{done:t===undefined,value:t}}};return m.iterable&&(t[Symbol.iterator]=function(){return t}),t}function r(e){this.map={},e instanceof r?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function o(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function s(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function a(e){var t=new FileReader,n=s(t);return t.readAsArrayBuffer(e),n}function l(e){var t=new FileReader,n=s(t);return t.readAsText(e),n}function c(e){for(var t=new Uint8Array(e),n=new Array(t.length),i=0;i<t.length;i++)n[i]=String.fromCharCode(t[i]);return n.join("")}function u(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function h(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(m.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(m.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(m.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(m.arrayBuffer&&m.blob&&y(e))this._bodyArrayBuffer=u(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!m.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!k(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=u(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):m.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},m.blob&&(this.blob=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return l(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(c(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},m.formData&&(this.formData=function(){return this.text().then(p)}),this.json=function(){return this.text().then(JSON.parse)},this}function d(e){var t=e.toUpperCase();return w.indexOf(t)>-1?t:e}function f(e,t){t=t||{};var n=t.body;if(e instanceof f){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new r(e.headers)),this.method=e.method,this.mode=e.mode,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new r(t.headers)),this.method=d(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function p(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),i=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(i),decodeURIComponent(r))}}),t}function g(e){var t=new r;return e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var n=e.split(":"),i=n.shift().trim();if(i){var r=n.join(":").trim();t.append(i,r)}}),t}function b(e,t){t||(t={}),this.type="default",this.status=t.status===undefined?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new r(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var m={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(m.arrayBuffer)var v=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],y=function(e){return e&&DataView.prototype.isPrototypeOf(e)},k=ArrayBuffer.isView||function(e){return e&&v.indexOf(Object.prototype.toString.call(e))>-1};r.prototype.append=function(e,i){e=t(e),i=n(i);var r=this.map[e];this.map[e]=r?r+","+i:i},r.prototype["delete"]=function(e){delete this.map[t(e)]},r.prototype.get=function(e){return e=t(e),this.has(e)?this.map[e]:null},r.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},r.prototype.set=function(e,i){this.map[t(e)]=n(i)},r.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},r.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),i(e)},r.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),i(e)},r.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),i(e)},m.iterable&&(r.prototype[Symbol.iterator]=r.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];f.prototype.clone=function(){return new f(this,{body:this._bodyInit})},h.call(f.prototype),h.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new r(this.headers),url:this.url})},b.error=function(){var e=new b(null,{status:0,statusText:""});return e.type="error",e};var E=[301,302,303,307,308];b.redirect=function(e,t){if(-1===E.indexOf(t))throw new RangeError("Invalid status code");return new b(null,{status:t,headers:{location:e}})},e.Headers=r,e.Request=f,e.Response=b,e.fetch=function(e,t){return new Promise(function(n,i){var r=new f(e,t),o=new XMLHttpRequest;o.onload=function(){var e={status:o.status,statusText:o.statusText,headers:g(o.getAllResponseHeaders()||"")};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var t="response"in o?o.response:o.responseText;n(new b(t,e))},o.onerror=function(){i(new TypeError("Network request failed"))},o.ontimeout=function(){i(new TypeError("Network request failed"))},o.open(r.method,r.url,!0),"include"===r.credentials?o.withCredentials=!0:"omit"===r.credentials&&(o.withCredentials=!1),"responseType"in o&&m.blob&&(o.responseType="blob"),r.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),o.send("undefined"==typeof r._bodyInit?null:r._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)},"./src/BookInfo.ts":function(e,t,n){var i,r,o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/Templates.ts"),n("./src/Locales.ts"),n("./src/HTMLUtilities.ts"),n("./src/Tracker/TrackerUtilities.ts")],(r=function(e,t,n,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=o(n),i=o(i),r=o(r),s=o(s);var a=function(){function e(e){this.buyButton=null,this.shareButton=null,this.title=e.title,this.author=e.author,this.publisher=e.publisher,this.isbn=e.isbn13,this.genre=e.genre,this.publicationDate=e.publication_date_string,this.buyLink=e.buy_link,this.buyLinkNav=e.buy_link_nav,this.buyLinks=e.buy_links,this.shareLink=e.share_link}return e.prototype.renderBookInfo=function(e,t){void 0===t&&(t="en");try{var o=[];o.push(n.bookInfoCloseButton);var s=n.bookInfoTemplate("bookinfo-title",this.title);if(o.push(s),this.author){var a=n.bookInfoTemplate("bookinfo-author",this.author);o.push(a)}var l=n.bookInfoTemplate("bookinfo-publisher",this.publisher,i.locales.bookInfoPublisher[t]);if(o.push(l),this.isbn){var c=n.bookInfoTemplate("bookinfo-isbn",this.isbn,i.locales.bookInfoIsbn[t]);o.push(c)}if(this.genre){var u=n.bookInfoTemplate("bookinfo-genre",this.genre,i.locales.bookInfoGenre[t]);o.push(u)}if(this.publicationDate){var h=n.bookInfoTemplate("bookinfo-date",this.publicationDate,i.locales.bookInfoDate[t]);o.push(h)}if(this.buyLink){var d=n.bookInfoBuyButton("bookinfo-buy","buy-button",this.buyLink,i.locales.bookInfoBuy[t]);o.push(d)}if(this.shareLink){var f=n.bookInfoShareButton("bookinfo-share","share-button",i.locales.bookInfoShare[t]);o.push(f)}return e.innerHTML+=n.bookInfoWrapperTemplate(o.join("")),this.buyLink&&(this.buyButton=r.findRequiredElement(e,'a[class="buy-button"]')),this.shareLink&&(this.shareButton=r.findRequiredElement(e,'button[class="share-button"]')),this.closeButton=r.findRequiredElement(e,'button[class="bookinfo-close"]'),new Promise(function(e){return e()})}catch(e){return new Promise(function(t,n){return n(e)})["catch"](function(){})}},e.prototype.getBuyLinkNav=function(){return this.buyLinkNav},e.prototype.getBuyLinks=function(){return this.buyLinks},e.prototype.getBuyButton=function(){return this.buyButton},e.prototype.getShareButton=function(){return this.shareButton},e.prototype.getCloseButton=function(){return this.closeButton},e.prototype.constructWebShare=function(e,t){var n=this;if(void 0===t&&(t=null),this.shareLink){var r=this.title,o=i.locales.bookInfoShareText[e]+this.title,a=this.shareLink,l="";t&&(l=s.generateNonce(),a=s.addParamToUrl(a,"n",l));var c=o+" \n\n"+a;navigator.share?navigator.share({title:r,text:o,url:a}).then(function(){t&&t.handleShare("successful",l)})["catch"](function(i){i.message.indexOf("cancel")>=0?t&&t.handleShare("canceled",l):(n.shareFallback(n.shareButton,c,e),t&&t.handleShare("unknown",l))}):(this.shareFallback(this.shareButton,c,e),t&&t.handleShare("unknown",l))}},e.prototype.shareFallback=function(e,t,n){void 0===n&&(n="en");var r=navigator.userAgent.match(/ipad|ipod|iphone/i),o=document.createElement("textarea");if(o.value=t,o.setAttribute("readonly","true"),o.style.position="absolute",o.style.left="-9999px",document.body.appendChild(o),r?o.setSelectionRange(0,o.value.length):o.select(),document.execCommand("copy"),document.body.removeChild(o),null!==e){var s=e.textContent;e.textContent=i.locales.bookInfoShareFallback[n],setTimeout(function(){e.textContent=s},5e3)}},e}();t["default"]=a}.apply(t,i))!==undefined&&(e.exports=r)},"./src/BookSettings.ts":function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i["throw"](e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}l((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/HTMLUtilities.ts"),n("./src/Icons.ts"),n("./src/Locales.ts"),n("./src/Templates.ts")],(r=function(e,t,n,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a(n),i=a(i),r=a(r),l=a(l);var c=function(){function e(e,t,n,i,r,o){this.retailers=null,this.aboutBookButton=null,this.fontChangeCallback=function(){},this.fontSizeChangeCallback=function(){},this.themeChangeCallback=function(){},this.viewChangeCallback=function(){},this.retailerChangeCallback=function(){},this.store=e,this.bookFonts=t,this.fontSizes=n,this.bookThemes=i,this.bookViews=r,this.retailers=o}return e.create=function(e){return o(this,void 0,void 0,function(){var t,n;return s(this,function(i){switch(i.label){case 0:return t=e.fontSizesInPixels.map(function(e){return e+"px"}),n=new this(e.store,e.bookFonts,t,e.bookThemes,e.bookViews,e.retailers||null),[4,n.initializeSelections(e.defaultFontSizeInPixels?e.defaultFontSizeInPixels+"px":undefined)];case 1:return i.sent(),[2,n]}})})},e.prototype.initializeSelections=function(t){return o(this,void 0,void 0,function(){var n,i,r,o,a,l,c,u,h,d,f,p,g,b,m,v,y,k,w,E,S,T,C,I;return s(this,function(s){switch(s.label){case 0:return this.bookFonts.length>=1?(n=this.bookFonts[0],[4,this.store.get(e.SELECTED_FONT_KEY)]):[3,2];case 1:if(i=s.sent())for(r=0,o=this.bookFonts;r<o.length;r++)if(a=o[r],a.name===i){n=a;break}this.selectedFont=n,s.label=2;case 2:return this.fontSizes.length>=1?[4,this.store.get(e.SELECTED_FONT_SIZE_KEY)]:[3,4];case 3:l=s.sent(),c=l&&-1!==this.fontSizes.indexOf(l),l&&c||!t||(l=t,c=l&&-1!==this.fontSizes.indexOf(l)),l&&c||(u=Math.floor(this.fontSizes.length/2),l=this.fontSizes[u]),this.selectedFontSize=l,s.label=4;case 4:return this.bookThemes.length>=1?(h=this.bookThemes[0],[4,this.store.get(e.SELECTED_THEME_KEY)]):[3,6];case 5:if(d=s.sent())for(f=0,p=this.bookThemes;f<p.length;f++)if(g=p[f],g.name===d){h=g;break}this.selectedTheme=h,s.label=6;case 6:return this.bookViews.length>=1?(b=this.bookViews[0],[4,this.store.get(e.SELECTED_VIEW_KEY)]):[3,8];case 7:if(m=s.sent())for(v=0,y=this.bookViews;v<y.length;v++)if(k=y[v],k.name===m){b=k;break}this.selectedView=b,s.label=8;case 8:return this.retailers&&this.retailers.length>=1?(w=undefined,[4,this.store.get(e.SELECTED_RETAILER_KEY)]):[3,10];case 9:if(E=s.sent())for(S=0,T=this.retailers;S<T.length;S++)if(C=T[S],(I=this.prefixRetailerId(C.retailer_id))===E){w=C;break}this.selectedRetailer=w,s.label=10;case 10:return[2]}})})},e.prototype.renderControls=function(e,t,o){var s=this;void 0===t&&(t="en"),void 0===o&&(o=!1);var a=[];if(this.bookFonts.length>1){var c=this.bookFonts.map(function(e){return l.optionTemplate("reading-style",e.name,e.label[t],"menuitem",i.makeIconUse("check-icon","checkedIcon"),e.label[t])});a.push(l.sectionTemplate(c.join("")))}if(this.fontSizes.length>1){var u=l.optionTemplate("font-setting","decrease",r.locales.fontSizeDecrease[t],"menuitem","","decrease-font")+l.optionTemplate("font-setting","increase",r.locales.fontSizeIncrease[t],"menuitem","","increase-font");a.push(l.sectionTemplate(u))}if(this.bookThemes.length>1){var h=this.bookThemes.map(function(e){return l.optionTemplate("reading-theme",e.name,e.label[t],"menuitem",i.makeIconUse("check-icon","checkedIcon"),e.label[t])});a.push(l.sectionTemplate(h.join("")))}if(this.bookViews.length>1){var d=this.bookViews.map(function(e){return l.optionTemplate("reading-style",e.name,e.label[t],"menuitem",i.makeIconUse("check-icon","checkedIcon"),e.label[t])});a.push(l.sectionTemplate(d.join("")))}if(this.retailers&&this.retailers.length>1){var f=this.retailers.map(function(e){return l.optionTemplate("retailer-setting","retailer",e.retailer_name,"menuitem",i.makeIconUse("check-icon","checkedIcon"),s.prefixRetailerId(e.retailer_id))});a.push(l.subSectionTemplate("retailer-trigger",r.locales.preferredShop[t],"menuitem","retailer-trigger",r.locales.preferredShop[t],f.join(""),t))}if(o){var p=l.aboutBookTemplate("about-this-book","about-book",r.locales.aboutThisBook[t],"menuitem","about-book");a.push(p)}if(a.push(l.tosTemplate),e.innerHTML=l.settingsTemplate(a.join("")),this.fontButtons={},this.bookFonts.length>1){for(var g=0,b=this.bookFonts;g<b.length;g++){var m=b[g];this.fontButtons[m.name]=n.findRequiredElement(e,"button[class="+m.name+"]")}this.updateFontButtons(t)}if(this.fontSizeButtons={},this.fontSizes.length>1){for(var v=0,y=["decrease","increase"];v<y.length;v++){var k=y[v];this.fontSizeButtons[k]=n.findRequiredElement(e,"button[class="+k+"]")}this.updateFontSizeButtons()}if(this.themeButtons={},this.bookThemes.length>1){for(var w=0,E=this.bookThemes;w<E.length;w++){var S=E[w];this.themeButtons[S.name]=n.findRequiredElement(e,"button[class="+S.name+"]")}this.updateThemeButtons(t)}if(this.viewButtons={},this.bookViews.length>1){for(var T=0,C=this.bookViews;T<C.length;T++){var I=C[T];this.viewButtons[I.name]=n.findRequiredElement(e,"button[class="+I.name+"]")}this.updateViewButtons(t)}if(this.retailerButtons={},this.retailers&&this.retailers.length>1){this.retailerTrigger=n.findRequiredElement(e,"button[class=retailer-trigger]"),this.retailerBack=n.findRequiredElement(e,"button[class=submenu-back]"),this.retailerSubmenu=n.findRequiredElement(e,"ul[class=subsettings-options]");for(var _=0,L=this.retailers;_<L.length;_++){var x=L[_],P=this.prefixRetailerId(x.retailer_id);this.retailerButtons[P]=n.findRequiredElement(e,"button[id="+P+"]")}this.updateRetailerButtons(t)}o&&(this.aboutBookButton=n.findRequiredElement(e,'button[class="about-book"]')),this.tosElement=n.findRequiredElement(e,'div [class="tos-link"]'),this.setupEvents(t),n.findRequiredElement(e,"ul").addEventListener("click",function(e){e.stopPropagation()})},e.prototype.onFontChange=function(e){this.fontChangeCallback=e},e.prototype.onFontSizeChange=function(e){this.fontSizeChangeCallback=e},e.prototype.onThemeChange=function(e){this.themeChangeCallback=e},e.prototype.onViewChange=function(e){this.viewChangeCallback=e},e.prototype.onRetailerChange=function(e){this.retailerChangeCallback=e},e.prototype.setupEvents=function(e){for(var t=this,n=function(n){var r=i.fontButtons[n.name];r&&r.addEventListener("click",function(i){t.selectedFont.stop(),n.start(),t.selectedFont=n,t.updateFontButtons(e),t.storeSelectedFont(n),t.fontChangeCallback(),i.preventDefault()})},i=this,r=0,o=this.bookFonts;r<o.length;r++){n(o[r])}this.fontSizes.length>1&&(this.fontSizeButtons.decrease.addEventListener("click",function(e){var n=t.fontSizes.indexOf(t.selectedFontSize);if(n>0){var i=t.fontSizes[n-1];t.selectedFontSize=i,t.fontSizeChangeCallback(),t.updateFontSizeButtons(),t.storeSelectedFontSize(i)}e.preventDefault()}),this.fontSizeButtons.increase.addEventListener("click",function(e){var n=t.fontSizes.indexOf(t.selectedFontSize);if(n<t.fontSizes.length-1){var i=t.fontSizes[n+1];t.selectedFontSize=i,t.fontSizeChangeCallback(),t.updateFontSizeButtons(),t.storeSelectedFontSize(i)}e.preventDefault()}));for(var s=function(n){var i=a.themeButtons[n.name];i&&i.addEventListener("click",function(i){t.selectedTheme.stop(),n.start(),t.selectedTheme=n,t.updateThemeButtons(e),t.storeSelectedTheme(n),t.themeChangeCallback(),i.preventDefault()})},a=this,l=0,c=this.bookThemes;l<c.length;l++){s(c[l])}for(var u=function(n){var i=h.viewButtons[n.name];i&&i.addEventListener("click",function(i){var r=t.selectedView.getCurrentPosition();t.selectedView.stop(),n.start(r),t.selectedView=n,t.updateViewButtons(e),t.storeSelectedView(n),t.viewChangeCallback(),i.preventDefault()})},h=this,d=0,f=this.bookViews;d<f.length;d++){u(f[d])}if(this.retailers&&this.retailers.length>1){this.retailerTrigger.addEventListener("click",function(e){t.retailerSubmenu.classList.add("active"),e.preventDefault()}),this.retailerBack.addEventListener("click",function(e){t.retailerSubmenu.classList.remove("active"),e.preventDefault()});for(var p=function(n){var i=g.retailerButtons[g.prefixRetailerId(n.retailer_id)];i&&i.addEventListener("click",function(i){t.selectedRetailer=n,t.updateRetailerButtons(e),t.storeSelectedRetailer(n),t.retailerChangeCallback(),i.preventDefault()})},g=this,b=0,m=this.retailers;b<m.length;b++){p(m[b])}}},e.prototype.updateFontButtons=function(e){for(var t=0,n=this.bookFonts;t<n.length;t++){var i=n[t];i===this.selectedFont?(this.fontButtons[i.name].className=i.name+" active",this.fontButtons[i.name].setAttribute("aria-label",i.label[e]+r.locales.enabled[e])):(this.fontButtons[i.name].className=i.name,this.fontButtons[i.name].setAttribute("aria-label",i.label[e]+r.locales.disabled[e]))}},e.prototype.updateFontSizeButtons=function(){var e=this.fontSizes.indexOf(this.selectedFontSize);0===e?(this.fontSizeButtons.decrease.className="decrease",this.fontSizeButtons.decrease.disabled=!0):(this.fontSizeButtons.decrease.className="decrease",this.fontSizeButtons.decrease.disabled=!1),e===this.fontSizes.length-1?(this.fontSizeButtons.increase.className="increase",this.fontSizeButtons.increase.disabled=!0):(this.fontSizeButtons.increase.className="increase",this.fontSizeButtons.increase.disabled=!1)},e.prototype.updateThemeButtons=function(e){for(var t=0,n=this.bookThemes;t<n.length;t++){var i=n[t];i===this.selectedTheme?(this.themeButtons[i.name].className=i.name+" active",this.themeButtons[i.name].setAttribute("aria-label",i.label[e]+r.locales.enabled[e])):(this.themeButtons[i.name].className=i.name,this.themeButtons[i.name].setAttribute("aria-label",i.label[e]+r.locales.disabled[e]))}},e.prototype.updateViewButtons=function(e){for(var t=0,n=this.bookViews;t<n.length;t++){var i=n[t];i===this.selectedView?(this.viewButtons[i.name].className=i.name+" active",this.viewButtons[i.name].setAttribute("aria-label",i.label[e]+r.locales.enabled[e])):(this.viewButtons[i.name].className=i.name,this.viewButtons[i.name].setAttribute("aria-label",i.label[e]+r.locales.disabled[e]))}},e.prototype.updateRetailerButtons=function(e){if(this.retailers)for(var t=0,n=this.retailers;t<n.length;t++){var i=n[t];i===this.selectedRetailer?(this.retailerButtons[this.prefixRetailerId(i.retailer_id)].className="retailer active",this.retailerButtons[this.prefixRetailerId(i.retailer_id)].setAttribute("aria-label",i.retailer_name+r.locales.enabled[e])):(this.retailerButtons[this.prefixRetailerId(i.retailer_id)].className="retailer",this.retailerButtons[this.prefixRetailerId(i.retailer_id)].setAttribute("aria-label",i.retailer_name+r.locales.disabled[e]))}},e.prototype.getSelectedFont=function(){return this.selectedFont},e.prototype.getSelectedFontSize=function(){return this.selectedFontSize},e.prototype.getSelectedTheme=function(){return this.selectedTheme},e.prototype.getSelectedView=function(){return this.selectedView},e.prototype.getSelectedRetailer=function(){return this.selectedRetailer},e.prototype.getAboutBookButton=function(){return this.aboutBookButton},e.prototype.getTosElement=function(){return this.tosElement},e.prototype.forceToggleView=function(e,t){if(void 0===t&&(t="en"),null!==e){var n=this.selectedView.getCurrentPosition();this.selectedView.stop(),e.start(n),this.selectedView=e,this.updateViewButtons(t),this.storeSelectedView(e)}},e.prototype.storeSelectedFont=function(t){return o(this,void 0,void 0,function(){return s(this,function(){return[2,this.store.set(e.SELECTED_FONT_KEY,t.name)]})})},e.prototype.storeSelectedFontSize=function(t){return o(this,void 0,void 0,function(){return s(this,function(){return[2,this.store.set(e.SELECTED_FONT_SIZE_KEY,t)]})})},e.prototype.storeSelectedTheme=function(t){return o(this,void 0,void 0,function(){return s(this,function(){return[2,this.store.set(e.SELECTED_THEME_KEY,t.name)]})})},e.prototype.storeSelectedView=function(t){return o(this,void 0,void 0,function(){return s(this,function(){return[2,this.store.set(e.SELECTED_VIEW_KEY,t.name)]})})},e.prototype.storeSelectedRetailer=function(t){return o(this,void 0,void 0,function(){return s(this,function(){return[2,this.store.set(e.SELECTED_RETAILER_KEY,this.prefixRetailerId(t.retailer_id))]})})},e.prototype.prefixRetailerId=function(e){return"retailer-"+e},e.SELECTED_FONT_KEY="settings-selected-font",e.SELECTED_FONT_SIZE_KEY="settings-selected-font-size",e.SELECTED_THEME_KEY="settings-selected-theme",e.SELECTED_VIEW_KEY="settings-selected-view",e.SELECTED_RETAILER_KEY="settings-selected-retailer",e}();t["default"]=c}.apply(t,i))!==undefined&&(e.exports=r)},"./src/BrowserUtilities.ts":function(e,t,n){var i,r;i=[n,t],(r=function(e,t){"use strict";function n(){return document.documentElement.clientWidth}function i(){return document.documentElement.clientHeight}function r(){return n()!==window.innerWidth}Object.defineProperty(t,"__esModule",{value:!0}),t.getWidth=n,t.getHeight=i,t.isZoomed=r}.apply(t,i))!==undefined&&(e.exports=r)},"./src/Cacher.ts":function(e,t,n){var i,r;i=[n,t],(r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.Uncached=0]="Uncached",e[e.UpdateAvailable=1]="UpdateAvailable",e[e.CheckingForUpdate=2]="CheckingForUpdate",e[e.Downloading=3]="Downloading",e[e.Downloaded=4]="Downloaded",e[e.Error=5]="Error"}(t.CacheStatus||(t.CacheStatus={}))}.apply(t,i))!==undefined&&(e.exports=r)},"./src/ColumnsPaginatedBookView.ts":function(e,t,n){var i,r,o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/HTMLUtilities.ts"),n("./src/BrowserUtilities.ts"),n("./src/Locales.ts")],(r=function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=o(n),i=o(i),r=o(r);var s=function(){function e(){this.name="columns-paginated-view",this.label=r.locales.bookViewPaginated,this.sideMargin=0,this.height=0,this.hasFixedScrollWidth=!1}return e.prototype.start=function(e){var t=n.findRequiredIframeElement(this.bookElement.contentDocument,"body");t.style.webkitColumnCount="1",t.style.MozColumnCount="1",t.style.columnCount="1",t.style.webkitColumnFill="auto",t.style.MozColumnFill="auto",t.style.columnFill="auto",t.style.overflow="hidden",t.style.position="relative",t.style.webkitFontSmoothing="subpixel-antialiased",this.setSize();var i=document.createElement("meta");i.name="viewport",i.content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no";var r=n.findIframeElement(this.bookElement.contentDocument,"head");r&&r.appendChild(i),this.checkForFixedScrollWidth(),this.goToPosition(e),setTimeout(function(){document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.left="0",document.body.style.right="0",document.body.style.top="0",document.body.style.bottom="0"},0)},e.prototype.checkForFixedScrollWidth=function(){var e=n.findRequiredIframeElement(this.bookElement.contentDocument,"body"),t=(e.style.left||"0px").slice(0,-2),i=e.scrollWidth;e.style.left=t-1+"px",this.hasFixedScrollWidth=e.scrollWidth===i,e.style.left=t+"px"},e.prototype.setSize=function(){var e=n.findRequiredIframeElement(this.bookElement.contentDocument,"body"),t=i.getWidth()-2*this.sideMargin+"px";e.style.columnWidth=t,e.style.webkitColumnWidth=t,e.style.MozColumnWidth=t,e.style.columnGap=2*this.sideMargin+"px",e.style.webkitColumnGap=2*this.sideMargin+"px",e.style.MozColumnGap=2*this.sideMargin+"px",e.style.height=this.height+"px",e.style.width=t,e.style.marginLeft=this.sideMargin+"px",e.style.marginRight=this.sideMargin+"px",e.style.marginTop="0px",e.style.marginBottom="0px",e.style.boxSizing="border-box",e.style.setProperty("padding","0","important"),this.bookElement.contentDocument.documentElement.style.height=this.height+"px",this.bookElement.style.height=this.height+"px",this.bookElement.style.width=i.getWidth()+"px";for(var r=e.querySelectorAll("img, svg"),o=0,s=r;o<s.length;o++){var a=s[o];a.style.maxWidth="100%";for(var l=a,c=0;l!==e;){var u=window.getComputedStyle(l);u.marginTop&&(c+=parseInt(u.marginTop.slice(0,-2),10)),u.marginBottom&&(c+=parseInt(u.marginBottom.slice(0,-2),10)),l=l.parentElement}a.style.maxHeight=this.height-c+"px",a.style.verticalAlign="top"}},e.prototype.stop=function(){document.body.style.overflow="auto",document.body.style.position="static",document.body.style.left="",document.body.style.right="",document.body.style.top="",document.body.style.bottom="";var e=n.findRequiredIframeElement(this.bookElement.contentDocument,"body");e.style.columnCount="",e.style.webkitColumnCount="",e.style.MozColumnCount="",e.style.columnGap="",e.style.webkitColumnGap="",e.style.MozColumnGap="",e.style.columnFill="",e.style.webkitColumnFill="",e.style.MozColumnFill="",e.style.overflow="",e.style.position="",e.style.webkitFontSmoothing="",e.style.columnWidth="",e.style.webkitColumnWidth="",e.style.MozColumnWidth="",e.style.height="",e.style.width="",e.style.marginLeft="",e.style.marginRight="",e.style.marginTop="",e.style.marginBottom="",e.style.boxSizing="border-box",e.style.setProperty("padding","0","important"),
this.bookElement.contentDocument.documentElement.style.height="",this.bookElement.style.height="",this.bookElement.style.width="";for(var t=e.querySelectorAll("img, svg"),i=0,r=t;i<r.length;i++){var o=r[i];o.style.maxWidth="",o.style.maxHeight="",o.style.marginLeft="",o.style.marginRight=""}},e.prototype.getLeftColumnsWidth=function(){var e=n.findRequiredIframeElement(this.bookElement.contentDocument,"body"),t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox"),i=-1!==this.bookElement.src.indexOf(".xml");return t&&i?e.scrollLeft:-(e.style.left||"0px").slice(0,-2)},e.prototype.getRightColumnsWidth=function(){var e=n.findRequiredIframeElement(this.bookElement.contentDocument,"body"),t=e.scrollWidth,i=this.getColumnWidth(),r=t+this.sideMargin-i;if(this.hasFixedScrollWidth){var o=this.getLeftColumnsWidth();r=Math.max(0,r-o)}return r===this.sideMargin?0:r},e.prototype.getColumnWidth=function(){return n.findRequiredIframeElement(this.bookElement.contentDocument,"body").offsetWidth+2*this.sideMargin},e.prototype.setLeftColumnsWidth=function(e){var t=n.findRequiredIframeElement(this.bookElement.contentDocument,"body"),i=-1!==navigator.userAgent.toLowerCase().indexOf("firefox"),r=-1!==this.bookElement.src.indexOf(".xml");i&&r?t.scrollLeft=e:t.style.left=-e+"px"},e.prototype.getCurrentPosition=function(){var e=this.getColumnWidth(),t=this.getLeftColumnsWidth();return t/(t+e+this.getRightColumnsWidth())},e.prototype.getCurrentPage=function(){return this.getCurrentPosition()*this.getPageCount()+1},e.prototype.getPageCount=function(){var e=this.getColumnWidth();return(this.getLeftColumnsWidth()+e+this.getRightColumnsWidth())/e},e.prototype.onFirstPage=function(){return this.getLeftColumnsWidth()<=0},e.prototype.onLastPage=function(){return this.getRightColumnsWidth()<=0},e.prototype.goToPreviousPage=function(){var e=this.getLeftColumnsWidth(),t=this.getColumnWidth();this.setLeftColumnsWidth(e-t)},e.prototype.goToNextPage=function(){var e=this.getLeftColumnsWidth(),t=this.getColumnWidth();this.setLeftColumnsWidth(e+t)},e.prototype.goToPosition=function(e){this.setSize(),this.setLeftColumnsWidth(0);var t=this.getColumnWidth(),n=this.getRightColumnsWidth(),i=t+n,r=e*i,o=Math.round(r/t)*t;o>=i&&(o-=t),this.setLeftColumnsWidth(o)},e.prototype.goToElement=function(e,t){var n=this.bookElement.contentDocument.getElementById(e);if(n){var i=n.style.height;n.style.height="0";var r=n.getBoundingClientRect().left,o=this.getColumnWidth(),s=Math.floor(r/o)*o;if(t){var a=this.getLeftColumnsWidth();s=Math.floor(r/o)*o+a}n.style.height=i,this.setLeftColumnsWidth(s)}},e}();t["default"]=s}.apply(t,i))!==undefined&&(e.exports=r)},"./src/DayTheme.ts":function(e,t,n){var i,r,o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/HTMLUtilities.ts"),n("./src/Locales.ts")],(r=function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=o(n),i=o(i);var r=function(){function e(){this.name="day-theme",this.label=i.locales.bookThemeDay}return e.prototype.start=function(){var e=document.documentElement;n.setAttr(e,"data-cassis-theme","day")},e.prototype.stop=function(){var e=document.documentElement;n.removeAttr(e,"data-cassis-theme")},e}();t["default"]=r}.apply(t,i))!==undefined&&(e.exports=r)},"./src/EpubReadingSystem.ts":function(e,t,n){var i,r;i=[n,t],(r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.epubReadingSystemObject={name:"Cassis Reader",version:"3.0.0-beta.4"}}.apply(t,i))!==undefined&&(e.exports=r)},"./src/EventHandler.ts":function(e,t,n){var i,r,o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/BrowserUtilities.ts"),n("./src/HTMLUtilities.ts")],(r=function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=o(n),i=o(i);var r=function(){function e(){var t=this;this.pendingMouseEventStart=null,this.pendingMouseEventEnd=null,this.pendingTouchEventStart=null,this.pendingTouchEventEnd=null,this.frameBody=null,this.onLeftTap=function(){},this.onMiddleTap=function(){},this.onRightTap=function(){},this.onBackwardSwipe=function(){},this.onForwardSwipe=function(){},this.onDownwardSwipe=function(){},this.onUpwardSwipe=function(){},this.onLeftArrow=function(){},this.onRightArrow=function(){},this.onLeftHover=function(){},this.onRightHover=function(){},this.onRemoveHover=function(){},this.onInternalLink=function(){},this.onExternalLink=function(){},this.overlayPercentage=.3,this.handleMouseEventStart=function(e){t.pendingMouseEventStart=e},this.handleTouchEventStart=function(e){n.isZoomed()||1===e.changedTouches.length&&(t.pendingTouchEventStart=e)},this.handlePinchZoom=function(e){2!==e.touches.length||t.frameBody||e.preventDefault()},this.handleMouseEventEnd=function(n){if(t.pendingMouseEventStart){var i=window.devicePixelRatio,r=(t.pendingMouseEventStart.clientX-n.clientX)/i,o=(t.pendingMouseEventStart.clientY-n.clientY)/i;if(Math.abs(r)<e.CLICK_PIXEL_TOLERANCE&&Math.abs(o)<e.CLICK_PIXEL_TOLERANCE)return t.pendingMouseEventEnd?(t.pendingMouseEventStart=null,void(t.pendingMouseEventEnd=null)):(t.pendingMouseEventStart=null,t.pendingMouseEventEnd=n,void setTimeout(t.handleClick,e.DOUBLE_CLICK_MS));t.pendingMouseEventEnd=null,t.pendingMouseEventStart=null}},this.handleTouchEventEnd=function(i){if(i.cancelable&&i.preventDefault(),!n.isZoomed()&&1===i.changedTouches.length&&t.pendingTouchEventStart){var r=t.pendingTouchEventStart.changedTouches[0],o=i.changedTouches[0];if(r){var s=window.devicePixelRatio,a=(r.clientX-o.clientX)/s,l=(r.clientY-o.clientY)/s;if(Math.abs(a)<e.TAP_PIXEL_TOLERANCE&&Math.abs(l)<e.TAP_PIXEL_TOLERANCE)return t.pendingTouchEventEnd?(t.pendingTouchEventStart=null,void(t.pendingTouchEventEnd=null)):i.timeStamp-t.pendingTouchEventStart.timeStamp>e.LONG_PRESS_MS?(t.pendingTouchEventStart=null,void(t.pendingTouchEventEnd=null)):(t.pendingTouchEventStart=null,t.pendingTouchEventEnd=i,void setTimeout(t.handleTap,e.DOUBLE_TAP_MS));if(t.pendingTouchEventEnd=null,i.timeStamp-t.pendingTouchEventStart.timeStamp>e.SLOW_SWIPE_MS)return void(t.pendingTouchEventStart=null);var c=(r.clientY-o.clientY)/(r.clientX-o.clientX);if(Math.abs(c)>.5)return l<0-e.VERTICAL_SWIPE_DELTA?t.onUpwardSwipe(i):l>0+e.VERTICAL_SWIPE_DELTA&&t.onDownwardSwipe(i),void(t.pendingTouchEventStart=null);a<0?t.onBackwardSwipe(i):t.onForwardSwipe(i),t.pendingTouchEventStart=null}}},this.handleMouseWheel=function(n){var i,r=200;clearTimeout(i),i=setTimeout(function(){n.deltaY<0-e.VERTICAL_WHEEL_DELTA?t.onUpwardSwipe(n):n.deltaY>0+e.VERTICAL_WHEEL_DELTA&&t.onDownwardSwipe(n)},r)},this.handleClick=function(){if(t.pendingMouseEventEnd){if(t.checkForLink(t.pendingMouseEventEnd))return void(t.pendingMouseEventEnd=null);var e=t.pendingMouseEventEnd.clientX,n=window.innerWidth;t.frameBody&&(n=t.frameBody.offsetWidth),e/n<t.overlayPercentage?t.onLeftTap(t.pendingMouseEventEnd):e/n>1-t.overlayPercentage?t.onRightTap(t.pendingMouseEventEnd):t.onMiddleTap(t.pendingMouseEventEnd),t.pendingMouseEventEnd=null}},this.handleTap=function(){if(t.pendingTouchEventEnd){if(t.checkForLink(t.pendingTouchEventEnd))return t.handleLinks(t.pendingTouchEventEnd),void(t.pendingTouchEventEnd=null);var e=t.pendingTouchEventEnd.changedTouches[0];if(e){var n=e.clientX,i=window.innerWidth;t.frameBody&&(i=t.frameBody.offsetWidth),n/i<t.overlayPercentage?t.onLeftTap(t.pendingTouchEventEnd):n/i>1-t.overlayPercentage?t.onRightTap(t.pendingTouchEventEnd):t.onMiddleTap(t.pendingTouchEventEnd),t.pendingTouchEventEnd=null}}},this.checkForLink=function(e){for(var t=e.target;t&&"body"!==t.tagName.toLowerCase();){if("a"===t.tagName.toLowerCase()&&t.href)return t;t=t.parentElement}return null},this.handleMouseMove=function(e){var n=e.clientX,i=window.innerWidth;t.frameBody&&(i=t.frameBody.offsetWidth),n/i<t.overlayPercentage?t.onLeftHover():n/i>1-t.overlayPercentage?t.onRightHover():t.onRemoveHover()},this.handleMouseLeave=function(){t.onRemoveHover()},this.handleLinks=function(e){var n=t.checkForLink(e);if(n){var i=n.target&&"_blank"===n.target,r=window.location.protocol===n.protocol&&window.location.port===n.port&&window.location.hostname===n.hostname,o=r&&t.bookUrl.split("/")[1]===n.pathname.split("/")[1],s=n.href.indexOf("?s=")>=0,a=n.href.indexOf("#")>=0,l="crowberry-button"===n.id;i||!r||!o||s?(t.onExternalLink(n),e.preventDefault(),e.stopPropagation()):!l&&(r&&a||o)?(t.onInternalLink(n),e.preventDefault(),e.stopPropagation()):(l||r&&!a)&&n.click()}},this.handleKeyboard=function(e){var n=!!e.shiftKey,i=!!e.metaKey,r=!!e.ctrlKey,o=32;37===e.keyCode||n&&e.keyCode===o?t.onLeftArrow(e):39===e.keyCode||e.keyCode===o?t.onRightArrow(e):(9===e.keyCode||(i||r)&&48===e.keyCode||(i||r)&&187===e.keyCode||(i||r)&&189===e.keyCode)&&e.preventDefault()}}return e.prototype.setupEvents=function(e,t,n){if(void 0===n&&(n=!1),null===e)throw"cannot setup events for null";var r=!1;try{var o=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("testPassive",o,o),window.removeEventListener("testPassive",o,o)}catch(e){r=!1}e.addEventListener("touchstart",this.handleTouchEventStart.bind(this),!!r&&{passive:!1}),e.addEventListener("touchmove",this.handlePinchZoom.bind(this),!!r&&{passive:!1}),e.addEventListener("touchend",this.handleTouchEventEnd.bind(this)),e.addEventListener("mousedown",this.handleMouseEventStart.bind(this)),e.addEventListener("mouseup",this.handleMouseEventEnd.bind(this)),e.addEventListener("mouseenter",this.handleMouseMove.bind(this)),e.addEventListener("mousemove",this.handleMouseMove.bind(this)),e.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),e.addEventListener("wheel",this.handleMouseWheel.bind(this)),e.addEventListener("click",this.handleLinks.bind(this)),e.addEventListener("keydown",this.handleKeyboard.bind(this)),this.bookUrl=t,n&&(this.frameBody=i.findRequiredIframeElement(e,"body"),this.overlayPercentage=.15)},e.CLICK_PIXEL_TOLERANCE=10,e.TAP_PIXEL_TOLERANCE=10,e.DOUBLE_CLICK_MS=200,e.LONG_PRESS_MS=500,e.DOUBLE_TAP_MS=200,e.SLOW_SWIPE_MS=500,e.VERTICAL_SWIPE_DELTA=60,e.VERTICAL_WHEEL_DELTA=15,e}();t["default"]=r}.apply(t,i))!==undefined&&(e.exports=r)},"./src/FXLNavigator.ts":function(e,t,n){var i,r,o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i["throw"](e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}l((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}},c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/Navigator.ts"),n("./src/Manifest.ts"),n("./src/EventHandler.ts"),n("./src/BrowserUtilities.ts"),n("./src/HTMLUtilities.ts"),n("./src/Locales.ts"),n("./src/Templates.ts"),n("./src/Renderer.ts"),n("./src/Toast.ts")],(r=function(e,t,n,i,r,u,h,d,f,p,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=l(n),i=l(i),r=l(r),u=c(u),h=c(h),d=c(d),f=c(f),p=l(p),g=l(g);var b=function(e){function t(t,n,i,o,s,a,l,c,u,h,d,f){void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===d&&(d=null),void 0===f&&(f=null);var p=e.call(this,t,n,i,o,s,a,l,c,u,h,d,f)||this;return p.beamHandler=new r["default"],p}return o(t,e),t.create=function(e){return s(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:return t=new this(e.store,e.cacher||null,e.settings,e.annotator||null,e.tracker||null,e.libHandler||null,e.tosLink||null,e.allowFullscreen||null,e.locale||null,e.bookInfo||null,e.startPath||null,e.startPage||null),[4,t.start(e.element,e.manifestUrl,e.assetsUrl)];case 1:return n.sent(),[2,t]}})})},t.prototype.start=function(e,t,n){return s(this,void 0,void 0,function(){var i,r,o;return a(this,function(s){switch(s.label){case 0:this.showLoadingMessageAfterDelay(),d.localeAvailable(this.locale)||(this.locale="en"),e.innerHTML=f.FXLNavigatorTemplate(this.locale),h.setAttr(document.documentElement,"data-cassis-navigator","fxl"),h.setAttr(document.documentElement,"data-cassis-theme","night"),this.manifestUrl=t,this.assetsUrl=n,s.label=1;case 1:return s.trys.push([1,8,,9]),(this.enablePinchZoom(),this.initUIElements(e),this.initHelperProps(),this.setupEvents(),this.tracker)?(i=this.renderer,[4,this.handleOrientationTracking.bind(this)]):[3,3];case 2:i.onOrientationChange=s.sent(),s.label=3;case 3:return this.beamHandler&&this.beamHandler.setupEvents(this.beam,"/"),[4,this.createLibHandler()];case 4:return s.sent(),this.createFullscreen(),[4,this.createBookInfo(this.infoTop)];case 5:return s.sent(),this.settings.onRetailerChange(this.updateRetailer.bind(this)),this.cacher&&this.enableOffline(),this.createTosLink(),this.createSettingsFocusTrap(),r=this,[4,this.getSpreadsHint()];case 6:return r.spreadsHint=s.sent(),this.startOrientation=this.renderer.getOrientation(),[4,this.loadManifest()];case 7:return[2,s.sent()];case 8:return o=s.sent(),[2,new Promise(function(e,t){return t(o)})["catch"](function(){})];case 9:return[2]}})})},t.prototype.getSpreadsHint=function(){return s(this,void 0,void 0,function(){var e;return a(this,function(n){switch(n.label){case 0:return[4,this.store.get(t.SPREADS_HINT_KEY)];case 1:return e=n.sent(),null!==e?[2,!1]:[2,!0]}})})},t.prototype.setSpreadsHint=function(){return s(this,void 0,void 0,function(){return a(this,function(){return[2,this.store.set(t.SPREADS_HINT_KEY,"false")]})})},t.prototype.initUIElements=function(t){e.prototype.initUIElements.call(this,t),this.renderer=new p["default"](this.store,"fxl",this.rendererHost,2),this.beam=h.findRequiredElement(t,"main")},t.prototype.centerBookTitle=function(){this.infoTop.style.marginLeft="",this.infoTop.style.marginRight="";var e=this.infoTop.getBoundingClientRect().left,t=u.getWidth()-this.infoTop.getBoundingClientRect().right,n=t-e;n>0?this.infoTop.style.marginLeft=n+"px":this.infoTop.style.marginRight=Math.abs(n)+"px"},t.prototype.centerPositionInfo=function(){this.infoBottom.style.marginLeft="",this.infoBottom.style.marginRight="";var e=this.infoBottom.getBoundingClientRect().left,t=u.getWidth()-this.infoBottom.getBoundingClientRect().right,n=t-e;n>0?this.infoBottom.style.marginLeft=n+"px":this.infoBottom.style.marginRight=Math.abs(n)+"px"},t.prototype.updateChaptersLink=function(e){var t=this.getStartItemHref(),n=this.getPreviousItemHref(e);"fxl"===this.renderer.getType()&&(n===t||i["default"].spineItemIsBookplate(n)||(n=this.getPreviousItemHref(n))),""!==n?(this.previousChapterLink.href=n,this.enableAnchor(this.previousChapterLink)):(this.previousChapterLink.removeAttribute("href"),this.disableAnchor(this.previousChapterLink));var r=this.getNextItemHref(e);"fxl"===this.renderer.getType()&&(t===e||i["default"].spineItemIsBookplate(e)||i["default"].spineItemIsBookplate(r)||(r=this.getNextItemHref(r))),""!==r?(this.nextChapterLink.href=r,this.enableAnchor(this.nextChapterLink)):(this.nextChapterLink.removeAttribute("href"),1!==this.renderer.getVisibleFrames()&&this.disableAnchor(this.nextChapterLink))},t.prototype.handleRenditionLoad=function(e){return s(this,void 0,void 0,function(){var t,n,i,r,o,s,l,c,u,h,f=this;return a(this,function(a){switch(a.label){case 0:this.errorMessage.style.display="none",this.showLoadingMessageAfterDelay(),a.label=1;case 1:return a.trys.push([1,11,,12]),this.hideTOC(),this.populateBookTitle(),[4,this.handleResize()];case 2:return a.sent(),this.beamHandler?(t=this.beamHandler,[4,this.handlePreviousPageClick.bind(this)]):[3,7];case 3:return t.onBackwardSwipe=a.sent(),n=this.beamHandler,[4,this.handleNextPageClick.bind(this)];case 4:return n.onForwardSwipe=a.sent(),i=this.beamHandler,[4,this.handlePreviousPageClick.bind(this)];case 5:return i.onLeftTap=a.sent(),this.beamHandler.onMiddleTap=this.handleToggleLinksClick.bind(this),r=this.beamHandler,[4,this.handleNextPageClick.bind(this)];case 6:r.onRightTap=a.sent(),this.beamHandler.onLeftArrow=this.handleKeyboardNavigation.bind(this),this.beamHandler.onRightArrow=this.handleKeyboardNavigation.bind(this),this.beamHandler.onLeftHover=this.handleLeftHover.bind(this),this.beamHandler.onRightHover=this.handleRightHover.bind(this),this.beamHandler.onRemoveHover=this.handleRemoveHover.bind(this),a.label=7;case 7:return-1!==e.indexOf("#")?(o=e.slice(0,e.indexOf("#")),s=this.getSpreadItems(o),this.renderer.update(s),[2,new Promise(function(e){return e()})]):(this.setActiveTOCItem(e),l=this.renderer.getVisibleFrames(),c=this.renderer.getOrientation(),u=this.renderer.getActiveFrame(),[4,this.saveCurrentReadingPosition(u)]);case 8:return a.sent(),this.tracker?[4,this.tracker.startTracking(e)]:[3,10];case 9:a.sent(),this.handleOrientationTracking(c,u,l),a.label=10;case 10:return this.hideLoadingMessage(),this.renderer.show(),this.spreadsHint&&!this.bookplateHint&&(this.startOrientation!==c||"portrait"!==c||this.renderer.onFirstPage()||(this.setSpreadsHint(),this.spreadsHint=!1,setTimeout(function(){new g["default"](d.locales.spreadHint[f.locale],"top")},1e3))),this.bookplateHint&&this.handleBookplateToast(),[2,new Promise(function(e){return e()})];case 11:return h=a.sent(),this.abortOnError(),[2,new Promise(function(e,t){return t(h)})["catch"](function(){})];case 12:return[2]}})})},t.prototype.handleToggleLinksClick=function(t){this.toggleDisplay(this.linksBottom),e.prototype.handleToggleLinksClick.call(this,t)},t.prototype.updatePositionInfo=function(e){var t=this.manifest.getSpineCount(e),n=this.manifest.getPageCount();if(null!==t)if(i["default"].spineItemIsBookplate(e)||i["default"].spreadIsBookplate(e))this.chapterPosition.innerHTML=d.locales.chapterPositionPage[this.locale]+" i\u2013ii "+d.locales.chapterPositionOf[this.locale]+" "+n;else{var r=void 0;if(r=t.toString(),t>1){var o=this.getNextItemHref(e),s=this.manifest.getSpineCount(o);null!==s&&(2===this.renderer.getVisibleFrames()?r+="\u2013"+s.toString():1===this.renderer.getActiveFrame()&&(r=""+s.toString())),1===this.renderer.getVisibleFrames()&&(r===n.toString()?this.disableAnchor(this.nextChapterLink):this.enableAnchor(this.nextChapterLink))}this.chapterPosition.innerHTML=d.locales.chapterPositionPage[this.locale]+" "+r+" "+d.locales.chapterPositionOf[this.locale]+" "+n}else this.chapterPosition.innerHTML=d.locales.chapterPositionPage[this.locale]+" ? "+d.locales.chapterPositionOf[this.locale]+" "+n},t.prototype.handlePreviousPageClick=function(e){return s(this,void 0,void 0,function(){var t,n,r,o,s,l;return a(this,function(a){switch(a.label){case 0:return t=this.renderer.getLocation(),(n=t===this.getStartItemHref(),r=i["default"].spineItemIsBookplate(t),1!==this.renderer.getVisibleFrames()||1!==this.renderer.getActiveFrame()||!this.previousChapterLink.hasAttribute("href")||n||r)?[3,1]:(this.renderer.switchFrames(),this.updatePositionInfo(t),this.saveCurrentReadingPosition(0),this.tracker&&this.tracker.handleProgression("pageTurnBackward",0,!1),[3,3]);case 1:return o=this.previousChapterLink.href===this.getStartItemHref(),s=i["default"].spineItemIsBookplate(this.previousChapterLink.href),l=1,this.previousChapterLink.hasAttribute("href")&&(o||s)&&(l=0),[4,this.goToPreviousResource(l)];case 2:a.sent(),a.label=3;case 3:return e.preventDefault(),e.stopPropagation(),[2]}})})},t.prototype.handleNextPageClick=function(e){return s(this,void 0,void 0,function(){var t,n,r,o;return a(this,function(s){switch(s.label){case 0:return t=this.renderer.getLocation(),(n=t===this.getStartItemHref(),r=i["default"].spineItemIsBookplate(t),1!==this.renderer.getVisibleFrames()||0!==this.renderer.getActiveFrame()||this.nextChapterLink.hasAttribute("aria-disabled")||n||r)?[3,1]:(this.renderer.switchFrames(),o=this.renderer.getLocation(),this.updatePositionInfo(o),this.saveCurrentReadingPosition(1),this.tracker&&this.tracker.handleProgression("pageTurnForward",1,!1),[3,3]);case 1:return[4,this.goToNextResource()];case 2:s.sent(),s.label=3;case 3:return e.preventDefault(),e.stopPropagation(),[2]}})})},t.prototype.handleLeftHover=function(){this.renderer.onFirstPage()?this.renderer.removeHover():this.renderer.hoverLeft()},t.prototype.handleRightHover=function(){this.renderer.onLastPage()||this.nextChapterLink.hasAttribute("aria-disabled")?this.renderer.removeHover():this.renderer.hoverRight()},t.prototype.handleInternalLink=function(e){return s(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:return this.tracker?[4,this.tracker.handleEvents(e)]:[3,3];case 1:return n.sent(),[4,this.tracker.stopTracking()];case 2:n.sent(),n.label=3;case 3:return t=0,1!==this.renderer.getVisibleFrames()||this.manifest.spineItemIsLeft(e.href)||(t=1),this.navigate({resource:e.href,position:t}),[2]}})})},t.prototype.enablePinchZoom=function(){var e=h.findElement(document.documentElement,"meta[name=viewport]");e?e.content=t.FXL_VIEWPORT:(e=document.createElement("meta"),e.name="viewport",e.content=t.FXL_VIEWPORT,document.head.appendChild(e))},t.prototype.handleResize=function(){return s(this,void 0,void 0,function(){var e,t,n=this;return a(this,function(i){switch(i.label){case 0:return e=u.getHeight()+"px",setTimeout(function(){document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.left="0",document.body.style.right="0",document.body.style.top="0",document.body.style.bottom="0"},0),this.beam.style.height=e,[4,this.renderer.resize()];case 1:return i.sent(),this.renderer.eventHandlers.forEach(function(e,t){return s(n,void 0,void 0,function(){var n,i,r,o,s,l;return a(this,function(a){switch(a.label){case 0:return n=e,[4,this.handlePreviousPageClick.bind(this)];case 1:return n.onBackwardSwipe=a.sent(),i=e,[4,this.handleNextPageClick.bind(this)];case 2:return i.onForwardSwipe=a.sent(),(e.onMiddleTap=this.handleToggleLinksClick.bind(this),e.onInternalLink=this.handleInternalLink.bind(this),e.onExternalLink=this.handleExternalLink.bind(this),e.onLeftArrow=this.handleKeyboardNavigation.bind(this),e.onRightArrow=this.handleKeyboardNavigation.bind(this),2!==this.renderer.getVisibleFrames()||this.renderer.onFirstPage())?[3,7]:0!==t?[3,4]:(e.onLeftHover=this.handleLeftHover.bind(this),e.onRightHover=this.handleRemoveHover.bind(this),r=e,[4,this.handlePreviousPageClick.bind(this)]);case 3:return r.onLeftTap=a.sent(),e.onRightTap=this.handleToggleLinksClick.bind(this),[3,6];case 4:return 1!==t?[3,6]:(e.onLeftHover=this.handleRemoveHover.bind(this),e.onRightHover=this.handleRightHover.bind(this),e.onLeftTap=this.handleToggleLinksClick.bind(this),o=e,[4,this.handleNextPageClick.bind(this)]);case 5:o.onRightTap=a.sent(),a.label=6;case 6:return e.onRemoveHover=this.handleRemoveHover.bind(this),[3,10];case 7:return e.onLeftHover=this.handleLeftHover.bind(this),e.onRightHover=this.handleRightHover.bind(this),e.onRemoveHover=this.handleRemoveHover.bind(this),s=e,[4,this.handlePreviousPageClick.bind(this)];case 8:return s.onLeftTap=a.sent(),l=e,[4,this.handleNextPageClick.bind(this)];case 9:l.onRightTap=a.sent(),a.label=10;case 10:return[2]}})})}),t=this.renderer.getLocation(),this.updateChaptersLink(t),this.updatePositionInfo(t),this.centerBookTitle(),this.centerPositionInfo(),[2]}})})},t.prototype.handlePreviousChapterClick=function(e){return s(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,this.handlePreviousPageClick(e)];case 1:return t.sent(),[2]}})})},t.prototype.handleNextChapterClick=function(e){return s(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,this.handleNextPageClick(e)];case 1:return t.sent(),[2]}})})},t.prototype.handleOrientationTracking=function(e,t,n){if(this.tracker){var i="orientationPortrait";"landscape"===e&&(i="orientationLandscape");var r=!1;2===n&&(r=!0),this.tracker.handleProgression(i,t,r)}},t.prototype.getSpreadItems=function(e){var t=this.manifest.spineItemIsLeft(e);if(i["default"].spineItemIsBookplate(e))return[e,e];if(t){return[e,this.getNextItemHref(e)]}return[this.getPreviousItemHref(e),e]},t.prototype.navigate=function(t){if(e.prototype.navigate.call(this,t),-1===t.resource.indexOf("#")){var n=this.getSpreadItems(t.resource);this.renderer.update(n,t.position)}else{this.newElementId=t.resource.slice(t.resource.indexOf("#")+1);var i=t.resource.slice(0,t.resource.indexOf("#"));if(i===this.renderer.getLocation())this.handleRenditionLoad(i);else{var n=this.getSpreadItems(i);this.renderer.update(n,t.position)}}},t.prototype.saveCurrentReadingPosition=function(e){return void 0===e&&(e=0),s(this,void 0,void 0,function(){var t;return a(this,function(){return this.annotator?(t=this.renderer.getLocation(),[2,this.annotator.saveLastReadingPosition({resource:t,position:e})]):[2,new Promise(function(e){return e()})]})})},t.FXL_VIEWPORT="width=device-width, initial-scale=1, maximum-scale=5, viewport-fit=cover, shrink-to-fit=no",t.SPREADS_HINT_KEY="fxl-spreads-hint",t}(n["default"]);t["default"]=b}.apply(t,i))!==undefined&&(e.exports=r)},"./src/HTMLUtilities.ts":function(e,t,n){var i,r;i=[n,t],(r=function(e,t){"use strict";function n(e,t){return e.querySelector(t)}function i(e,t){var i=n(e,t);if(i)return i;throw"required element "+t+" not found"}function r(e,t){if(null===e)throw"parent element is null";return e.querySelector(t)}function o(e,t){var n=r(e,t);if(n)return n;throw"required element "+t+" not found in iframe"}function s(e,t,n){e.setAttribute(t,n)}function a(e,t){e.removeAttribute(t)}function l(e,t,n){var i=e.querySelector("head"),r=document.createElement("style");r.id=t,r.textContent=n,i.appendChild(r)}function c(e,t){var n=e.querySelector("head"),i=n.querySelector("#"+t);n.removeChild(i)}Object.defineProperty(t,"__esModule",{value:!0}),t.findElement=n,t.findRequiredElement=i,t.findIframeElement=r,t.findRequiredIframeElement=o,t.setAttr=s,t.removeAttr=a,t.createStylesheet=l,t.removeStylesheet=c}.apply(t,i))!==undefined&&(e.exports=r)},"./src/IFrameHandler.ts":function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i["throw"](e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}l((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}},l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/EventHandler.ts"),n("./src/EpubReadingSystem.ts"),n("./src/HTMLUtilities.ts")],(r=function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a(n),r=l(r);var c=function(){function e(e,t,i,o,s){void 0===i&&(i="reflow"),void 0===o&&(o="renderer-frame"),void 0===s&&(s="Book text"),this.store=e,this.render(t,o,s),this.iFrame=r.findRequiredElement(t,"#"+o),this.type=i,this.eventHandler=new n["default"]}return e.prototype.render=function(e,t,n){var i=document.createElement("iframe");i.title=n,i.setAttribute("style","border:0; overflow: hidden"),i.tabIndex=-1,i.id=t,e.appendChild(i)},e.prototype.updateContext=function(){var e=this.iFrame.contentWindow,t=this.iFrame.contentDocument,n=r.findRequiredElement(t,"html"),i=r.findRequiredElement(t,"head"),o=r.findRequiredElement(t,"body");this.iFrameWindow={window:e,document:t,documentElement:n,head:i,body:o}},e.prototype.getEventContext=function(){var e="/";return this.iFrameWindow.document&&this.iFrameWindow.document.location&&this.iFrameWindow.document.location.pathname&&(e=this.iFrameWindow.document.location.pathname),e},e.prototype.setupHandler=function(){"fxl"===this.type?this.eventHandler.setupEvents(this.iFrameWindow.document,this.getEventContext(),!0):this.eventHandler.setupEvents(this.iFrameWindow.document,this.getEventContext())},e.prototype.handleAuth=function(){if(this.iFrameWindow.document&&"error_statusText: not_logged_in"===this.iFrameWindow.document.title)return window.location.reload()},e.prototype.injectEpubRS=function(){var e=Object.freeze(i.epubReadingSystemObject);Object.defineProperty(this.iFrameWindow.window.navigator,"epubReadingSystem",{value:e,writable:!1})},e.prototype.disableSelection=function(){this.iFrameWindow.body.style.webkitUserSelect="none",this.iFrameWindow.body.style.MozUserSelect="none",this.iFrameWindow.body.style.msUserSelect="none",this.iFrameWindow.body.style.userSelect="none"},e.prototype.load=function(e){!this.iFrameWindow||navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")?this.iFrame.src=e:this.iFrameWindow.window.location.replace(e)},e.prototype.handleLoad=function(){this.updateContext(),this.handleAuth(),this.injectEpubRS(),this.disableSelection(),this.setupHandler()},e.prototype.getEventHandler=function(){return this.eventHandler},e.prototype.getLocation=function(){var e=this.iFrame.src;return this.iFrameWindow&&this.iFrameWindow.document&&this.iFrameWindow.document.location&&this.iFrameWindow.document.location.href&&(e=this.iFrameWindow.document.location.href),e},e.prototype.getViewport=function(){return o(this,void 0,void 0,function(){var e,t,n,i,r;return s(this,function(o){switch(o.label){case 0:return[4,this.store.get("viewport")];case 1:return(e=o.sent())?(this.bookViewport=JSON.parse(e),[3,4]):[3,2];case 2:return t=this.iFrameWindow.head.querySelector("meta[name=viewport]"),n=t.content,n=n.replace(/\s+/g,""),i={},r=n.split(","),r.forEach(function(e){var t=e.split("=");i[t[0]]=parseFloat(t[1])}),this.bookViewport=i,[4,this.store.set("viewport",JSON.stringify(this.bookViewport))];case 3:o.sent(),o.label=4;case 4:return[2,this.bookViewport]}})})},e}();t["default"]=c}.apply(t,i))!==undefined&&(e.exports=r)},"./src/Icons.ts":function(e,t,n){var i,r;i=[n,t],(r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WIDTH_ATTR=24,t.HEIGHT_ATTR=24,t.VIEWBOX_ATTR="2.5 0 19 19",
t.makeIconTemplate=function(e,n,i,r){return void 0===r&&(r="icon"),'<svg xmlns="http://www.w3.org/2000/svg" width="'+t.WIDTH_ATTR+'" height="'+t.HEIGHT_ATTR+'" viewBox="'+t.VIEWBOX_ATTR+'" preserveAspectRatio="xMidYMid meet" role="img" class="'+r+'" aria-labelledBy="'+e+'">\n  <title id="'+e+'">'+n+"</title>\n  "+i+"\n</svg>"},t.makeIconSymbol=function(e,n,i,r){return void 0===r&&(r="svgIcon use"),'<svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" role="img" class="'+r+'">\n  <defs>\n    <symbol id="'+e+'" viewBox="'+t.VIEWBOX_ATTR+'">\n      <title>'+n+"</title>\n      "+i+"\n    </symbol>\n  </defs>\n</svg>"},t.makeIconUse=function(e,t){return'<svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" class="'+t+'" role="img" aria-labelledby="'+e+'">\n  <use xlink:href="#'+e+'"></use>\n</svg>'},t.icons={check:'<path d="M12 .96C7.236.96 3.36 4.836 3.36 9.6s3.876 8.64 8.64 8.64c4.764 0 8.641-3.877 8.641-8.64 0-4.764-3.877-8.64-8.641-8.64zm0 16.669c-4.427 0-8.029-3.602-8.029-8.029S7.573 1.571 12 1.571s8.029 3.602 8.029 8.029-3.602 8.029-8.029 8.029z"/><path d="M15.711 6.731a.307.307 0 0 0-.43.046l-2.87 3.565-1.162 1.444-1.341-1.206-1.222-1.1a.306.306 0 1 0-.409.455l1.222 1.1 1.444 1.3a.486.486 0 0 0 .361.123.478.478 0 0 0 .336-.179l1.248-1.551 2.87-3.565a.31.31 0 0 0-.047-.432z"/>',close:'<path d="M12 .96C7.236.96 3.36 4.836 3.36 9.6s3.876 8.64 8.64 8.64c4.764 0 8.641-3.877 8.641-8.64 0-4.764-3.877-8.64-8.641-8.64zm0 16.669c-4.427 0-8.029-3.602-8.029-8.029S7.573 1.571 12 1.571s8.029 3.602 8.029 8.029-3.602 8.029-8.029 8.029z"/><path d="M14.994 6.606a.304.304 0 0 0-.432 0L12 9.168 9.438 6.606a.306.306 0 0 0-.432.432L11.568 9.6l-2.562 2.562a.304.304 0 0 0 0 .432.3.3 0 0 0 .216.09.3.3 0 0 0 .216-.09L12 10.032l2.562 2.562c.059.061.138.09.216.09s.156-.029.216-.09a.306.306 0 0 0 0-.432L12.432 9.6l2.562-2.562a.306.306 0 0 0 0-.432z"/>',error:'<path d="M12 11.789a.306.306 0 0 0 .306-.306V6.869a.307.307 0 0 0-.612 0v4.614c0 .169.137.306.306.306z"/><circle cx="12" cy="13.812" r=".74"/><path d="M14.004 3.206c-.52-.9-1.23-1.396-2.004-1.396-.773 0-1.484.496-2.004 1.396L3.811 13.918c-.52.9-.593 1.765-.207 2.434.387.67 1.172 1.038 2.211 1.038h12.37c1.039 0 1.824-.368 2.211-1.038.386-.669.312-1.533-.207-2.434L14.004 3.206zm5.862 12.841c-.272.472-.87.731-1.682.731H5.815c-.812 0-1.409-.26-1.682-.731-.273-.473-.199-1.12.207-1.822l6.185-10.713c.406-.703.93-1.09 1.475-1.09s1.068.387 1.475 1.09l6.186 10.713c.404.702.478 1.349.205 1.822z"/>',expand:'<path d="M3.666 7.286a.306.306 0 0 0 .306-.306V2.003L9.47 7.501a.308.308 0 0 0 .432 0 .305.305 0 0 0 0-.433L4.403 1.571h4.978a.306.306 0 0 0 0-.611h-5.53a.444.444 0 0 0-.105.012.306.306 0 0 0-.297.077.306.306 0 0 0-.077.297.52.52 0 0 0-.012.105v5.53c0 .168.137.305.306.305zM20.551 1.049a.308.308 0 0 0-.297-.078.504.504 0 0 0-.105-.012H14.62a.306.306 0 0 0 0 .612h4.978L14.1 7.069a.304.304 0 0 0 .216.521.31.31 0 0 0 .216-.089l5.498-5.498V6.98a.306.306 0 1 0 .612 0V1.451a.457.457 0 0 0-.013-.105.309.309 0 0 0-.078-.297zM3.449 18.15a.3.3 0 0 0 .296.078.52.52 0 0 0 .105.012h5.53a.306.306 0 0 0 0-.612H4.403l5.498-5.498a.305.305 0 1 0-.432-.433l-5.498 5.498v-4.977a.307.307 0 0 0-.612 0v5.53c0 .036.004.071.012.106a.306.306 0 0 0 .078.296zM20.334 11.914a.306.306 0 0 0-.305.306v4.977l-5.498-5.498a.306.306 0 0 0-.432.433l5.497 5.498h-4.978a.306.306 0 0 0 0 .612h5.53a.52.52 0 0 0 .105-.012.304.304 0 0 0 .373-.374.457.457 0 0 0 .013-.105v-5.53a.304.304 0 0 0-.305-.307z"/>',libHandler:'<path d="M13.997 6.354l-.061-.009a3.63 3.63 0 0 0-3.497-2.713 3.628 3.628 0 0 0-3.521 2.812A3.15 3.15 0 0 0 3.5 9.578a3.153 3.153 0 0 0 3.111 3.148 3.15 3.15 0 0 0 3.109 2.686h7.587a3.152 3.152 0 0 0 3.148-3.146 3.152 3.152 0 0 0-3.419-3.136 3.63 3.63 0 0 0-3.039-2.776m4.764 3.816a2.55 2.55 0 0 1 1.096 2.094 2.552 2.552 0 0 1-2.547 2.549H9.721a2.552 2.552 0 0 1-2.548-2.549 2.551 2.551 0 0 1 3.008-2.505c.08.018.164-.003.229-.051s.108-.121.122-.201a3.021 3.021 0 0 1 2.981-2.588 3.023 3.023 0 0 1 2.98 2.588.302.302 0 0 0 .351.252 2.525 2.525 0 0 1 1.917.411M4.099 9.578a2.552 2.552 0 0 1 3.01-2.504.3.3 0 0 0 .351-.253 3.023 3.023 0 0 1 2.981-2.588c1.32 0 2.475.871 2.866 2.093a3.624 3.624 0 0 0-3.314 2.8 3.151 3.151 0 0 0-3.414 2.997 2.548 2.548 0 0 1-2.48-2.545z"/><path id="libHandler-add" d="M20.171 4.908h-1.607V3.3a.3.3 0 0 0-.602 0v1.608h-1.607a.3.3 0 1 0 0 .6h1.607v1.609a.3.3 0 0 0 .602 0V5.508h1.607a.3.3 0 1 0 0-.6z"/><path id="libHandler-exist" d="M16.197 5.051l.309.262.508.427c.002.003.004.01.006.003l-.16.655-.098.392c-.072.294.04.427.113.479.03.022.092.058.178.058a.4.4 0 0 0 .211-.067l.267-.164.722-.448c.004-.001.012-.001.005-.005l.573.355.344.213a.554.554 0 0 0 .291.096.317.317 0 0 0 .191-.06c.054-.039.172-.156.113-.394l-.08-.329-.002-.001-.189-.771c0-.003.002-.011-.003-.006l.516-.435.31-.262c.219-.184.19-.362.168-.432-.021-.068-.104-.23-.389-.25l-.404-.03-.663-.047c-.003-.001-.009-.005-.007.001l-.254-.624-.153-.375c-.108-.263-.288-.292-.36-.292-.07 0-.252.028-.357.293l-.153.375-.25.615c-.002.003-.008.008-.001.006l-.673.049-.401.03c-.284.021-.368.182-.392.25-.025.07-.054.249.164.433zm.658-.268l.672-.049a.466.466 0 0 0 .375-.272l.256-.625.1-.244.1.244.256.625a.46.46 0 0 0 .375.272l.673.049.263.02-.201.17-.517.437a.458.458 0 0 0-.145.44l.191.782.031.128-.225-.139-.572-.356a.465.465 0 0 0-.465 0l-.729.454h-.001l-.063.041.062-.256.16-.655a.453.453 0 0 0-.145-.44l-.516-.436-.201-.17.266-.02z"/>',loading:'<path d="M17.592 12.781a.304.304 0 0 0-.422.092 6.056 6.056 0 0 1-6.167 2.711A6.086 6.086 0 0 1 5.99 9.876l1.789 1.687a.305.305 0 1 0 .419-.444L6.041 9.084a.495.495 0 0 0-.356-.132.487.487 0 0 0-.341.166l-1.909 2.188a.305.305 0 0 0 .46.403l1.489-1.707a6.7 6.7 0 0 0 6.677 6.286 6.668 6.668 0 0 0 5.623-3.084.306.306 0 0 0-.092-.423zM20.104 7.492l-1.488 1.707a6.7 6.7 0 0 0-5.506-6.184 6.664 6.664 0 0 0-6.793 2.982.305.305 0 1 0 .514.329 6.06 6.06 0 0 1 6.167-2.71 6.085 6.085 0 0 1 5.013 5.707l-1.789-1.687a.305.305 0 1 0-.419.445l2.157 2.035c.09.085.21.132.332.132h.023a.483.483 0 0 0 .341-.166l1.909-2.188a.306.306 0 0 0-.461-.402z"/>',menu:'<circle cx="12.126" cy="3.237" r="1.376"/><circle cx="12.125" cy="9.6" r="1.375"/><circle cx="12.125" cy="15.962" r="1.375"/>',next:'<path d="M12 18.24c4.764 0 8.641-3.877 8.641-8.64 0-4.764-3.877-8.64-8.641-8.64S3.36 4.836 3.36 9.6s3.876 8.64 8.64 8.64zm0-16.669c4.427 0 8.029 3.602 8.029 8.029S16.427 17.629 12 17.629 3.971 14.027 3.971 9.6 7.573 1.571 12 1.571z"/><path d="M10.58 13.335a.305.305 0 0 0 .432 0L14.4 9.947a.492.492 0 0 0 0-.694l-3.388-3.388a.306.306 0 0 0-.432.432L13.883 9.6l-3.303 3.302a.305.305 0 0 0 0 .433z"/>',previous:'<path d="M12 .96C7.236.96 3.36 4.836 3.36 9.6s3.876 8.64 8.64 8.64c4.764 0 8.641-3.877 8.641-8.64 0-4.764-3.877-8.64-8.641-8.64zm0 16.669c-4.427 0-8.029-3.602-8.029-8.029S7.573 1.571 12 1.571s8.029 3.602 8.029 8.029-3.602 8.029-8.029 8.029z"/><path d="M13.42 5.865a.306.306 0 0 0-.432 0L9.6 9.253a.492.492 0 0 0 0 .694l3.388 3.388c.059.06.138.089.216.089s.156-.029.216-.089a.307.307 0 0 0 0-.433L10.117 9.6l3.303-3.303a.306.306 0 0 0 0-.432z"/>',left:'<path d="M13.42 5.865a.306.306 0 0 0-.432 0L9.6 9.253a.492.492 0 0 0 0 .694l3.388 3.388c.059.06.138.089.216.089s.156-.029.216-.089a.307.307 0 0 0 0-.433L10.117 9.6l3.303-3.303a.306.306 0 0 0 0-.432z"/>',minimize:'<path d="M8.947 6.979H3.97a.307.307 0 0 0 0 .612H9.5a.457.457 0 0 0 .105-.012.308.308 0 0 0 .296-.077.304.304 0 0 0 .077-.296.473.473 0 0 0 .013-.106V1.57a.307.307 0 0 0-.612 0v4.977L3.882 1.049a.307.307 0 0 0-.433 0 .307.307 0 0 0 0 .433l5.498 5.497zM20.551 1.049a.307.307 0 0 0-.433 0l-5.497 5.498V1.57a.306.306 0 1 0-.612 0V7.1c0 .036.004.071.012.105a.304.304 0 0 0 .293.385.303.303 0 0 0 .08-.012.52.52 0 0 0 .105.012h5.529a.306.306 0 1 0 0-.612h-4.977l5.498-5.498a.303.303 0 0 0 .002-.431zM3.666 18.24a.299.299 0 0 0 .216-.09l5.498-5.498v4.978a.306.306 0 1 0 .612 0V12.1a.457.457 0 0 0-.012-.105.303.303 0 0 0-.373-.374.52.52 0 0 0-.105-.012H3.97a.307.307 0 0 0 0 .612h4.977L3.449 17.72a.306.306 0 0 0 0 .432c.06.059.138.088.217.088zM14.01 17.63a.306.306 0 1 0 .612 0v-4.978l5.498 5.498a.304.304 0 0 0 .432 0 .306.306 0 0 0 0-.432l-5.498-5.499h4.977a.306.306 0 1 0 0-.612H14.5a.457.457 0 0 0-.105.012.304.304 0 0 0-.373.374.457.457 0 0 0-.012.105v5.532z"/>',right:'<path d="M10.58 13.335a.305.305 0 0 0 .432 0L14.4 9.947a.492.492 0 0 0 0-.694l-3.388-3.388a.306.306 0 0 0-.432.432L13.883 9.6l-3.303 3.302a.305.305 0 0 0 0 .433z"/>',settings:'<path d="M19.836 7.818l-1.228-.205c-.366-.061-.621-.222-.718-.454-.096-.232-.029-.526.188-.828l.723-1.013a.982.982 0 0 0-.102-1.239l-1.18-1.178a.968.968 0 0 0-.685-.274.962.962 0 0 0-.554.172l-1.01.723c-.21.149-.42.229-.606.229-.349 0-.597-.277-.677-.76l-.205-1.228a.98.98 0 0 0-.947-.804h-1.667a.982.982 0 0 0-.948.804l-.205 1.228c-.081.483-.327.76-.676.76-.187 0-.396-.079-.605-.229l-1.015-.723a.957.957 0 0 0-.553-.172c-.261 0-.511.1-.686.274L5.301 4.08a.981.981 0 0 0-.102 1.238l.724 1.013c.216.303.282.597.186.829-.096.231-.351.392-.717.453l-1.228.205a.984.984 0 0 0-.804.949v1.667c0 .457.353.873.804.948l1.228.204c.367.061.621.223.717.454.096.231.03.525-.187.828l-.724 1.013a.981.981 0 0 0 .103 1.238l1.179 1.18a.974.974 0 0 0 .686.274.955.955 0 0 0 .553-.173l1.013-.723c.209-.15.419-.229.606-.229.349 0 .596.276.676.759l.205 1.229c.076.45.492.804.949.804h1.667a.981.981 0 0 0 .947-.804l.205-1.229c.08-.482.326-.759.676-.759.188 0 .396.078.606.229l1.013.723a.957.957 0 0 0 .553.173.979.979 0 0 0 .686-.274l1.179-1.18a.982.982 0 0 0 .103-1.238l-.724-1.013c-.216-.302-.282-.596-.187-.828.096-.232.351-.393.717-.454l1.229-.204a.985.985 0 0 0 .805-.949V8.767a.989.989 0 0 0-.807-.949zm.193 2.616c0 .155-.141.32-.293.346l-1.229.204c-.582.097-1.002.389-1.182.823-.18.434-.089.937.254 1.417l.724 1.013a.376.376 0 0 1-.037.451l-1.179 1.18c-.105.104-.33.124-.451.037l-1.013-.725c-.313-.224-.646-.342-.962-.342-.658 0-1.148.486-1.279 1.27l-.203 1.229a.38.38 0 0 1-.346.293h-1.667a.378.378 0 0 1-.345-.293l-.205-1.229c-.131-.783-.621-1.27-1.279-1.27-.315 0-.647.118-.961.342l-1.013.725a.394.394 0 0 1-.451-.037l-1.179-1.18a.378.378 0 0 1-.037-.451l.724-1.013c.343-.48.433-.983.253-1.417s-.599-.726-1.181-.823l-1.229-.204a.378.378 0 0 1-.292-.346V8.767c0-.155.14-.32.292-.346l1.229-.205c.582-.097 1.001-.389 1.181-.823s.09-.936-.253-1.417l-.724-1.013a.378.378 0 0 1 .038-.451l1.179-1.179a.392.392 0 0 1 .452-.037l1.011.724c.313.224.646.342.96.342.658 0 1.148-.487 1.279-1.271l.205-1.228a.379.379 0 0 1 .346-.293h1.667a.38.38 0 0 1 .345.293l.204 1.228c.131.784.621 1.271 1.279 1.271.315 0 .647-.118.961-.342l1.014-.724c.121-.087.346-.068.451.037l1.178 1.179c.11.11.128.325.038.451l-.723 1.014c-.344.48-.434.983-.254 1.417s.6.726 1.182.823l1.229.205a.38.38 0 0 1 .292.346v1.666z"/><path d="M12 6.238A3.365 3.365 0 0 0 8.639 9.6c0 1.853 1.508 3.361 3.361 3.361s3.361-1.508 3.361-3.361A3.365 3.365 0 0 0 12 6.238zm0 6.112A2.753 2.753 0 0 1 9.25 9.6c0-1.517 1.233-2.75 2.75-2.75s2.75 1.234 2.75 2.75A2.753 2.753 0 0 1 12 12.35z"/>',toc:'<path d="M5.539 1.241A2.182 2.182 0 0 0 3.36 3.42c0 1.202.978 2.179 2.179 2.179s2.178-.977 2.178-2.179a2.18 2.18 0 0 0-2.178-2.179zm0 3.746c-.864 0-1.567-.703-1.567-1.567s.703-1.567 1.567-1.567 1.567.703 1.567 1.567-.703 1.567-1.567 1.567zM20.334 3.114H9.944a.307.307 0 0 0 0 .612h10.39a.306.306 0 1 0 0-.612zM5.539 7.421A2.181 2.181 0 0 0 3.36 9.6c0 1.201.978 2.179 2.179 2.179s2.178-.978 2.178-2.179a2.181 2.181 0 0 0-2.178-2.179zm0 3.746c-.864 0-1.567-.703-1.567-1.567s.703-1.567 1.567-1.567a1.568 1.568 0 0 1 0 3.134zM20.334 9.294H9.944a.307.307 0 0 0 0 .612h10.39a.307.307 0 0 0 .307-.306.307.307 0 0 0-.307-.306zM5.539 13.602a2.182 2.182 0 0 0-2.179 2.179c0 1.202.978 2.179 2.179 2.179s2.178-.977 2.178-2.179a2.18 2.18 0 0 0-2.178-2.179zm0 3.746a1.569 1.569 0 0 1-1.567-1.566c0-.865.703-1.568 1.567-1.568s1.567.703 1.567 1.568a1.57 1.57 0 0 1-1.567 1.566zM20.334 15.475H9.944a.306.306 0 1 0 0 .612h10.39a.306.306 0 1 0 0-.612z"/>',cart:'<path d="M16.77 4.349H4.9l-.411-1.94C4.322 1.618 3.592 1 2.827 1h-1.52C1.138 1 1 1.146 1 1.325s.138.325.307.325h1.521c.473 0 .959.412 1.062.898l.687 3.24 1.286 6.075c.167.789.896 1.407 1.662 1.407h6.68c.641 0 1.32-.498 1.547-1.134l1.094-3.08 1.061-2.979c.156-.44.122-.881-.095-1.211-.218-.328-.597-.517-1.042-.517zm.558 1.502l-1.275 3.59-.879 2.471c-.135.379-.588.712-.972.712H7.521c-.473 0-.959-.412-1.062-.899L5.173 5.649 5.036 5h11.732c.243 0 .434.085.533.239.103.153.113.371.027.612z"/><path class="purple-icon-frag" d="M9.533 16.109c0-1.043-.803-1.892-1.789-1.892s-1.789.849-1.789 1.892S6.758 18 7.744 18s1.789-.848 1.789-1.891zm-2.963 0c0-.686.525-1.241 1.174-1.241.646 0 1.174.557 1.174 1.241s-.527 1.239-1.174 1.239c-.647.002-1.174-.555-1.174-1.239z"/><path class="purple-icon-frag" d="M15.398 16.109c0-1.043-.804-1.892-1.791-1.892-.985 0-1.787.849-1.787 1.892S12.622 18 13.607 18c.989 0 1.791-.848 1.791-1.891zm-2.962 0c0-.686.525-1.241 1.174-1.241.647 0 1.175.557 1.175 1.241s-.527 1.239-1.175 1.239c-.649.001-1.174-.555-1.174-1.239z"/>'}}.apply(t,i))!==undefined&&(e.exports=r)},"./src/LibHandler.ts":function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i["throw"](e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}l((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}},l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/Toast.ts"),n("./src/HTMLUtilities.ts"),n("./src/Templates.ts"),n("./src/Locales.ts")],(r=function(e,t,n,i,r,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a(n),i=l(i),r=l(r),c=l(c);var u=function(){function e(e){this.toast=null,this.streamerIdentifier=e.streamer_identifier,this.redirectUrl=e.redirect_url,this.status=e.status,this.token=this.getCsrfToken()}return e.prototype.renderLibHandler=function(t,n,a){return void 0===a&&(a="en"),o(this,void 0,void 0,function(){var o;return s(this,function(s){switch(s.label){case 0:return this.store=t,this.locale=a,n.innerHTML=r.libHandlerTemplate(this.locale),this.libHandlerButton=i.findRequiredElement(n,"#lib-handler"),this.setupEvents(),[4,this.store.get(e.STATE_KEY)];case 1:return o=s.sent(),"true"!==o?[3,3]:[4,this.updateStatus()];case 2:return s.sent(),[3,9];case 3:return this.status?this.status!==e.UNAUTHORIZED?[3,4]:(this.handleRedirect(),[3,9]):[3,9];case 4:return this.status!==e.CONFLICT?[3,6]:[4,this.handleConflict()];case 5:return s.sent(),[3,9];case 6:return this.status!==e.ERROR?[3,7]:(this.handleError(),[3,9]);case 7:return this.status!==e.OK?[3,9]:[4,this.handleOK()];case 8:s.sent(),s.label=9;case 9:return[2]}})})},e.prototype.setupEvents=function(){var e=this;this.libHandlerButton.addEventListener("click",function(t){return o(e,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return this.toast?[3,2]:[4,this.handleRequest()];case 1:e.sent(),e.label=2;case 2:return t.preventDefault(),[2]}})})})},e.prototype.handleRequest=function(){return o(this,void 0,void 0,function(){var t,n=this;return s(this,function(){return t={streamer_identifier:this.streamerIdentifier},this.token?window.fetch("/my_books/readable_samples",{method:"POST",body:JSON.stringify(t),credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-Token":this.token}}).then(function(t){return o(n,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return t.ok?[3,5]:t.status!==e.UNAUTHORIZED?[3,1]:(this.handleRedirect(),[3,4]);case 1:return t.status!==e.CONFLICT?[3,3]:[4,this.handleConflict()];case 2:return n.sent(),[3,4];case 3:this.handleError(),n.label=4;case 4:return[3,7];case 5:return[4,this.handleOK()];case 6:n.sent(),n.label=7;case 7:return[2]}})})})["catch"](function(){n.handleError()}):this.handleError(),[2]})})},e.prototype.getCsrfToken=function(){var e=document.head.querySelector("meta[name=csrf-token]");return e?e.content:undefined},e.prototype.popToast=function(e,t,i){var r=this;void 0===t&&(t="bottom"),void 0===i&&(i=6e3),this.toast||(this.toast=new n["default"](e,t,i),this.toast.onToastDelete(function(){return r.toast=null}))},e.prototype.updateStatus=function(){return o(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return t=i.findRequiredElement(this.libHandlerButton,"svg"),t.classList.contains("sample-added")?(t.classList.remove("sample-added"),this.libHandlerButton.disabled=!1,[4,this.store.remove(e.STATE_KEY)]):[3,2];case 1:return n.sent(),[3,4];case 2:return t.classList.add("sample-added"),this.libHandlerButton.disabled=!0,[4,this.store.set(e.STATE_KEY,"true")];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e.prototype.handleOK=function(){return o(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return this.popToast(c.locales.libAdded[this.locale]),[4,this.updateStatus()];case 1:return e.sent(),[2]}})})},e.prototype.handleConflict=function(){return o(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return this.popToast(c.locales.libExists[this.locale]),[4,this.updateStatus()];case 1:return e.sent(),[2]}})})},e.prototype.handleError=function(){this.popToast(c.locales.libError[this.locale])},e.prototype.handleRedirect=function(){window.location.assign(this.redirectUrl)},e.prototype.hideForSR=function(){this.libHandlerButton.setAttribute("aria-hidden","true")},e.prototype.showForSR=function(){this.libHandlerButton.setAttribute("aria-hidden","false")},e.prototype.hideForKeyboard=function(){this.libHandlerButton.tabIndex=-1},e.prototype.showForKeyboard=function(){this.libHandlerButton.tabIndex=0},e.OK=200,e.UNAUTHORIZED=401,e.CONFLICT=409,e.ERROR=500,e.STATE_KEY="added-to-lib",e}();t["default"]=u}.apply(t,i))!==undefined&&(e.exports=r)},"./src/LocalAnnotator.ts":function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i["throw"](e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}l((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};i=[n,t],(r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.store=e.store}return e.prototype.getLastReadingPosition=function(){return o(this,void 0,void 0,function(){var t,n;return s(this,function(i){switch(i.label){case 0:return[4,this.store.get(e.LAST_READING_POSITION)];case 1:return t=i.sent(),t?(n=JSON.parse(t),[2,new Promise(function(e){return e(n)})]):[2,new Promise(function(e){return e()})]}})})},e.prototype.saveLastReadingPosition=function(t){return o(this,void 0,void 0,function(){var n;return s(this,function(i){switch(i.label){case 0:return n=JSON.stringify(t),[4,this.store.set(e.LAST_READING_POSITION,n)];case 1:return i.sent(),[2,new Promise(function(e){return e()})]}})})},e.prototype.resetReadingPosition=function(){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.store.remove(e.LAST_READING_POSITION)];case 1:return t.sent(),[2,new Promise(function(e){return e()})]}})})},e.LAST_READING_POSITION="last-reading-position",e}();t["default"]=n}.apply(t,i))!==undefined&&(e.exports=r)},"./src/LocalStorageStore.ts":function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i["throw"](e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}l((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};i=[n,t,n("./src/MemoryStore.ts")],(r=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a(n);var i=function(){function e(e){this.prefix=e.prefix;try{var t=e.prefix+"-"+String(Math.random());window.localStorage.setItem(t,"test"),window.localStorage.removeItem(t),this.fallbackStore=null}catch(e){this.fallbackStore=new n["default"]}}return e.prototype.getLocalStorageKey=function(e){return this.prefix+"-"+e},e.prototype.get=function(e){return o(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return t=null,this.fallbackStore?[3,1]:(t=window.localStorage.getItem(this.getLocalStorageKey(e)),[3,3]);case 1:return[4,this.fallbackStore.get(e)];case 2:t=n.sent(),n.label=3;case 3:return[2,new Promise(function(e){return e(t)})]}})})},e.prototype.set=function(e,t){return o(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return this.fallbackStore?[3,1]:(window.localStorage.setItem(this.getLocalStorageKey(e),t),[3,3]);case 1:return[4,this.fallbackStore.set(e,t)];case 2:n.sent(),n.label=3;case 3:return[2,new Promise(function(e){return e()})]}})})},e.prototype.remove=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.fallbackStore?[3,1]:(window.localStorage.removeItem(this.getLocalStorageKey(e)),[3,3]);case 1:return[4,this.fallbackStore.remove(e)];case 2:t.sent(),t.label=3;case 3:return[2,new Promise(function(e){return e()})]}})})},e}();t["default"]=i}.apply(t,i))!==undefined&&(e.exports=r)},"./src/Locales.ts":function(e,t,n){var i,r;i=[n,t],(r=function(e,t){"use strict";function n(){return function(e){return e}}Object.defineProperty(t,"__esModule",{value:!0});var i=["en","de","fr","ca","es","nl","da","pt-BR","ru"];t.localeAvailable=function(e){return i.indexOf(e)>=0},t.locales=n()({errorLabel:{en:"There was an error loading this page.",de:"Beim Laden dieser Seite ist ein Fehler aufgetreten.",fr:"Nous avons rencontr\xe9 une erreur en chargeant cette page.",ca:"Hi ha hagut un error en carregar la p\xe0gina.",es:"Ha habido un error al cargar esta p\xe1gina.",nl:"Fout bij het laden van de pagina.",da:"Fejl ved indl\xe6sning af side.","pt-BR":"Ocorreu um erro carregando esta p\xe1gina.",ru:"\u041f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430."},goBack:{en:"Go back",de:"Geh Zur\xfcck",fr:"Revenir en arri\xe8re",ca:"Tornar enrera",es:"Volver atr\xe1s",nl:"Ga terug",da:"G\xe5 tilbage","pt-BR":"Voltar",ru:"\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f"},tryAgain:{en:"Try again",de:"Bitte Nochmals Versuchen",fr:"R\xe9essayer",ca:"Provar de nou",es:"Intentar de nuevo",nl:"Probeer opnieuw",da:"Pr\xf8v igen","pt-BR":"Tente novamente",ru:"\u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0441\u043d\u043e\u0432\u0430"},tosDefault:{en:"Terms of Service",de:"Impressum",fr:"Conditions d\u2019utilisation",ca:"Condicions del servei",es:"Condiciones del servicio",nl:"Algemene voorwaarden",da:"Servicebetingelser","pt-BR":"Termos de uso",ru:"\u0423\u0441\u043b\u043e\u0432\u0438\u044f \u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f"},scrollingSuggestion:{en:"We recommend scrolling mode for use with screen readers and keyboard navigation.\nGo to settings to switch to scrolling mode.",de:"Wir empfehlen den Bildlaufmodus f\xfcr Bildschirmleseger\xe4te und f\xfcr die Navigation mit der Tastatur.\nUnter der Option Einstellungen, ist es m\xf6glich den Bildlaufmodus zu wechseln.",fr:"Il est recommand\xe9 d\u2019utilis\xe9 le mode D\xe9fil\xe9 dans les pr\xe9f\xe9rences si vous utilisez un lecteur d\u2019\xe9cran ou naviguez au clavier.",ca:"Recomanem el mode de despla\xe7ament si utilitza un lector de pantalla o navega amb el teclat.\nVagi a Ajustos per canviar a mode de despla\xe7ament.",es:"Recomendamos el modo desplazamiento si usted utiliza un lector de pantalla o navega con el teclado.\nVaya a ajustes para cambiar a modo desplazamiento",nl:"Kies Scrollen in plaats van Per pagina bij gebruik van een screen reader met toetsenbordnavigatie.\nGa naar Instellingen om dit aan te passen.",da:"Scrolle-tilstand anbefales til sk\xe6rml\xe6sning og navigation vha. tastatur.\nG\xe5 til indstillinger og sl\xe5 scrolle-tilstand til.","pt-BR":"Recomendamos acionar modo de Rolagem para usu\xe1rios utilizando leitores de tela ou navega\xe7\xe3o pelo teclado.\nAcesse as configura\xe7\xf5es e altere para modo Rolagem",ru:"\u041c\u044b \u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u0436\u0438\u043c \u043f\u0440\u043e\u043a\u0440\u0443\u0442\u043a\u0438 \u0434\u043b\u044f \u0447\u0442\u0435\u043d\u0438\u044f \u0441 \u044d\u043a\u0440\u0430\u043d\u043d\u044b\u043c \u0441\u0447\u0438\u0442\u044b\u0432\u0430\u044e\u0449\u0438\u043c \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u043e\u043c \u0438 \u043d\u0430\u0432\u0438\u0433\u0430\u0446\u0438\u0438 \u043f\u043e \u043a\u043b\u0430\u0432\u0438\u0430\u0442\u0443\u0440\u0435.\n\u0417\u0430\u0439\u0434\u0438\u0442\u0435 \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438, \u0447\u0442\u043e\u0431\u044b \u043f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u0440\u0435\u0436\u0438\u043c \u043f\u0440\u043e\u043a\u0440\u0443\u0442\u043a\u0438."},controlPanel:{en:"Controls",de:"Bedienfeld",fr:"Contr\xf4les",ca:"Taula de control",es:"Tabla de control",nl:"Instellingen",da:"Kontrolpanel","pt-BR":"Controles",ru:"\u0418\u043d\u0441\u0442\u0440\u0443\u043c\u0435\u043d\u0442\u044b"},contents:{en:"Contents",de:"Inhalt",fr:"Sommaire",ca:"Resum",es:"Sumario",nl:"Inhoudsopgave",da:"Indhold","pt-BR":"Sum\xe1rio",ru:"\u0421\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0435"},settings:{en:"Settings",de:"Einstellungen",fr:"Pr\xe9f\xe9rences",ca:"Ajustos",es:"Ajustes",nl:"Instellingen",da:"Indstillinger","pt-BR":"Configura\xe7\xe3o",ru:"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438"},previousChapter:{en:"Previous Chapter",de:"Vorheriges Kapitel",fr:"Chapitre pr\xe9c\xe9dent",ca:"Cap\xedtol anterior",es:"Cap\xedtulo anterior",nl:"Vorige hoofdstuk",da:"Forrige kapitel","pt-BR":"Cap\xedtulo anterior",ru:"\u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0430\u044f \u0433\u043b\u0430\u0432\u0430"},previousPage:{en:"Previous Page",de:"Vorherige Seite",fr:"Page pr\xe9c\xe9dente",ca:"P\xe0gina anterior",es:"P\xe1gina anterior",nl:"Vorige pagina",da:"Forrige side","pt-BR":"P\xe1gina anterior",ru:"\u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0430\u044f \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430"},nextChapter:{en:"Next Chapter",de:"N\xe4chstes Kapitel",fr:"Chapitre suivant",ca:"Cap\xedtol seg\xfcent",es:"Cap\xedtulo siguiente",nl:"Volgende hoofdstuk",da:"N\xe6ste kapitel","pt-BR":"Pr\xf3ximo cap\xedtulo",ru:"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f \u0433\u043b\u0430\u0432\u0430"},nextPage:{en:"Next Page",de:"N\xe4chste Seite",fr:"Page suivante",ca:"P\xe0gina seg\xfcent",es:"P\xe1gina siguiente",nl:"Volgende pagina",da:"N\xe6ste side","pt-BR":"Pr\xf3xima p\xe1gina",ru:"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f \u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430"},chapters:{en:"Chapters",de:"Kapitel",fr:"Chapitres",ca:"Cap\xedtols",es:"Cap\xedtulos",nl:"Hoofdstukken",da:"Kapitel","pt-BR":"Cap\xedtulos",ru:"\u0413\u043b\u0430\u0432\u044b"},pages:{en:"Pages",de:"Seiten",fr:"Pages",ca:"P\xe0gines",es:"P\xe1ginas",nl:"Pagina\u2019s",da:"Side","pt-BR":"P\xe1ginas",ru:"\u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b"},cacheUncached:{en:"",de:"",fr:"",ca:"",es:"",nl:"",da:"","pt-BR":"",ru:""},cacheUpdateAvailable:{en:"A new version is available. Refresh to update.",de:"Eine neue Version ist verf\xfcgbar. Bitte die Seite aktualiseren.",fr:"Rafraichissez la page pour t\xe9l\xe9charger la nouvelle version.",ca:"Hi ha una nova versi\xf3 disponible. Premi actualitzar per descarregar-la.",es:"Hay una nueva versi\xf3n disponible, pulse actualizar para descargarla.",nl:"Er is een nieuwe versie beschikbaar. Ververs om bij te werken.",da:"En ny version er tilg\xe6ngelig. Opdater venligst.","pt-BR":"Uma nova vers\xe3o est\xe1 dispon\xedvel. Recarregue para atualizar.",ru:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u0430 \u043d\u043e\u0432\u0430\u044f \u0432\u0435\u0440\u0441\u0438\u044f. \u041f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443."},cacheCheckingUpdate:{en:"Checking for update.",de:"Suche nach Updates.",fr:"V\xe9rification des mises \xe0 jour.",ca:"Buscant actualitzacions.",es:"Buscando actualizaciones.",nl:"Zoeken naar nieuwe versie\u2026",da:"S\xf8ger efter opdateringer.","pt-BR":"Verificando por nova atualiza\xe7\xe3o.",ru:"\u0418\u0434\u0435\u0442 \u043f\u043e\u0438\u0441\u043a \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f."},cacheDownloading:{en:"Downloading\u2026",de:"Wird heruntergeladen.",fr:"T\xe9l\xe9chargement des contenus.",ca:"Descarregant.",es:"Cargando.",nl:"Aan het downloaden\u2026",da:"Downloader\u2026","pt-BR":"Baixando.",ru:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430\u2026"},cacheDownloaded:{en:"Downloaded for offline use.",de:"F\xfcr den Offline-Gebrauch heruntergeladen.",fr:"Livre t\xe9l\xe9charg\xe9 pour lecture hors-ligne.",ca:"Descarregat per llegir-ho quan l'aparell estigui fora de cobertura.",es:"Cargado para leer cuando el aparato est\xe9 fuera de cobertura.",
nl:"Opgeslagen voor offline gebruik.",da:"Downloader til offline brug.","pt-BR":"Salvo para leitura sem internet.",ru:"\u0421\u043a\u0430\u0447\u0430\u043d\u043e \u0434\u043b\u044f \u0430\u0432\u0442\u043e\u043d\u043e\u043c\u043d\u043e\u0433\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f."},cacheError:{en:"Error downloading for offline use.",de:"Ein Fehler ist aufgetreten beim Herunterladen f\xfcr die Offline-Verwendung.",fr:"Nous avons rencontr\xe9 une erreur. Ce livre ne sera pas disponible hors-ligne.",ca:"Error durant la desc\xe0rrega per llegir fora de cobertura",es:"Error en la descarga para leer cuando el aparato est\xe9 fuera cobertura",nl:"Fout bij het downloaden voor offline gebruik.",da:"Der opstod en fejl under download til offline brug.","pt-BR":"Erro ao baixar para leitura sem internet.",ru:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0434\u043b\u044f \u0430\u0432\u0442\u043e\u043d\u043e\u043c\u043d\u043e\u0433\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f."},chapterTitle:{en:"Current Chapter",de:"Aktuelles Kapitel",fr:"Chapitre en cours",ca:"Cap\xedtol actual",es:"Cap\xedtulo actual",nl:"Huidige hoofdstuk",da:"Nuv\xe6rende kapitel","pt-BR":"Cap\xedtulo atual",ru:"\u0422\u0435\u043a\u0443\u0449\u0430\u044f \u0433\u043b\u0430\u0432\u0430"},chapterPositionPage:{en:"Page",de:"Seite",fr:"Page",ca:"P\xe0gina",es:"P\xe1gina",nl:"Pagina",da:"Side","pt-BR":"P\xe1gina",ru:"\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430"},chapterPositionOf:{en:"of",de:"von",fr:"de",ca:"de",es:"de",nl:"van",da:"af","pt-BR":"de",ru:"\u0438\u0437"},bookFontPublisher:{en:"Publisher",de:"Verlag",fr:"\xc9diteur",ca:"Editorial",es:"Editorial",nl:"Origineel",da:"Forlag","pt-BR":"Editora",ru:"\u0418\u0437\u0434\u0430\u0442\u0435\u043b\u044c"},bookFontSerif:{en:"Serif",de:"Serif",fr:"S\xe9rif",ca:"Serif",es:"Serif",nl:"Serif",da:"Serif","pt-BR":"Serifada",ru:"\u0421 \u0437\u0430\u0441\u0435\u0447\u043a\u0430\u043c\u0438"},bookFontSans:{en:"Sans-serif",de:"Serifenlos",fr:"Sans-s\xe9rif",ca:"Sans-serif",es:"Sans-serif",nl:"Sans-serif",da:"Sans-serif","pt-BR":"Sem Serifas",ru:"\u0411\u0435\u0437 \u0437\u0430\u0441\u0435\u0447\u0435\u043a"},fontSizeDecrease:{en:"Aa-",de:"Aa-",fr:"Aa-",ca:"Aa-",es:"Aa-",nl:"Aa-",da:"Aa-","pt-BR":"Aa-",ru:"Aa-"},fontSizeIncrease:{en:"Aa+",de:"Aa+",fr:"Aa+",ca:"Aa+",es:"Aa+",nl:"Aa+",da:"Aa+","pt-BR":"Aa+",ru:"Aa+"},bookThemeDay:{en:"Day",de:"Tag",fr:"Clair",ca:"Dia",es:"D\xeda",nl:"Overdag",da:"Dag","pt-BR":"Dia",ru:"\u0414\u0435\u043d\u044c"},bookThemeSepia:{en:"Sepia",de:"Sepia",fr:"S\xe9pia",ca:"S\xe8pia",es:"Sepia",nl:"Sepia",da:"Sepia","pt-BR":"Acastanhado",ru:"\u0421\u0435\u043f\u0438\u044f"},bookThemeNight:{en:"Night",de:"Nacht",fr:"Sombre",ca:"Nit",es:"Noche",nl:"Nacht",da:"Nat","pt-BR":"Noturno",ru:"\u041d\u043e\u0447\u044c"},bookViewPaginated:{en:"Paginated",de:"Paginiert",fr:"Pagin\xe9",ca:"Paginat",es:"Paginado",nl:"Per pagina",da:"Med sidetal","pt-BR":"Paginado",ru:"\u041d\u0443\u043c\u0435\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439"},bookViewScrolling:{en:"Scrolling",de:"Scrollen",fr:"D\xe9fil\xe9",ca:"Despla\xe7ant",es:"Desplazando",nl:"Scrollen",da:"Scrolle","pt-BR":"Rolagem",ru:"\u041f\u0440\u043e\u043a\u0440\u0443\u0442\u043a\u0430"},preferredShop:{en:"Preferred Bookstore",de:"Bevorzugten Shop",fr:"Librairie Favorite",ca:"Llibreria Preferida",es:"Librer\xeda Preferida",nl:"Voorkeursboekwinkel",da:"Foretrukne boghandel","pt-BR":"Livraria favorita",ru:"\u041f\u0440\u0435\u0434\u043f\u043e\u0447\u0438\u0442\u0430\u0435\u043c\u044b\u0439 \u043a\u043d\u0438\u0436\u043d\u044b\u0439 \u043c\u0430\u0433\u0430\u0437\u0438\u043d"},checkedIcon:{en:"Checked",de:"Ausgew\xe4hlt",fr:"S\xe9lectionn\xe9",ca:"Seleccionat",es:"Seleccionado",nl:"Geselecteerd",da:"Valgt","pt-BR":"Selecionado",ru:"\u0412\u043a\u043b\u044e\u0447\u0435\u043d\u043e"},closeIcon:{en:"Close",de:"Schlie\xdfen",fr:"Fermer",ca:"Tancat",es:"Cerrar",nl:"Sluiten",da:"Luk","pt-BR":"Fechar",ru:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c"},errorIcon:{en:"Warning",de:"Warnung",fr:"Attention",ca:"Advertiment",es:"Advertencia",nl:"Waarschuwing",da:"Advarsel","pt-BR":"Alerta",ru:"\u041f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435"},expandIcon:{en:"Enter fullscreen",de:"Vollbildmodus aktivieren",fr:"Activer le mode plein \xe9cran",ca:"Activar mode de pantalla completa",es:"Activar modo pantalla completa",nl:"Gebruik het volledige scherm",da:"Vis fuldsk\xe6rm","pt-BR":"Ativar tela cheia",ru:"\u041f\u043e\u043b\u043d\u043e\u044d\u043a\u0440\u0430\u043d\u043d\u044b\u0439 \u0440\u0435\u0436\u0438\u043c"},loadingIcon:{en:"Loading",de:"Laden",fr:"Chargement en cours",ca:"Carregant",es:"Cargando",nl:"Aan het laden",da:"Indl\xe6ser","pt-BR":"Carregando",ru:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"},menuIcon:{en:"Show and hide navigation bar",de:"Navigationsleiste ein- und ausblenden",fr:"Afficher et cacher le menu",ca:"Barra de mostrar i amagar",es:"Barra de mostrar y ocultar",nl:"Toon/verberg navigatiemenu",da:"Vis og skjul navigationsmenu","pt-BR":"Exiba e oculta barra de navega\xe7\xe3o",ru:"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0438 \u0441\u043a\u0440\u044b\u0442\u044c \u043f\u0430\u043d\u0435\u043b\u044c \u043d\u0430\u0432\u0438\u0433\u0430\u0446\u0438\u0438"},submenuIcon:{en:"Show submenu",de:"Untermen\xfc einblenden",fr:"Afficher le sous-menu",ca:"Mostrar submen\xfa",es:"Mostrar submen\xfa",nl:"Toon submenu",da:"Vis undermenuer","pt-BR":"Exibir submenu",ru:"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043f\u043e\u0434\u043c\u0435\u043d\u044e"},minimizeIcon:{en:"Exit fullscreen",de:"Vollbildmodus verlassen",fr:"Quitter le mode plein \xe9cran",ca:"Sortir de mode de pantalla completa",es:"Salir del modo pantalla completa",nl:"Sluit volledige schermmodus",da:"Afslut fuldsk\xe6rm","pt-BR":"Sa\xeda do modo tela cheia",ru:"\u0412\u044b\u0445\u043e\u0434 \u0438\u0437 \u043f\u043e\u043b\u043d\u043e\u044d\u043a\u0440\u0430\u043d\u043d\u043e\u0433\u043e \u0440\u0435\u0436\u0438\u043c\u0430"},tocIcon:{en:"Table of Contents",de:"Inhaltsverzeichnis",fr:"Table des mati\xe8res",ca:"Taula de continguts",es:"Tabla de contenidos",nl:"Inhoudsopgave",da:"Indholdsfortegnelse","pt-BR":"Sum\xe1rio",ru:"\u041e\u0433\u043b\u0430\u0432\u043b\u0435\u043d\u0438\u0435"},enabled:{en:" enabled",de:" aktiviert",fr:" activ\xe9",ca:" activat",es:" activado",nl:" actief",da:" sl\xe5et til","pt-BR":" ativo",ru:" \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u043e"},disabled:{en:" disabled",de:" deaktiviert",fr:" d\xe9sactiv\xe9",ca:" desactivat",es:" desactivado",nl:" inactief",da:" sl\xe5et fra","pt-BR":" inativo",ru:" \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u043e"},trackingOn:{en:"Switch on data collection",de:"Datenerfassung anschalten",fr:"Activer la collecte de donn\xe9es",ca:"Activar la recollida de dades",es:"Activar la recogida de archivos",nl:"Gegevens verzamelen aanzetten",da:"Sl\xe5 dataindsamling til","pt-BR":"Ativar compartilhamento de dados",ru:"\u0412\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0441\u0431\u043e\u0440 \u0434\u0430\u043d\u043d\u044b\u0445"},trackingOff:{en:"Switch off data collection",de:"Datenerfassung abschalten",fr:"D\xe9sactiver la collecte de donn\xe9es",ca:"Desactivar la recollida de dades",es:"Desactivar la recogida de archivos",nl:"Gegevens verzamelen uitzetten",da:"Sl\xe5 dataindsamling fra","pt-BR":"Desativar compartilhamento de dados",ru:"\u041e\u0442\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0441\u0431\u043e\u0440 \u0434\u0430\u043d\u043d\u044b\u0445"},aboutThisBook:{en:"About this book",de:"\xdcber dieses Buch",fr:"\xc0 propos de ce livre",ca:"Sobre aquest llibre",es:"Sobre este libro",nl:"Over dit boek",da:"Om bogen","pt-BR":"Sobre o livro",ru:"\u041e\u0431 \u044d\u0442\u043e\u0439 \u043a\u043d\u0438\u0433\u0435"},bookInfoPublisher:{en:"Published by ",de:"Erschienen bei ",fr:"\xc9dit\xe9 par ",ca:"Publicat per ",es:"Publicado por ",nl:"Uitgegeven door ",da:"Udgivet af ","pt-BR":"Publicado por ",ru:"\u0418\u0437\u0434\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u043e "},bookInfoIsbn:{en:"ISBN: ",de:"ISBN: ",fr:"ISBN: ",ca:"ISBN: ",es:"ISBN: ",nl:"ISBN: ",da:"ISBN: ","pt-BR":"ISBN: ",ru:"ISBN: "},bookInfoGenre:{en:"Genre: ",de:"Kategorie: ",fr:"Genre: ",ca:"G\xe8nere: ",es:"G\xe9nero: ",nl:"Genre: ",da:"Kategori: ","pt-BR":"G\xeanero: ",ru:"\u0416\u0430\u043d\u0440: "},bookInfoDate:{en:"Publication date: ",de:"Ver\xf6ffentlichungsdatum: ",fr:"Date de publication: ",ca:"Data de publicaci\xf3: ",es:"Fecha de publicaci\xf3n: ",nl:"Publicatiedatum: ",da:"Udgivelsesdato: ","pt-BR":"Data de lan\xe7amento: ",ru:"\u0414\u0430\u0442\u0430 \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438: "},bookInfoBuy:{en:"Buy this book",de:"Zum shop",fr:"Acheter",ca:"Comprar aquest llibre",es:"Compre este libro",nl:"Koop dit boek",da:"G\xe5 til shop","pt-BR":"Compre este livro",ru:"\u041a\u0443\u043f\u0438\u0442\u044c \u044d\u0442\u0443 \u043a\u043d\u0438\u0433\u0443"},bookInfoShare:{en:"Share",de:"Teilen",fr:"Partager",ca:"Compartir",es:"Compartir",nl:"Delen",da:"Del","pt-BR":"Compartilhe",ru:"\u041f\u043e\u0434\u0435\u043b\u0438\u0442\u044c\u0441\u044f"},bookInfoShareFallback:{en:"Link copied",de:"Link wurde kopiert",fr:"Lien copi\xe9",ca:"Enlla\xe7 copiat",es:"Enlace copiado",nl:"Link gekopieerd",da:"Kopi\xe9r link","pt-BR":"Link copiado",ru:"\u0421\u0441\u044b\u043b\u043a\u0430 \u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u0430"},bookInfoShareText:{en:"Here is a reading sample for a great book: ",de:"Hier ist eine Leseprobe zu einem tollen Buch: ",fr:"Voici l\u2019extrait d\u2019un tr\xe8s bon livre: ",ca:"Aqu\xed t\xe9 una mostra d\u2019un llibre meravell\xf3s: ",es:"Aqu\xed tiene una muestra de un maravilloso libro: ",nl:"Hier is een leesvoorbeeld van een mooi boek: ",da:"Her er en l\xe6sepr\xf8ve til en rigtig god bog: ","pt-BR":"Aqui h\xe1 uma amostra de um bom livro: ",ru:"\u0412\u043e\u0442 \u043e\u0442\u0440\u044b\u0432\u043e\u043a \u0438\u0437 \u043e\u0442\u043b\u0438\u0447\u043d\u043e\u0439 \u043a\u043d\u0438\u0433\u0438: "},libHandler:{en:"Add to my Books",de:"In das Buchregal stellen",fr:"Ajouter \xe0 ma biblioth\xe8que",ca:"Add to my Books",es:"Add to my Books",nl:"Add to my Books",da:"Tilf\xf8j til Mine b\xf8ger","pt-BR":"Adicione para Meus livros",ru:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043c\u043e\u0438 \u043a\u043d\u0438\u0433\u0438"},libAdded:{en:"This sample was added to your cloud library.",de:"Die Leseprobe wurde deinem Buchregal hinzugef\xfcgt.",fr:"Cet extrait a \xe9t\xe9 ajout\xe9 \xe0 votre biblioth\xe8que.",ca:"This sample was added to your cloud library.",es:"This sample was added to your cloud library.",nl:"This sample was added to your cloud library.",da:"L\xe6sepr\xf8ven blev f\xf8jet til dit bibliotek.","pt-BR":"Esta amostra foi adicionada para sua biblioteca na nuvem.",ru:"\u042d\u0442\u043e\u0442 \u043e\u0442\u0440\u044b\u0432\u043e\u043a \u0431\u044b\u043b \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d \u0432 \u0432\u0430\u0448\u0443 \u043e\u0431\u043b\u0430\u0447\u043d\u0443\u044e \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0443."},libRemoved:{en:"This sample was removed from your cloud library.",de:"Die Leseprobe wurde aus dem Buchregal entfernt.",fr:"Cet extrait a \xe9t\xe9 effac\xe9 de votre biblioth\xe8que.",ca:"This sample was removed from your cloud library.",es:"This sample was removed from your cloud library.",nl:"This sample was removed from your cloud library.",da:"L\xe6sepr\xf8ven blev fjernet fra dit bibliotek.","pt-BR":"Esta amostra foi removida de sua biblioteca na nuvem.",ru:"\u042d\u0442\u043e\u0442 \u043e\u0442\u0440\u044b\u0432\u043e\u043a \u0431\u044b\u043b \u0443\u0434\u0430\u043b\u0435\u043d \u0438\u0437 \u0432\u0430\u0448\u0435\u0439 \u043e\u0431\u043b\u0430\u0447\u043d\u043e\u0439 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438."},libExists:{en:"This sample was already in your cloud library.",de:"Die Leseprobe ist schon im Buchregal.",fr:"Cet extrait figurait d\xe9j\xe0 dans votre biblioth\xe8que.",ca:"This sample was already in your cloud library.",es:"This sample was already in your cloud library.",nl:"This sample was already in your cloud library.",da:"L\xe6sepr\xf8ven findes allerede i dit bibliotek.","pt-BR":"Esta amostra j\xe1 se encontra em sua biblioteca na nuvem.",ru:"\u042d\u0442\u043e\u0442 \u043e\u0442\u0440\u044b\u0432\u043e\u043a \u0443\u0436\u0435 \u0431\u044b\u043b \u0432 \u0432\u0430\u0448\u0435\u0439 \u043e\u0431\u043b\u0430\u0447\u043d\u043e\u0439 \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0435."},libError:{en:"An error occured. Please try again later.",de:"Es ist ein Fehler aufgetreten. Bitte es sp\xe4ter noch einmal probieren.",fr:"Une erreur est survenue. Merci de r\xe9essayer plus tard.",ca:"An error occured. Please try again later.",es:"An error occured. Please try again later.",nl:"An error occured. Please try again later.",da:"Der skete en fejl, s\xe5 l\xe6sepr\xf8ven blev ikke f\xf8jet til biblioteket.","pt-BR":"Ocorreu um erro. Tente novamente mais tarde.",ru:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0436\u0435."},spreadHint:{en:"Try rotating or enlarging your browser for two-page spreads.",de:"Try rotating or enlarging your browser for two-page spreads.",fr:"Essayez de tourner ou agrandir votre navigateur pour afficher 2 pages.",ca:"Try rotating or enlarging your browser for two-page spreads.",es:"Try rotating or enlarging your browser for two-page spreads.",nl:"Try rotating or enlarging your browser for two-page spreads.",da:"Try rotating or enlarging your browser for two-page spreads.","pt-BR":"Try rotating or enlarging your browser for two-page spreads.",ru:"Try rotating or enlarging your browser for two-page spreads."},bookplateHint:{en:"Your reading session is being recorded. ",de:"Your reading session is being recorded. ",fr:"Votre session de lecture est enregistr\xe9e. ",ca:"Your reading session is being recorded. ",es:"Your reading session is being recorded. ",nl:"Your reading session is being recorded. ",da:"Your reading session is being recorded. ","pt-BR":"Your reading session is being recorded. ",ru:"Your reading session is being recorded. "},bookplateHintLink:{en:"Check what data is collected.",de:"Check what data is collected.",fr:"Voir les donn\xe9es collect\xe9es.",ca:"Check what data is collected.",es:"Check what data is collected.",nl:"Check what data is collected.",da:"Check what data is collected.","pt-BR":"Check what data is collected.",ru:"Check what data is collected."}})}.apply(t,i))!==undefined&&(e.exports=r)},"./src/Manifest.ts":function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i["throw"](e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}l((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};i=[n,t],(r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.bookplateIndexes=[],this.metadata=e.metadata||{},this.links=e.links||[],this.spine=e.readingOrder||e.spine||[],this.resources=e.resources||[],this.toc=e.toc||[],this.assetsUrl=t,this.bookplateIndexes=this.getBookplates(this.spine)}return e.requestManifest=function(t,n,i){return o(this,void 0,void 0,function(){var r,a,l,c,u=this;return s(this,function(h){switch(h.label){case 0:r=function(){return o(u,void 0,void 0,function(){var r,o;return s(this,function(s){switch(s.label){case 0:return[4,window.fetch(t.href,{credentials:"same-origin"})];case 1:return r=s.sent(),[4,r.json()];case 2:return o=s.sent(),i&&r.ok?[4,i.set("manifest",JSON.stringify(o))]:[3,4];case 3:s.sent(),s.label=4;case 4:return[2,new e(o,n)]}})})},h.label=1;case 1:return h.trys.push([1,3,,6]),[4,r()];case 2:return[2,h.sent()];case 3:return a=h.sent(),i?[4,i.get("manifest")]:[3,5];case 4:if(l=h.sent())return c=JSON.parse(l),[2,new e(c,n)];h.label=5;case 5:return[3,6];case 6:return[2,r()]}})})},e.getManifest=function(t,n,i){return o(this,void 0,void 0,function(){var r,o;return s(this,function(s){switch(s.label){case 0:return i?[4,i.get("manifest")]:[3,2];case 1:return r=s.sent(),r?(o=JSON.parse(r),[2,new e(o,n)]):[2,e.requestManifest(t,n,i)];case 2:return[2,e.requestManifest(t,n)];case 3:return[2]}})})},e.purgeManifest=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,e.remove("manifest")];case 1:return t.sent(),[2,new Promise(function(e){return e()})]}})})},e.spineItemIsBookplate=function(t){var n=e.JBKS_BOOKPLATES[0];return t.indexOf(n)>=0},e.spreadIsBookplate=function(t){var n=e.JBKS_BOOKPLATES[1];return t.indexOf(n)>=0},e.prototype.getBookplates=function(t){for(var n=function(e){var n=t.findIndex(function(t){return!!t.href&&t.href.indexOf(e)>=0});-1!==n&&i.bookplateIndexes.push(n)},i=this,r=0,o=e.JBKS_BOOKPLATES;r<o.length;r++){n(o[r])}return this.bookplateIndexes},e.prototype.getStartLink=function(){return this.spine.length>0?this.spine[0]:null},e.prototype.getBookplateLink=function(){return this.bookplateIndexes.length>0?this.spine[this.bookplateIndexes[0]]:null},e.prototype.getPreviousSpineItem=function(e){var t=this.getSpineIndex(e);return null!==t&&t>0?this.spine[t-1]:null},e.prototype.getNextSpineItem=function(e){var t=this.getSpineIndex(e);return null!==t&&t<this.spine.length-1?this.spine[t+1]:null},e.prototype.getSpineItem=function(e){var t=this.getSpineIndex(e);return null!==t?this.spine[t]:null},e.prototype.getSpineItemAtPos=function(e){if(e>0&&e<=this.spine.length){var t=e-1,n=this.bookplateIndexes.length,i=this.bookplateIndexes[n-1];return n>1&&e>=i?this.spine[t+n]:1===n&&e>i?this.spine[t+n]:this.spine[t]}return null},e.prototype.spineItemIsLeft=function(e){var t=this.getSpineIndex(e);if(t){var n=this.bookplateIndexes.length,i=this.bookplateIndexes[n-1];return 1===n&&t>i?t%2==0:t%2==1}return!1},e.prototype.getSpineCount=function(e){var t=this.getSpineIndex(e);if(null!==t){var n=t+1,i=this.bookplateIndexes.length,r=this.bookplateIndexes[i-1];return i>0&&t>=r?n-i:n}return null},e.prototype.getPageCount=function(){var e=this.bookplateIndexes.length;return e>0?this.spine.length-e:this.spine.length},e.prototype.getSpineIndex=function(e){for(var t=0;t<this.spine.length;t++){var n=this.spine[t];if(n.href){if(new URL(n.href,this.assetsUrl.href).href===e)return t}}return null},e.prototype.getTOCItem=function(e){var t=this,n=function(e,i){for(var r=0;r<i.length;r++){var o=i[r];if(o.href){if(new URL(o.href,t.assetsUrl.href).href===e)return o}if(o.children){var s=n(e,o.children);if(null!==s)return s}}return null};return n(e,this.toc)},e.JBKS_BOOKPLATES=["jellybooks_bookplate.xhtml","jellybooks_bookplate_pineapple_p1.xhtml","jellybooks_bookplate_pineapple_p2.xhtml"],e}();t["default"]=n}.apply(t,i))!==undefined&&(e.exports=r)},"./src/MemoryStore.ts":function(e,t,n){var i,r;i=[n,t],(r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.store={}}return e.prototype.get=function(e){var t=this.store[e]||null;return new Promise(function(e){return e(t)})},e.prototype.set=function(e,t){return this.store[e]=t,new Promise(function(e){return e()})},e.prototype.remove=function(e){return delete this.store[e],new Promise(function(e){return e()})},e}();t["default"]=n}.apply(t,i))!==undefined&&(e.exports=r)},"./src/Navigator.ts":function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i["throw"](e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}l((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}},l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/Cacher.ts"),n("./src/Manifest.ts"),n("./src/HTMLUtilities.ts"),n("./src/Icons.ts"),n("./src/Locales.ts"),n("./src/Templates.ts"),n("./src/Tracker/Lifecycle.ts"),n("./src/LibHandler.ts"),n("./src/Toast.ts")],(r=function(e,t,n,i,r,c,u,h,d,f,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=a(i),r=l(r),c=l(c),u=l(u),h=l(h),f=a(f),p=a(p);var g=function(){function e(e,t,n,i,r,a,l,c,u,h,d,f){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===d&&(d=null),void 0===f&&(f=null);var p=this;this.bookInfo=null,this.libHandler=null,this.shoppingCart=null,this.fullscreen=null,this.bookInfoControl=null,this.bookInfoBuy=null,this.bookInfoShare=null,this.startPath=null,this.startPage=null,this.canFullscreen=document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled,this.handleExternalLink=function(e){return o(p,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.tracker?[4,this.tracker.handleEvents(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return window.open(e.href,"_blank"),[2]}})})},this.store=e,this.cacher=t,this.settings=n,this.annotator=i,this.tracker=r,this.libHandlerConfig=a,this.tosLinkConfig=l,this.allowFullscreen=c,this.locale=u||"en",this.bookInfo=h,this.startPath=d,this.startPage=f}return e.prototype.initUIElements=function(e){this.rendererHost=r.findRequiredElement(e,"#renderer"),this.nextChapterLink=r.findRequiredElement(e,"a[rel=next]"),this.previousChapterLink=r.findRequiredElement(e,"a[rel=prev]"),this.contentsControl=r.findRequiredElement(e,"button.contents"),this.settingsControl=r.findRequiredElement(e,"button.settings"),this.links=r.findRequiredElement(e,"ul.links.top"),this.linksBottom=r.findRequiredElement(e,"ul.links.bottom"),this.tocView=r.findRequiredElement(e,".contents-view"),this.settingsView=r.findRequiredElement(e,".settings-view"),this.loadingMessage=r.findRequiredElement(e,"div[class=loading]"),this.errorMessage=r.findRequiredElement(e,"div[class=error]"),this.tryAgainButton=r.findRequiredElement(e,"button[class=try-again]"),this.goBackButton=r.findRequiredElement(e,"button[class=go-back]"),this.bookInfoView=r.findRequiredElement(e,".bookinfo"),this.menuControl=r.findRequiredElement(e,"button.trigger"),this.infoTop=r.findRequiredElement(e,".info.top"),this.infoBottom=r.findRequiredElement(e,".info.bottom"),this.bookTitle=r.findRequiredElement(this.infoTop,"span[class=book-title]"),this.chapterPosition=r.findRequiredElement(this.infoBottom,"span[class=chapter-position]"),this.desktopHints=r.findRequiredElement(e,"div[class='desktop-hints']"),this.leftHint=r.findRequiredElement(this.desktopHints,"svg[class*=left-hint]"),this.rightHint=r.findRequiredElement(this.desktopHints,"svg[class*=right-hint]")},e.prototype.initHelperProps=function(){this.newPosition=null,this.newElementId=null,this.bookplateHint=!1},e.prototype.setupEvents=function(){return o(this,void 0,void 0,function(){var e,t,n,i,r,o,a,l,c,u=this;return s(this,function(s){switch(s.label){case 0:return e=this.renderer,[4,this.handleRenditionLoad.bind(this)];case 1:return e.onRendererUpdate=s.sent(),t=200,window.addEventListener("resize",function(){clearTimeout(n),n=setTimeout(u.handleReflow.bind(u),t)}),r=(i=this.previousChapterLink).addEventListener,o=["click"],[4,this.handlePreviousChapterClick.bind(this)];case 2:return r.apply(i,o.concat([s.sent()])),l=(a=this.nextChapterLink).addEventListener,c=["click"],[4,this.handleNextChapterClick.bind(this)];case 3:return l.apply(a,c.concat([s.sent()])),this.contentsControl.addEventListener("click",this.handleContentsClick.bind(this)),this.settingsControl.addEventListener("click",this.handleSettingsClick.bind(this)),this.settingsView.addEventListener("click",this.handleToggleLinksClick.bind(this)),this.tryAgainButton.addEventListener("click",this.tryAgain.bind(this)),this.goBackButton.addEventListener("click",this.goBack.bind(this)),this.menuControl.addEventListener("click",this.handleToggleLinksClick.bind(this)),this.contentsControl.addEventListener("keydown",this.hideTOCOnEscape.bind(this)),this.tocView.addEventListener("keydown",this.hideTOCOnEscape.bind(this)),this.settingsControl.addEventListener("keydown",this.hideSettingsOnEscape.bind(this)),this.settingsView.addEventListener("keydown",this.hideSettingsOnEscape.bind(this)),window.addEventListener("keydown",this.handleKeyboardNavigation.bind(this)),this.allowFullscreen&&this.canFullscreen&&(document.addEventListener("fullscreenchange",this.toggleFullscreenIcon.bind(this)),document.addEventListener("webkitfullscreenchange",this.toggleFullscreenIcon.bind(this)),document.addEventListener("mozfullscreenchange",this.toggleFullscreenIcon.bind(this)),document.addEventListener("MSFullscreenChange",this.toggleFullscreenIcon.bind(this))),[2]}})})},e.prototype.createLibHandler=function(){return o(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return this.libHandlerConfig?(this.libHandler=new f["default"](this.libHandlerConfig),e=document.createElement("li"),e.classList.add("libHandler-wrapper"),[4,this.libHandler.renderLibHandler(this.store,e,this.locale)]):[3,2];case 1:t.sent(),this.links.insertBefore(e,this.links.firstChild),t.label=2;case 2:return[2]}})})},e.prototype.createFullscreen=function(){if(this.allowFullscreen&&this.canFullscreen){var e='<button id="fullscreen-control" class="fullscreen" aria-hidden="false">'+c.makeIconTemplate("expand-icon",u.locales.expandIcon[this.locale],c.icons.expand,"icon active-icon")+" "+c.makeIconTemplate("minimize-icon",u.locales.minimizeIcon[this.locale],c.icons.minimize,"icon inactive-icon")+"</button>",t=document.createElement("li");t.innerHTML=e,this.links.appendChild(t),this.fullscreen=r.findRequiredElement(this.links,"#fullscreen-control"),this.fullscreen.addEventListener("click",this.toggleFullscreen.bind(this))}},e.prototype.createBookInfo=function(e){return o(this,void 0,void 0,function(){var t,n,i,o,a,l,c,d,f=this;return s(this,function(s){switch(s.label){case 0:if(!this.bookInfo)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.bookInfo.renderBookInfo(this.bookInfoView,this.locale)];case 2:return s.sent(),this.settings.renderControls(this.settingsView,this.locale,!0),this.bookInfoClose=this.bookInfo.getCloseButton(),this.bookInfoClose.addEventListener("click",this.hideBookInfo.bind(this)),this.bookInfoControl=this.settings.getAboutBookButton(),null!==this.bookInfoControl&&this.bookInfoControl.addEventListener("click",this.handleBookInfoClick.bind(this)),this.bookInfoView.addEventListener("keydown",this.hideBookInfoOnEscape.bind(this)),t=this.bookInfoView.querySelectorAll("a, button"),t&&t.length>0&&(n=t[t.length-1],this.setupModalFocusTrap(this.bookInfoView,this.bookInfoClose,n)),this.bookInfoBuy=this.bookInfo.getBuyButton(),this.navBuyLink=this.bookInfo.getBuyLinkNav(),this.bookInfoBuyLinks=this.bookInfo.getBuyLinks(),this.navBuyLink&&(i=this.handlePreferredShop(this.navBuyLink,!1),o=u.locales.bookInfoBuy[this.locale],a=o,l=h.shoppingCartTemplate(i,o,a),c=document.createElement("li"),c.classList.add("cart-wrapper"),c.innerHTML=l,e?this.links.insertBefore(c,e):this.links.insertBefore(c,this.settingsControl.parentElement),this.shoppingCart=r.findRequiredElement(this.links,"#shopping-cart")),this.bookInfoShare=this.bookInfo.getShareButton(),this.bookInfoShare&&this.bookInfoShare.addEventListener("click",function(){f.bookInfo&&f.bookInfo.constructWebShare(f.locale,f.tracker)}),[3,4];case 3:return d=s.sent(),this.settings.renderControls(this.settingsView,this.locale),[3,4];case 4:return[3,6];case 5:this.settings.renderControls(this.settingsView,this.locale),s.label=6;case 6:return[2]}})})},e.prototype.createTosLink=function(){if(this.tosLinkConfig&&this.tosLinkConfig.url){var e=this.tosLinkConfig.url,t=this.tosLinkConfig.label||u.locales.tosDefault[this.locale],n=h.tosLinkTemplate(e.href,t);this.settings.getTosElement().innerHTML=n}},e.prototype.populateBookTitle=function(){this.manifest.metadata.title&&(this.bookTitle.textContent=this.manifest.metadata.title)},e.prototype.createSettingsFocusTrap=function(){var e=this.settingsView.querySelectorAll("a, button");if(e&&e.length>0){var t=e[e.length-1];this.setupModalFocusTrap(this.settingsView,this.settingsControl,t)}},e.prototype.setupModalFocusTrap=function(e,t,n){var i=this,r=9;t.addEventListener("keydown",function(t){if(i.isDisplayed(e)){var o=t.keyCode===r,s=!!t.shiftKey;o&&s&&(n.focus(),t.preventDefault(),t.stopPropagation())}}),n.addEventListener("keydown",function(n){if(i.isDisplayed(e)){var o=n.keyCode===r,s=!!n.shiftKey;o&&!s&&(t.focus(),n.preventDefault(),n.stopPropagation())}})},e.prototype.handleKeyboardNavigation=function(e){return o(this,void 0,void 0,function(){var t,n,i,r,o,a,l,c,u;return s(this,function(s){switch(s.label){case 0:return t=!!e.shiftKey,n=!!e.metaKey,i=!!e.ctrlKey,r=32,o=37,a=39,l=48,c=187,u=189,this.isDisplayed(this.bookInfoView)||this.isDisplayed(this.settingsView)||this.isDisplayed(this.tocView)?[3,4]:e.keyCode===o||t&&e.keyCode===r?[4,this.handlePreviousPageClick(e)]:[3,2];case 1:return s.sent(),[3,4];case 2:return e.keyCode!==a&&e.keyCode!==r?[3,4]:[4,this.handleNextPageClick(e)];case 3:s.sent(),s.label=4;case 4:return((n||i)&&e.keyCode===l||(n||i)&&e.keyCode===c||(n||i)&&e.keyCode===u)&&e.preventDefault(),[2]}})})},e.prototype.updateRetailer=function(){this.shoppingCart&&(this.shoppingCart.href=this.handlePreferredShop(this.shoppingCart.href)),this.tracker&&this.settingsChangeCount++},e.prototype.handlePreferredShop=function(e,t){void 0===t&&(t=!0);var n=this.settings.getSelectedRetailer(),i=e;if(this.bookInfoBuyLinks&&this.bookInfoBuyLinks.length>0&&n){for(var r=n.retailer_id,o=0,s=this.bookInfoBuyLinks;o<s.length;o++){var a=s[o];if(a.retailer_id===r&&a.retailer_link){i=a.retailer_link;break}}this.tracker&&(i=this.tracker.appendDeviceId(i,!0),t&&this.tracker.handlePreference("preferredShop",r))}return i},e.prototype.enableOffline=function(){this.cacher&&this.cacher.getStatus()!==n.CacheStatus.Downloaded&&this.cacher.enable()},
e.prototype.loadManifest=function(){return o(this,void 0,void 0,function(){var e,t,n,r,a,l,c,u,h,d,f,p,g=this;return s(this,function(b){switch(b.label){case 0:return b.trys.push([0,6,,7]),e=this,[4,i["default"].requestManifest(this.manifestUrl,this.assetsUrl,this.store)];case 1:return e.manifest=b.sent(),t=this.manifest.toc,t.length?(this.contentsControl.className="contents",(n=function(e,t){for(var i=document.createElement("ol"),r=null,a=0,l=t;a<l.length;a++){var c=l[a],u=document.createElement("li"),h=document.createElement("a"),d=document.createElement("span");h.tabIndex=-1;var f="";c.href?(f=new URL(c.href,g.assetsUrl.href).href,h.href=f,h.textContent=c.title||"",u.appendChild(h)):(d.textContent=c.title||"",u.appendChild(d)),c.children&&c.children.length>0&&n(u,c.children),i.appendChild(u),r=h}r&&g.setupModalFocusTrap(g.tocView,g.contentsControl,r),i.addEventListener("click",function(e){return o(g,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return e.preventDefault(),(e.stopPropagation(),e.target&&"a"===e.target.tagName.toLowerCase())?(t=e.target,-1===t.className.indexOf("active")?[3,1]:(this.hideTOC(),[3,4])):[3,4];case 1:return this.contentsControl.focus(),this.tracker?[4,this.tracker.stopTracking()]:[3,3];case 2:n.sent(),n.label=3;case 3:this.navigate({resource:t.href,position:0}),n.label=4;case 4:return[2]}})})}),e.appendChild(i)})(this.tocView,t)):this.contentsControl.parentElement.style.display="none",r=this.manifest.spine,this.tracker?[4,this.tracker.initTracking(r,this.renderer.getIFrames(),this.locale,this.bookInfoBuy)]:[3,3];case 2:b.sent(),this.shoppingCart&&(this.shoppingCart.href=this.tracker.appendDeviceId(this.shoppingCart.href,!0)),b.label=3;case 3:return a=null,this.annotator?[4,this.annotator.getLastReadingPosition()]:[3,5];case 4:a=b.sent(),a&&(l=a.resource,c=r.map(function(e){return e.href?new URL(e.href,g.assetsUrl.href).href:undefined}),-1===c.indexOf(l)&&(a=null)),b.label=5;case 5:return u=this.getStartItemHref(),a?this.navigate(a):u&&(h=0,(this.startPath||this.startPage)&&(d=void 0,this.startPage?d=this.getArbitraryStartPage(this.startPage):this.startPath&&(d=this.getArbitraryStartPath(this.startPath)),d&&u!==d&&(u=d,this.tracker&&null!==this.manifest.getBookplateLink()&&(this.bookplateHint=!0),"fxl"===this.renderer.getType()&&1===this.renderer.getVisibleFrames()&&(h=this.manifest.spineItemIsLeft(u)?0:1))),f={resource:u,position:h},this.navigate(f)),[2,new Promise(function(e){return e()})];case 6:return p=b.sent(),console.log(p),this.abortOnError(),[2,new Promise(function(e,t){return t(p)})["catch"](function(){})];case 7:return[2]}})})},e.prototype.getArbitraryStartPath=function(e){try{var t=decodeURIComponent(e),n=new URL(t,this.assetsUrl.href).href;return null!==this.manifest.getSpineItem(n.split("#")[0])?n:undefined}catch(e){return undefined}},e.prototype.getArbitraryStartPage=function(e){try{if(!isNaN(e)&&e>1){var t=this.manifest.getSpineItemAtPos(e);if(null!==t&&t.href)return new URL(t.href,this.assetsUrl.href).href}return undefined}catch(e){return undefined}},e.prototype.abortOnError=function(){this.errorMessage.style.display="block",this.errorMessage.setAttribute("role","alert"),this.isLoading&&this.hideLoadingMessage()},e.prototype.tryAgain=function(){window.location.reload(),this.enableOffline()},e.prototype.goBack=function(){window.history.back()},e.prototype.isDisplayed=function(e){return-1!==e.className.indexOf(" active")},e.prototype.disableAnchor=function(e){e.className="disabled",e.setAttribute("aria-disabled","true"),this.handleRemoveHover()},e.prototype.enableAnchor=function(e){e.className="",e.hasAttribute("aria-disabled")&&e.removeAttribute("aria-disabled")},e.prototype.handleBookplateToast=function(){var e=this;if(this.tracker){var t=this.manifest.getBookplateLink();if(null!==t&&t.href){var n=new URL(t.href,this.assetsUrl.href).href,i={href:n,text:u.locales.bookplateHintLink[this.locale]};setTimeout(function(){return o(e,void 0,void 0,function(){var e,t=this;return s(this,function(){return e=new p["default"](u.locales.bookplateHint[this.locale],"bottom",5e3,i),e.onToastLinkClick(function(e){return o(t,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.handleInternalLink(e)];case 1:return[2,t.sent()]}})})}),e.onToastDelete(function(){return t.bookplateHint=!1}),[2]})})},1e3)}else this.bookplateHint=!1}},e.prototype.showElement=function(e,t){if(e.className=e.className.replace(" inactive",""),-1===e.className.indexOf(" active")&&(e.className+=" active"),e.setAttribute("aria-hidden","false"),t){t.setAttribute("aria-expanded","true");var n=t.querySelector(".icon.open");if(n&&-1===(n.getAttribute("class")||"").indexOf(" inactive-icon")){var i=(n.getAttribute("class")||"")+" inactive-icon";n.setAttribute("class",i)}var r=t.querySelector(".icon.close");if(r){var i=(r.getAttribute("class")||"").replace(" inactive-icon","");r.setAttribute("class",i)}}for(var o=Array.prototype.slice.call(e.querySelectorAll("button")),s=Array.prototype.slice.call(e.querySelectorAll("a")),a=0,l=o;a<l.length;a++){l[a].tabIndex=0}for(var c=0,u=s;c<u.length;c++){u[c].tabIndex=0}},e.prototype.hideElement=function(e,t){if(e.className=e.className.replace(" active",""),-1===e.className.indexOf(" inactive")&&(e.className+=" inactive"),e.setAttribute("aria-hidden","true"),t){t.setAttribute("aria-expanded","false");var n=t.querySelector(".icon.open");if(n){var i=(n.getAttribute("class")||"").replace(" inactive-icon","");n.setAttribute("class",i)}var r=t.querySelector(".icon.close");if(r&&-1===(r.getAttribute("class")||"").indexOf(" inactive-icon")){var i=(r.getAttribute("class")||"")+" inactive-icon";r.setAttribute("class",i)}}for(var o=Array.prototype.slice.call(e.querySelectorAll("button")),s=Array.prototype.slice.call(e.querySelectorAll("a")),a=0,l=o;a<l.length;a++){l[a].tabIndex=-1}for(var c=0,u=s;c<u.length;c++){u[c].tabIndex=-1}},e.prototype.showModal=function(e,t){this.renderer.hideForSR(),this.libHandler&&this.libHandler.hideForSR(),this.shoppingCart&&this.shoppingCart.setAttribute("aria-hidden","true"),this.fullscreen&&this.fullscreen.setAttribute("aria-hidden","true"),this.linksBottom.setAttribute("aria-hidden","true"),this.loadingMessage.setAttribute("aria-hidden","true"),this.errorMessage.setAttribute("aria-hidden","true"),this.desktopHints.setAttribute("aria-hidden","true"),this.showElement(e,t),this.previousChapterLink.tabIndex=-1,this.nextChapterLink.tabIndex=-1},e.prototype.hideModal=function(e,t){this.renderer.showForSR(),this.libHandler&&this.libHandler.showForSR(),this.shoppingCart&&this.shoppingCart.setAttribute("aria-hidden","false"),this.fullscreen&&this.fullscreen.setAttribute("aria-hidden","false"),this.linksBottom.setAttribute("aria-hidden","false"),this.loadingMessage.setAttribute("aria-hidden","false"),this.errorMessage.setAttribute("aria-hidden","false"),this.desktopHints.setAttribute("aria-hidden","false"),this.hideElement(e,t),this.previousChapterLink.tabIndex=0,this.nextChapterLink.tabIndex=0,e===this.settingsView&&this.tracker&&this.settingsChangeCount>0&&(this.tracker.makeSyncNow(),this.settingsChangeCount=0)},e.prototype.toggleFullscreenIcon=function(){if(this.fullscreen){var e=this.fullscreen.querySelector(".icon.active-icon"),t=this.fullscreen.querySelector(".icon.inactive-icon");if(e&&-1===(e.getAttribute("class")||"").indexOf(" inactive-icon")){var n="icon inactive-icon";e.setAttribute("class",n)}if(t){var n="icon active-icon";t.setAttribute("class",n)}}},e.prototype.toggleFullscreen=function(){if(this.fullscreen){var e=document,t=document.documentElement,n=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,i=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?i.call(e):n.call(t)}},e.prototype.toggleDisplay=function(e,t){this.isDisplayed(e)?this.hideElement(e,t):this.showElement(e,t)},e.prototype.toggleModal=function(e,t){this.isDisplayed(e)?(this.hideModal(e,t),this.libHandler&&this.libHandler.showForKeyboard(),this.shoppingCart&&(this.shoppingCart.tabIndex=0),this.fullscreen&&(this.fullscreen.tabIndex=0)):(this.showModal(e,t),this.libHandler&&this.libHandler.hideForKeyboard(),this.shoppingCart&&(this.shoppingCart.tabIndex=-1),this.fullscreen&&(this.fullscreen.tabIndex=-1),this.handleRemoveHover())},e.prototype.handleToggleLinksClick=function(e){this.toggleDisplay(this.links,this.menuControl),this.hideTOC(),this.hideSettings(),e.preventDefault(),e.stopPropagation()},e.prototype.goToPreviousResource=function(e){return o(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return this.previousChapterLink.hasAttribute("href")?(t={resource:this.previousChapterLink.href,position:e},this.tracker?[4,this.tracker.stopTracking(d.TrackerState.Stopped)]:[3,2]):[3,3];case 1:n.sent(),n.label=2;case 2:this.navigate(t),n.label=3;case 3:return[2]}})})},e.prototype.goToNextResource=function(){return o(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return this.nextChapterLink.hasAttribute("href")?(e={resource:this.nextChapterLink.href,position:0},this.tracker?[4,this.tracker.stopTracking(d.TrackerState.Completed)]:[3,2]):[3,3];case 1:t.sent(),t.label=2;case 2:this.navigate(e),t.label=3;case 3:return[2]}})})},e.prototype.handleRemoveHover=function(){this.renderer.removeHover()},e.prototype.handleReflow=function(){this.handleResize()},e.prototype.handleContentsClick=function(e){this.hideSettings(),this.toggleModal(this.tocView,this.contentsControl),e.preventDefault(),e.stopPropagation()},e.prototype.hideTOC=function(){this.hideModal(this.tocView,this.contentsControl)},e.prototype.hideTOCOnEscape=function(e){this.isDisplayed(this.tocView)&&27===e.keyCode&&this.hideTOC()},e.prototype.setActiveTOCItem=function(e){for(var t=Array.prototype.slice.call(this.tocView.querySelectorAll("li > a")),n=0,i=t;n<i.length;n++){i[n].className=""}var r=this.tocView.querySelector('li > a[href^="'+e+'"]');r&&(r.className="active")},e.prototype.handleSettingsClick=function(e){this.hideTOC(),this.toggleModal(this.settingsView,this.settingsControl),e.preventDefault(),e.stopPropagation()},e.prototype.hideSettings=function(){this.hideModal(this.settingsView,this.settingsControl)},e.prototype.hideSettingsOnEscape=function(e){this.isDisplayed(this.settingsView)&&27===e.keyCode&&this.hideSettings()},e.prototype.handleBookInfoClick=function(e){this.hideSettings(),this.toggleModal(this.bookInfoView,this.bookInfoControl),e.preventDefault(),e.stopPropagation()},e.prototype.hideBookInfo=function(){this.hideModal(this.bookInfoView,this.bookInfoControl)},e.prototype.hideBookInfoOnEscape=function(e){this.isDisplayed(this.bookInfoView)&&27===e.keyCode&&this.hideBookInfo()},e.prototype.navigate=function(e){this.renderer.hide(),this.showLoadingMessageAfterDelay(),this.newPosition=e},e.prototype.getStartItemHref=function(){var e,t=this.manifest.getStartLink();return t&&t.href&&(e=new URL(t.href,this.assetsUrl.href).href),e},e.prototype.getPreviousItemHref=function(e){var t="",n=this.manifest.getPreviousSpineItem(e);return n&&n.href&&(t=new URL(n.href,this.assetsUrl.href).href),t},e.prototype.getNextItemHref=function(e){var t="",n=this.manifest.getNextSpineItem(e);return n&&n.href&&(t=new URL(n.href,this.assetsUrl.href).href),t},e.prototype.showLoadingMessageAfterDelay=function(){var e=this;this.isLoading=!0,setTimeout(function(){e.isLoading&&(e.loadingMessage.style.display="block",e.loadingMessage.classList.add("is-loading"))},200)},e.prototype.hideLoadingMessage=function(){this.isLoading=!1,this.loadingMessage.style.display="none",this.loadingMessage.classList.remove("is-loading")},e}();t["default"]=g}.apply(t,i))!==undefined&&(e.exports=r)},"./src/NightTheme.ts":function(e,t,n){var i,r,o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/HTMLUtilities.ts"),n("./src/Locales.ts")],(r=function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=o(n),i=o(i);var r=function(){function e(){this.name="night-theme",this.label=i.locales.bookThemeNight}return e.prototype.start=function(){var e=document.documentElement,t=n.findRequiredIframeElement(this.bookElement.contentDocument,"html");n.setAttr(e,"data-cassis-theme","night"),n.createStylesheet(t,"night-mode-internal",":root {background-color: #1F1F1F !important; color: #FFFFFF !important} :not(a) {background-color: transparent !important; color: #FFFFFF !important; border-color: currentColor !important;} a {color: #53CEEA !important;}")},e.prototype.stop=function(){var e=document.documentElement,t=n.findRequiredIframeElement(this.bookElement.contentDocument,"html");n.removeAttr(e,"data-cassis-theme"),n.removeStylesheet(t,"night-mode-internal")},e}();t["default"]=r}.apply(t,i))!==undefined&&(e.exports=r)},"./src/PublisherFont.ts":function(e,t,n){var i,r,o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/HTMLUtilities.ts"),n("./src/Locales.ts")],(r=function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=o(n),i=o(i);var r=function(){function e(){this.name="publisher-font",this.label=i.locales.bookFontPublisher}return e.prototype.start=function(){var e=n.findRequiredIframeElement(this.bookElement.contentDocument,"html");n.setAttr(e,"data-cassis-font","publisher")},e.prototype.stop=function(){var e=n.findRequiredIframeElement(this.bookElement.contentDocument,"html");n.removeAttr(e,"data-cassis-font")},e}();t["default"]=r}.apply(t,i))!==undefined&&(e.exports=r)},"./src/ReflowNavigator.ts":function(e,t,n){var i,r,o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i["throw"](e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}l((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}},c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/Navigator.ts"),n("./src/BrowserUtilities.ts"),n("./src/HTMLUtilities.ts"),n("./src/Locales.ts"),n("./src/Templates.ts"),n("./src/Tracker/Lifecycle.ts"),n("./src/Renderer.ts")],(r=function(e,t,n,i,r,u,h,d,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=l(n),i=c(i),r=c(r),u=c(u),h=c(h),f=l(f);var p=function(e){function t(t,n,i,r,o,s,a,l,c,u,h,d,f,p,g,b,m,v,y,k){void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===d&&(d=null),void 0===f&&(f=null),void 0===p&&(p=null),void 0===g&&(g=null),void 0===b&&(b=null),void 0===m&&(m=null),void 0===v&&(v=null),void 0===y&&(y=null),void 0===k&&(k=null);var w=e.call(this,t,n,i,r,f,p,g,b,m,v,y,k)||this;return w.publisher=o,w.serif=s,w.sans=a,w.day=l,w.sepia=c,w.night=u,w.paginator=h,w.scroller=d,w}return o(t,e),t.create=function(e){return s(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:return t=new this(e.store,e.cacher||null,e.settings,e.annotator||null,e.publisher||null,e.serif||null,e.sans||null,e.day||null,e.sepia||null,e.night||null,e.paginator||null,e.scroller||null,e.tracker||null,e.libHandler||null,e.tosLink||null,e.allowFullscreen||null,e.locale||null,e.bookInfo||null,e.startPath||null,e.startPage||null),[4,t.start(e.element,e.manifestUrl,e.assetsUrl)];case 1:return n.sent(),[2,t]}})})},t.prototype.start=function(e,t,n){return s(this,void 0,void 0,function(){var i,r;return a(this,function(o){switch(o.label){case 0:this.showLoadingMessageAfterDelay(),u.localeAvailable(this.locale)||(this.locale="en"),e.innerHTML=h.navigatorTemplate(this.locale),this.manifestUrl=t,this.assetsUrl=n,o.label=1;case 1:return o.trys.push([1,5,,6]),this.initUIElements(e),this.initHelperProps(),this.setupEvents(),i=this.renderer.getIFrames(),this.publisher&&(this.publisher.bookElement=i[0]),this.serif&&(this.serif.bookElement=i[0]),this.sans&&(this.sans.bookElement=i[0]),this.day&&(this.day.bookElement=i[0]),this.sepia&&(this.sepia.bookElement=i[0]),this.night&&(this.night.bookElement=i[0]),this.paginator&&(this.paginator.bookElement=i[0]),this.scroller&&(this.scroller.bookElement=i[0]),[4,this.createLibHandler()];case 2:return o.sent(),this.createFullscreen(),[4,this.createBookInfo()];case 3:return o.sent(),this.settings.onFontChange(this.updateFont.bind(this)),this.settings.onFontSizeChange(this.updateFontSize.bind(this)),this.settings.onThemeChange(this.updateTheme.bind(this)),this.settings.onViewChange(this.updateBookView.bind(this)),this.settings.onRetailerChange(this.updateRetailer.bind(this)),this.cacher&&this.enableOffline(),this.createTosLink(),this.createSettingsFocusTrap(),this.scroller&&this.settings.getSelectedView()!==this.scroller&&(this.scrollingSuggestion.style.display="block"),[4,this.loadManifest()];case 4:return[2,o.sent()];case 5:return r=o.sent(),[2,new Promise(function(e,t){return t(r)})["catch"](function(){})];case 6:return[2]}})})},t.prototype.initUIElements=function(t){e.prototype.initUIElements.call(this,t),this.renderer=new f["default"](this.store,"reflow",this.rendererHost,1),this.scrollingSuggestion=r.findRequiredElement(t,".scrolling-suggestion"),this.chapterTitle=r.findRequiredElement(this.infoBottom,"span[class=chapter-title]")},t.prototype.handleKeyboardNavigation=function(t){return s(this,void 0,void 0,function(){return a(this,function(){return this.settings.getSelectedView()!==this.paginator?[2]:(e.prototype.handleKeyboardNavigation.call(this,t),[2])})})},t.prototype.updateFont=function(){if(this.handleResize(),this.tracker){this.settingsChangeCount++;var e=this.settings.getSelectedFont();this.tracker.handlePreference("fontFamily",e.name)}},t.prototype.updateFontSize=function(){if(this.handleResize(),this.tracker){this.settingsChangeCount++;var e=this.settings.getSelectedFontSize();this.tracker.handlePreference("fontSize",e)}},t.prototype.updateTheme=function(){if(this.tracker){this.settingsChangeCount++;var e=this.settings.getSelectedTheme();this.tracker.handlePreference("theme",e.name)}},t.prototype.updateBookView=function(e){return s(this,void 0,void 0,function(){var t,n,i,r,o,s,l,c,u,h,d,f,s,p,g=this;return a(this,function(a){switch(a.label){case 0:if(t=function(){},n=200,this.settings.getSelectedView()!==this.paginator)return[3,8];this.scrollingSuggestion.style.display="block",document.body.onscroll=function(){},this.chapterTitle.style.display="inline",this.chapterPosition.style.display="inline",r=0,o=this.renderer.eventHandlers,a.label=1;case 1:return r<o.length?(s=o[r],l=s,[4,this.handlePreviousPageClick.bind(this)]):[3,7];case 2:return l.onBackwardSwipe=a.sent(),c=s,[4,this.handleNextPageClick.bind(this)];case 3:return c.onForwardSwipe=a.sent(),u=s,[4,this.handlePreviousPageClick.bind(this)];case 4:return u.onLeftTap=a.sent(),s.onMiddleTap=this.handleToggleLinksClick.bind(this),h=s,[4,this.handleNextPageClick.bind(this)];case 5:h.onRightTap=a.sent(),s.onLeftHover=this.handleLeftHover.bind(this),s.onRightHover=this.handleRightHover.bind(this),s.onRemoveHover=this.handleRemoveHover.bind(this),s.onInternalLink=this.handleInternalLink.bind(this),s.onExternalLink=this.handleExternalLink.bind(this),s.onLeftArrow=this.handleKeyboardNavigation.bind(this),s.onRightArrow=this.handleKeyboardNavigation.bind(this),s.onDownwardSwipe=this.handleToggleView.bind(this),s.onUpwardSwipe=t,a.label=6;case 6:return r++,[3,1];case 7:return this.isDisplayed(this.linksBottom)&&this.toggleDisplay(this.linksBottom),[3,9];case 8:if(this.settings.getSelectedView()===this.scroller){for(this.scrollingSuggestion.style.display="none",document.body.onscroll=function(){clearTimeout(i),i=setTimeout(g.handleScroll.bind(g),n)},this.chapterTitle.style.display="none",this.chapterPosition.style.display="none",d=0,f=this.renderer.eventHandlers;d<f.length;d++)s=f[d],s.onBackwardSwipe=t,s.onForwardSwipe=t,s.onLeftTap=this.handleToggleLinksClick.bind(this),s.onMiddleTap=this.handleToggleLinksClick.bind(this),s.onRightTap=this.handleToggleLinksClick.bind(this),s.onLeftHover=t,s.onRightHover=t,s.onRemoveHover=t,s.onInternalLink=this.handleInternalLink.bind(this),s.onExternalLink=this.handleExternalLink.bind(this),s.onLeftArrow=t,s.onRightArrow=t,s.onDownwardSwipe=t,s.onUpwardSwipe=t;this.handleRemoveHover(),(this.isDisplayed(this.links)&&!this.isDisplayed(this.linksBottom)||this.scroller.atBottom()&&!this.isDisplayed(this.linksBottom)||!this.isDisplayed(this.links)&&!this.scroller.atBottom()&&this.isDisplayed(this.linksBottom))&&this.toggleDisplay(this.linksBottom)}a.label=9;case 9:return this.updatePositionInfo(),this.tracker&&(e?(this.tracker.handlePreference("view",e),this.tracker.makeSyncNow(),this.settingsChangeCount=0):(this.settingsChangeCount++,p=this.settings.getSelectedView(),this.tracker.handlePreference("view",p.name))),[2]}})})},t.prototype.updateChaptersLink=function(e){var t=this.getPreviousItemHref(e);""!==t?(this.previousChapterLink.href=t,this.enableAnchor(this.previousChapterLink)):(this.previousChapterLink.removeAttribute("href"),this.disableAnchor(this.previousChapterLink));var n=this.getNextItemHref(e);""!==n?(this.nextChapterLink.href=n,this.enableAnchor(this.nextChapterLink)):(this.nextChapterLink.removeAttribute("href"),this.disableAnchor(this.nextChapterLink))},t.prototype.handleRenditionLoad=function(e){return s(this,void 0,void 0,function(){var t,n,i,r,o;return a(this,function(s){switch(s.label){case 0:this.errorMessage.style.display="none",this.showLoadingMessageAfterDelay(),s.label=1;case 1:return s.trys.push([1,5,,6]),(this.hideTOC(),t=0,this.newPosition&&(t=this.newPosition.position,this.newPosition=null),this.updateFont(),this.updateFontSize(),this.updateBookView(),this.settings.getSelectedFont().start(),this.settings.getSelectedTheme().start(),this.settings.getSelectedView().start(t),this.newElementId&&(this.settings.getSelectedView().goToElement(this.newElementId),this.newElementId=null),-1!==e.indexOf("#"))?(n=e.slice(0,e.indexOf("#")),i=this.getNextItemHref(n),r=e.slice(e.indexOf("#")+1),this.newElementId=r,this.renderer.update([n,i]),[2,new Promise(function(e){return e()})]):(this.updatePositionInfo(),this.updateChaptersLink(e),this.setActiveTOCItem(e),this.populateBookTitle(),this.populateChapterTitle(e),[4,this.saveCurrentReadingPosition()]);case 2:return s.sent(),this.tracker?(this.settingsChangeCount=0,[4,this.tracker.startTracking(e)]):[3,4];case 3:s.sent(),s.label=4;case 4:return this.hideLoadingMessage(),this.renderer.show(),this.bookplateHint&&this.handleBookplateToast(),[2,new Promise(function(e){return e()})];case 5:return o=s.sent(),this.abortOnError(),[2,new Promise(function(e,t){return t(o)})["catch"](function(){})];case 6:return[2]}})})},t.prototype.populateChapterTitle=function(e){var t,n=this.manifest.getTOCItem(e);null!==n&&n.title&&(t=n.title),this.chapterTitle.textContent=t?"("+t+")":"("+u.locales.chapterTitle[this.locale]+")"},t.prototype.showModal=function(t,n){this.infoTop.setAttribute("aria-hidden","true"),this.infoBottom.setAttribute("aria-hidden","true"),this.scrollingSuggestion.setAttribute("aria-hidden","true"),this.scrollingSuggestion.tabIndex=-1,e.prototype.showModal.call(this,t,n)},t.prototype.hideModal=function(t,n){this.infoTop.setAttribute("aria-hidden","false"),this.infoBottom.setAttribute("aria-hidden","false"),this.scrollingSuggestion.setAttribute("aria-hidden","false"),this.scrollingSuggestion.tabIndex=0,e.prototype.hideModal.call(this,t,n)},t.prototype.handleToggleView=function(){return s(this,void 0,void 0,function(){var e,t;return a(this,function(n){switch(n.label){case 0:return e=this.settings.getSelectedView(),t=e===this.paginator?this.scroller:this.paginator,this.settings.forceToggleView(t,this.locale),[4,this.updateBookView("scrolling-book-view-forced")];case 1:return n.sent(),[2]}})})},t.prototype.handleToggleLinksClick=function(t){this.settings.getSelectedView()===this.scroller&&(this.scroller.atBottom()||this.toggleDisplay(this.linksBottom)),e.prototype.handleToggleLinksClick.call(this,t)},t.prototype.handlePreviousPageClick=function(e){return s(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:return this.paginator?this.paginator.onFirstPage()?[4,this.goToPreviousResource(1)]:[3,2]:[3,4];case 1:return n.sent(),[3,3];case 2:this.paginator.goToPreviousPage(),this.updatePositionInfo(),this.saveCurrentReadingPosition(),this.tracker&&(t=this.settings.getSelectedView().getCurrentPosition(),this.tracker.handleProgression("pageTurnBackward",t)),n.label=3;case 3:e.preventDefault(),e.stopPropagation(),n.label=4;case 4:return[2]}})})},t.prototype.handleNextPageClick=function(e){return s(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:return this.paginator?this.paginator.onLastPage()?[4,this.goToNextResource()]:[3,2]:[3,4];case 1:return n.sent(),[3,3];case 2:this.paginator.goToNextPage(),this.updatePositionInfo(),this.saveCurrentReadingPosition(),this.tracker&&(t=this.settings.getSelectedView().getCurrentPosition(),this.tracker.handleProgression("pageTurnForward",t)),n.label=3;case 3:e.preventDefault(),e.stopPropagation(),n.label=4;case 4:return[2]}})})},t.prototype.handleLeftHover=function(){this.paginator&&(this.paginator.onFirstPage()&&!this.previousChapterLink.hasAttribute("href")?this.renderer.removeHover():this.renderer.hoverLeft())},t.prototype.handleRightHover=function(){this.paginator&&(this.paginator.onLastPage()&&!this.nextChapterLink.hasAttribute("href")?this.renderer.removeHover():this.renderer.hoverRight())},t.prototype.handleInternalLink=function(e){return s(this,void 0,void 0,function(){var t,n;return a(this,function(i){switch(i.label){case 0:return t=this.renderer.getLocation().split("#")[0],(n=e.href.split("#")[1],e.href.split("#")[0]!==t)?[3,3]:(this.settings.getSelectedView().goToElement(n,!0),this.updatePositionInfo(),this.saveCurrentReadingPosition(),this.tracker?[4,this.tracker.handleEvents(e)]:[3,2]);case 1:i.sent(),i.label=2;case 2:return[3,7];case 3:return this.tracker?[4,this.tracker.handleEvents(e)]:[3,6];case 4:return i.sent(),[4,this.tracker.stopTracking()];case 5:i.sent(),i.label=6;case 6:this.navigate({resource:e.href,position:0}),i.label=7;case 7:return[2]}})})},t.prototype.handleScroll=function(){if(this.saveCurrentReadingPosition(),this.tracker){var e=this.settings.getSelectedView().getCurrentPosition();this.tracker.handleProgression("scroll",e)}this.scroller&&this.scroller.atBottom()?this.isDisplayed(this.linksBottom)||this.toggleDisplay(this.linksBottom):this.isDisplayed(this.linksBottom)&&!this.isDisplayed(this.links)&&this.toggleDisplay(this.linksBottom)},t.prototype.handleReflow=function(){if(e.prototype.handleReflow.call(this),this.tracker){var t=this.settings.getSelectedView().getCurrentPosition();this.tracker.handleProgression("reflow",t)}},t.prototype.handleResize=function(){var e=this.settings.getSelectedView(),t=e.getCurrentPosition(),n=this.settings.getSelectedFontSize();this.renderer.resize(n);var r=parseInt(n.slice(0,-2)),o=2*r;if(i.getWidth()>45*r){o+=Math.floor((i.getWidth()-40*r)/2)}this.paginator&&(this.paginator.sideMargin=o),this.scroller&&(this.scroller.sideMargin=o),this.paginator&&this.leftHint&&this.rightHint&&(o>2.5*r?(this.leftHint.style.left=o/2.5+"px",this.rightHint.style.right=o/2.5+"px"):(this.leftHint.style.left="",this.rightHint.style.right=""));var s=!this.isDisplayed(this.links);s&&this.toggleDisplay(this.links);var a=this.links.clientHeight;this.infoTop.style.height=a+"px",s&&this.toggleDisplay(this.links);var l=!this.isDisplayed(this.linksBottom);l&&this.toggleDisplay(this.linksBottom);var c=this.linksBottom.clientHeight;this.infoBottom.style.height=c+"px",l&&this.toggleDisplay(this.linksBottom),this.paginator&&(this.paginator.height=i.getHeight()-a-c-10),this.scroller&&(this.scroller.height=i.getHeight()-a-c-10),e.goToPosition(t),this.updatePositionInfo()},t.prototype.updatePositionInfo=function(){if(this.settings.getSelectedView()===this.paginator){var e=Math.round(this.paginator.getCurrentPage()),t=Math.round(this.paginator.getPageCount());this.chapterPosition.innerHTML=u.locales.chapterPositionPage[this.locale]+" "+e+" "+u.locales.chapterPositionOf[this.locale]+" "+t}else this.chapterPosition.innerHTML=""},t.prototype.handlePreviousChapterClick=function(e){return s(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:return this.previousChapterLink.hasAttribute("href")?(t={resource:this.previousChapterLink.href,position:0},this.tracker?[4,this.tracker.stopTracking()]:[3,2]):[3,3];case 1:n.sent(),n.label=2;case 2:this.navigate(t),n.label=3;case 3:return e.preventDefault(),e.stopPropagation(),[2]}})})},t.prototype.handleNextChapterClick=function(e){return s(this,void 0,void 0,function(){var t;return a(this,function(n){switch(n.label){case 0:return this.nextChapterLink.hasAttribute("href")?(t={resource:this.nextChapterLink.href,position:0},this.tracker?this.settings.getSelectedView()===this.scroller&&this.scroller.atBottom()?[4,this.tracker.stopTracking(d.TrackerState.Completed)]:[3,2]:[3,4]):[3,5];case 1:return n.sent(),[3,4];case 2:return[4,this.tracker.stopTracking(d.TrackerState.Stopped)];case 3:n.sent(),n.label=4;case 4:this.navigate(t),n.label=5;case 5:return e.preventDefault(),e.stopPropagation(),[2]}})})},t.prototype.handleContentsClick=function(t){e.prototype.handleContentsClick.call(this,t),this.settings.getSelectedView()===this.scroller&&(this.isDisplayed(this.tocView)?document.body.style.overflow="hidden":document.body.style.overflow="auto"),t.preventDefault(),t.stopPropagation()},t.prototype.hideTOC=function(){e.prototype.hideTOC.call(this),this.settings.getSelectedView()===this.scroller&&(document.body.style.overflow="auto")},t.prototype.navigate=function(t){if(e.prototype.navigate.call(this,t),-1===t.resource.indexOf("#")){var n=this.getNextItemHref(t.resource);this.renderer.update([t.resource,n])}else{this.newElementId=t.resource.slice(t.resource.indexOf("#")+1);var i=t.resource.slice(0,t.resource.indexOf("#"));if(i===this.renderer.getLocation())this.handleRenditionLoad(i);else{var n=this.getNextItemHref(i);this.renderer.update([i,n])}}},t.prototype.saveCurrentReadingPosition=function(){return s(this,void 0,void 0,function(){var e,t;return a(this,function(){return this.annotator?(e=this.renderer.getLocation(),t=this.settings.getSelectedView().getCurrentPosition(),[2,this.annotator.saveLastReadingPosition({resource:e,position:t})]):[2,new Promise(function(e){return e()})]})})},t}(n["default"]);t["default"]=p}.apply(t,i))!==undefined&&(e.exports=r)},"./src/Renderer.ts":function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i["throw"](e))}catch(e){o(e)}
}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}l((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}},l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/IFrameHandler.ts"),n("./src/BrowserUtilities.ts")],(r=function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a(n),i=l(i);var r=function(){function e(e,t,n,i){this.prefetch=null,this.isBeingStyled=!0,this.onRendererUpdate=function(){},this.onOrientationChange=function(){},this.store=e,this.type=t,this.element=n,this.views=i,this.framesLoaded=0,this.visibleFrames=1,this.activeFrame=0,this.frames=[],this.eventHandlers=[],this.create()}return e.prototype.create=function(){if(2===this.views)if("fxl"===this.type){this.currentOrientation=this.checkCurrentOrientation();var e=new n["default"](this.store,this.element,this.type,"left-spread","Page left content");this.frames.push(e);var t=new n["default"](this.store,this.element,this.type,"right-spread","Page right content");this.frames.push(t),"landscape"===this.currentOrientation&&(this.visibleFrames=2)}else{var i=new n["default"](this.store,this.element,this.type);this.frames.push(i);var r=new n["default"](this.store,this.element,this.type,"renderer-next");this.frames.push(r)}else{var o=new n["default"](this.store,this.element,this.type);this.frames.push(o)}for(var s=0,a=this.frames;s<a.length;s++){a[s].iFrame.addEventListener("load",this.handleIFrameLoad.bind(this))}},e.prototype.handleIFrameLoad=function(){if(++this.framesLoaded===this.views){for(;this.eventHandlers.length>0;)this.eventHandlers.pop();for(var e=0,t=this.frames;e<t.length;e++){var n=t[e];n.handleLoad(),this.eventHandlers.push(n.getEventHandler())}var i=this.getLocation();"about:blank"!==i&&this.onRendererUpdate(i),this.framesLoaded=0}},e.prototype.removePrefetch=function(){this.prefetch&&(document.head.removeChild(this.prefetch),this.prefetch=null)},e.prototype.handlePrefetch=function(e){this.removePrefetch(),this.prefetch=document.createElement("link"),this.prefetch.rel="prefetch",this.prefetch.href=e,document.head.appendChild(this.prefetch)},e.prototype.update=function(e,t){void 0===t&&(t=0),this.activeFrame=t;var n=e[0],i=e[1];2===this.views&&"fxl"===this.type?n===i?(this.atStart=!1,this.atEnd=!1,this.atBookplate=!0,this.frames[0].load(n),this.frames[1].load("about:blank")):(this.atBookplate=!1,""===n?(this.atStart=!0,this.frames[0].load(i),this.frames[1].load("about:blank")):""===i?(this.atEnd=!0,this.frames[0].load(n),this.frames[1].load("about:blank")):(this.atStart=!1,this.atEnd=!1,this.frames[0].load(n),this.frames[1].load(i)),this.handleFramesHiding()):(""!==n&&this.frames[0].load(n),""!==i?this.handlePrefetch(i):this.removePrefetch())},e.prototype.getType=function(){return this.type},e.prototype.getIFrames=function(){for(var e=[],t=0,n=this.frames;t<n.length;t++){var i=n[t];e.push(i.iFrame)}return e},e.prototype.getVisibleFrames=function(){return this.visibleFrames},e.prototype.getActiveFrame=function(){return this.activeFrame},e.prototype.getLocation=function(){return this.frames[0].getLocation()},e.prototype.onFirstPage=function(){return this.atStart},e.prototype.onLastPage=function(){return this.atEnd},e.prototype.hide=function(){this.isBeingStyled=!0,this.element.style.opacity="0"},e.prototype.show=function(){var e=this;this.isBeingStyled=!1,setTimeout(function(){e.isBeingStyled||(e.element.style.opacity="1")},150)},e.prototype.hideForSR=function(){this.element.setAttribute("aria-hidden","true")},e.prototype.showForSR=function(){this.element.setAttribute("aria-hidden","false")},e.prototype.hoverLeft=function(){this.element.className="left-hover"},e.prototype.hoverRight=function(){this.element.className="right-hover"},e.prototype.removeHover=function(){this.element.className=""},e.prototype.handleFramesHiding=function(){2===this.visibleFrames?(this.frames[0].iFrame.style.display="",this.atStart||this.atEnd||this.atBookplate?this.frames[1].iFrame.style.display="none":this.frames[1].iFrame.style.display=""):0===this.activeFrame?(this.frames[0].iFrame.style.display="",this.frames[1].iFrame.style.display="none"):(this.frames[0].iFrame.style.display="none",this.frames[1].iFrame.style.display="")},e.prototype.switchFrames=function(){0===this.activeFrame?(this.frames[0].iFrame.style.display="none",this.frames[1].iFrame.style.display="",this.activeFrame=1):(this.frames[0].iFrame.style.display="",this.frames[1].iFrame.style.display="none",this.activeFrame=0)},e.prototype.checkCurrentOrientation=function(){var e=function(){return i.getHeight()>=i.getWidth()?"portrait":"landscape"};return window.matchMedia?window.matchMedia("(orientation: landscape)").matches?"landscape":window.matchMedia("(orientation: portrait)").matches?"portrait":e():e()},e.prototype.getOrientation=function(){return this.currentOrientation},e.prototype.setFxlSize=function(){return o(this,void 0,void 0,function(){var e,t,n,r,o,a,l,c,u,r,h,d,f,p,g,b;return s(this,function(s){switch(s.label){case 0:for(e=this.checkCurrentOrientation(),this.visibleFrames=1,t=0,n=this.frames;t<n.length;t++)r=n[t],r.iFrameWindow.body.style.overflow="hidden";return this.element.style.transformOrigin="0 0",this.element.style.webkitTransformOrigin="0 0",o=1,a="0 0",[4,this.frames[0].getViewport()];case 1:for(l=s.sent(),c=0,u=this.frames;c<u.length;c++)r=u[c],r.iFrame.style.width=l.width+"px",r.iFrame.style.height=l.height+"px";return h=l,2===this.views&&"landscape"===e&&(this.atStart||this.atEnd||this.atBookplate||(h.width=2*h.width),this.visibleFrames=2,this.activeFrame=0),this.handleFramesHiding(),this.element.style.width=h.width+"px",this.element.style.height=h.height+"px",d={width:i.getWidth(),height:i.getHeight()},f=d.width/h.width,p=d.height/h.height,o=Math.min(f,p),g=(d.height-h.height*o)/2,b=(d.width-h.width*o)/2,a="translate("+b+"px, "+g+"px)",this.element.style.webkitTransform=a+" scale("+o+")",this.element.style.transform=a+" scale("+o+")",this.currentOrientation!==e&&(this.currentOrientation=e,this.onOrientationChange(this.currentOrientation,this.activeFrame,this.visibleFrames)),[2]}})})},e.prototype.normalizeReflowSize=function(e){for(var t=0,n=this.frames;t<n.length;t++){var i=n[t];i.iFrameWindow.body.style.fontSize=e,i.iFrameWindow.body.style.lineHeight="1.5"}},e.prototype.resize=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return"reflow"===this.type&&e?(this.normalizeReflowSize(e),[3,3]):[3,1];case 1:return"fxl"!==this.type?[3,3]:[4,this.setFxlSize()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},e}();t["default"]=r}.apply(t,i))!==undefined&&(e.exports=r)},"./src/SansFont.ts":function(e,t,n){var i,r,o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/HTMLUtilities.ts"),n("./src/Locales.ts")],(r=function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=o(n),i=o(i);var r=function(){function e(){this.name="sans-font",this.label=i.locales.bookFontSans}return e.prototype.start=function(){var e=n.findRequiredIframeElement(this.bookElement.contentDocument,"html");n.setAttr(e,"data-cassis-font","sans"),n.createStylesheet(e,"sans-font-internal","* {font-family: Seravek, Calibri, Roboto, Arial, sans-serif !important;}")},e.prototype.stop=function(){var e=n.findRequiredIframeElement(this.bookElement.contentDocument,"html");n.removeAttr(e,"data-cassis-font"),n.removeStylesheet(e,"sans-font-internal")},e}();t["default"]=r}.apply(t,i))!==undefined&&(e.exports=r)},"./src/ScrollingBookView.ts":function(e,t,n){var i,r,o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/BrowserUtilities.ts"),n("./src/HTMLUtilities.ts"),n("./src/Locales.ts")],(r=function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=o(n),i=o(i),r=o(r);var s=function(){function e(){this.name="scrolling-book-view",this.label=r.locales.bookViewScrolling,this.scrollingElement=document.scrollingElement||document.body,this.sideMargin=0,this.height=0}return e.prototype.setIFrameSize=function(){this.bookElement.style.height="",this.bookElement.style.width=n.getWidth()+"px";var e=i.findRequiredIframeElement(this.bookElement.contentDocument,"html"),t=i.findRequiredIframeElement(this.bookElement.contentDocument,"body"),r=n.getWidth()-2*this.sideMargin+"px";t.style.width=r,t.style.marginLeft=this.sideMargin+"px",t.style.marginRight=this.sideMargin+"px";var o=this.height,s=e.scrollHeight+20;this.bookElement.style.height=Math.max(o,s)+"px";for(var a=Array.prototype.slice.call(t.querySelectorAll("img, svg")),l=0,c=a;l<c.length;l++){c[l].style.maxWidth=r}},e.prototype.start=function(e){this.goToPosition(e)},e.prototype.stop=function(){this.bookElement.style.height="",this.bookElement.style.width="";var e=i.findRequiredIframeElement(this.bookElement.contentDocument,"body");e.style.width="",e.style.marginLeft="",e.style.marginRight="";for(var t=Array.prototype.slice.call(e.querySelectorAll("img, svg")),n=0,r=t;n<r.length;n++){r[n].style.maxWidth=""}},e.prototype.getCurrentPosition=function(){return this.scrollingElement.scrollTop/this.scrollingElement.scrollHeight},e.prototype.atBottom=function(){return this.scrollingElement.scrollHeight-this.scrollingElement.scrollTop<=window.innerHeight},e.prototype.goToPosition=function(e){this.setIFrameSize(),this.scrollingElement.scrollTop=this.scrollingElement.scrollHeight*e},e.prototype.goToElement=function(e){var t=this.bookElement.contentDocument.getElementById(e);t&&(t.scrollIntoView(),this.scrollingElement.scrollHeight-t.offsetTop>=this.height&&(this.scrollingElement.scrollTop=Math.max(0,this.scrollingElement.scrollTop-this.height/3)))},e}();t["default"]=s}.apply(t,i))!==undefined&&(e.exports=r)},"./src/SepiaTheme.ts":function(e,t,n){var i,r,o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/HTMLUtilities.ts"),n("./src/Locales.ts")],(r=function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=o(n),i=o(i);var r=function(){function e(){this.name="sepia-theme",this.label=i.locales.bookThemeSepia}return e.prototype.start=function(){var e=document.documentElement,t=n.findRequiredIframeElement(this.bookElement.contentDocument,"html");n.setAttr(e,"data-cassis-theme","sepia"),n.createStylesheet(t,"sepia-mode-internal",":root {background-color: #f6ecd9 !important}  img, svg {background-color: transparent !important; mix-blend-mode: multiply;}")},e.prototype.stop=function(){var e=document.documentElement,t=n.findRequiredIframeElement(this.bookElement.contentDocument,"html");n.removeAttr(e,"data-cassis-theme"),n.removeStylesheet(t,"sepia-mode-internal")},e}();t["default"]=r}.apply(t,i))!==undefined&&(e.exports=r)},"./src/SerifFont.ts":function(e,t,n){var i,r,o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/HTMLUtilities.ts"),n("./src/Locales.ts")],(r=function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=o(n),i=o(i);var r=function(){function e(){this.name="serif-font",this.label=i.locales.bookFontSerif}return e.prototype.start=function(){var e=n.findRequiredIframeElement(this.bookElement.contentDocument,"html");n.setAttr(e,"data-cassis-font","serif"),n.createStylesheet(e,"serif-font-internal","* {font-family: 'Iowan Old Style', 'Sitka Text', Palatino, 'Book Antiqua', serif !important;}")},e.prototype.stop=function(){var e=n.findRequiredIframeElement(this.bookElement.contentDocument,"html");n.removeAttr(e,"data-cassis-font"),n.removeStylesheet(e,"serif-font-internal")},e}();t["default"]=r}.apply(t,i))!==undefined&&(e.exports=r)},"./src/Templates.ts":function(e,t,n){var i,r,o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/Icons.ts"),n("./src/Locales.ts")],(r=function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=o(n),i=o(i),t.settingsTemplate=function(e){return'\n    <ul class="settings-menu" role="menu">\n        '+e+"\n    </ul>\n"},t.sectionTemplate=function(e){return'\n    <li role="none"><ul class="settings-options" role="menu">\n        '+e+"\n    </ul></li>\n"},t.subSectionTemplate=function(e,t,r,o,s,a,l){return void 0===l&&(l="en"),'\n    <li role="none">\n    <button id="'+o+'" class="'+e+'" role="'+r+'" tabindex="-1">'+t+"\n     "+n.makeIconTemplate("right-icon",i.locales.submenuIcon[l],n.icons.right,"submenuIcon")+'</button>\n    <ul class="subsettings-options" role="menu">\n      <li role="none"><button id="submenu-back" class="submenu-back" role="button" tabindex="-1">\n      '+n.makeIconTemplate("left-icon",i.locales.closeIcon[l],n.icons.left,"submenuIcon")+" \n      "+s+"</li>\n      "+a+"\n    </ul></li>\n"},t.optionTemplate=function(e,t,n,i,r,o){return'\n    <li class="'+e+'" role="none"><button id="'+o+'" class="'+t+'" role="'+i+'" tabindex="-1">'+n+r+"</button></li>\n"},t.offlineTemplate='\n    <li>\n        <div class="offline-status"></div>\n    </li>\n',t.aboutBookTemplate=function(e,t,n,i,r){return'\n    <li class="'+e+'" role="none"><button id="'+r+'" class="'+t+'" role="'+i+'" tabindex="-1" aria-expanded="false" aria-controls="bookinfo" aria-haspopup="true">'+n+"</button></li>\n"},t.tosTemplate='\n    <li role="menuitem">\n        <div class="tos-link"></div>\n    </li>\n',t.bookInfoCloseButton='\n  <button class="bookinfo-close" tabindex="-1">'+n.makeIconUse("close-icon","icon close")+"</button>\n",t.bookInfoWrapperTemplate=function(e){return'\n  <div class="bookinfo-wrapper">\n    '+e+"\n  </div>\n"},t.bookInfoTemplate=function(e,t,n){return void 0===n&&(n=""),'\n  <div class="'+e+'">'+n+t+"</div>\n"},t.bookInfoBuyButton=function(e,t,n,i){return'\n  <a id="'+e+'" class="'+t+'" href="'+n+'" target="_blank" rel="noopener" tabindex="-1">'+i+"</a>\n"},t.bookInfoShareButton=function(e,t,n){return'\n  <button id="'+e+'" class="'+t+'" role="button" tabindex="-1">'+n+"</button>\n"},t.libHandlerTemplate=function(e){return'\n  <button id="lib-handler" role="button" aria-label="'+i.locales.libHandler[e]+'">\n    '+n.makeIconTemplate("lib-icon",i.locales.libHandler[e],n.icons.libHandler,"icon libHandler-icon")+"\n  </button>\n"},t.shoppingCartTemplate=function(e,t,i){return'\n  <a id="shopping-cart" href="'+e+'" aria-label="'+i+'" target="_blank" rel="noopener">\n    <svg xmlns="http://www.w3.org/2000/svg" width="'+n.WIDTH_ATTR+'" height="'+n.HEIGHT_ATTR+'" viewBox="'+n.VIEWBOX_ATTR+'" aria-labelledby="cart-label" preserveAspectRatio="xMidYMid meet" role="img" class="icon">\n      <title id="cart-label">'+t+"</title>\n      "+n.icons.cart+'\n    </svg>\n    <span class="setting-text cart">'+t+"</span>\n  </a>\n"},t.tosLinkTemplate=function(e,t){return'\n    <a href="'+e+'" target="_blank" rel="noopener" tabindex="-1">'+t+"</a>\n"},t.navigatorTemplate=function(e){return void 0===e&&(e="en"),'\n  <nav class="publication" aria-label="'+i.locales.controlPanel[e]+'">\n    <div class="controls-trigger">\n      <button class="trigger" aria-haspopup="true" aria-expanded="true">\n        '+n.makeIconTemplate("menu-icon",i.locales.menuIcon[e],n.icons.menu,"icon menu open inactive-icon")+'\n      </button>\n    </div>\n    <div class="controls">\n        '+n.makeIconSymbol("close-icon",i.locales.closeIcon[e],n.icons.close)+"\n        "+n.makeIconSymbol("check-icon",i.locales.checkedIcon[e],n.icons.check)+'\n      <a href="#settings-control" class="scrolling-suggestion" style="display: none">\n          '+i.locales.scrollingSuggestion[e]+'\n      </a>\n      <ul class="links top active">\n        <li class="toc-wrapper">\n          <button class="contents disabled" aria-labelledby="contents-label" aria-haspopup="true" aria-expanded="false">\n            '+n.makeIconTemplate("toc-icon",i.locales.tocIcon[e],n.icons.toc,"icon open")+"\n            "+n.makeIconUse("close-icon","icon close inactive-icon")+'\n            <span class="setting-text contents" id="contents-label">'+i.locales.contents[e]+'</span>\n          </button>\n          <div class="contents-view controls-view inactive" aria-hidden="true"></div>\n        </li>\n        <li class="settings-wrapper">\n          <button id="settings-control" class="settings" aria-labelledby="settings-label" aria-expanded="false" aria-haspopup="true">\n            '+n.makeIconTemplate("settings-icon",i.locales.settings[e],n.icons.settings,"icon open")+"\n            "+n.makeIconUse("close-icon","icon close inactive-icon")+'\n            <span class="setting-text settings" id="settings-label">'+i.locales.settings[e]+'</span>\n          </button>\n          <div class="settings-view controls-view inactive" aria-hidden="true"></div>\n        </li>\n      </ul>\n    </div>\n    <!-- /controls -->\n  </nav>\n  <main style="overflow: hidden" tabindex="-1">\n    <div class="loading" style="display:none;">\n      '+n.makeIconTemplate("loading-icon",i.locales.loadingIcon[e],n.icons.loading)+'\n    </div>\n    <div class="error" style="display:none;">\n      <span>\n        '+n.makeIconTemplate("error-icon",i.locales.errorIcon[e],n.icons.error)+"\n      </span>\n      <span>"+i.locales.errorLabel[e]+'</span>\n      <button class="go-back">'+i.locales.goBack[e]+'</button>\n      <button class="try-again">'+i.locales.tryAgain[e]+'</button>\n    </div>\n    <div class="info top">\n      <span class="book-title" role="heading" aria-level="1"></span>\n    </div>\n    <div id="renderer"></div>\n    <div class="desktop-hints" aria-hidden="true">\n        '+n.makeIconTemplate("left-icon",i.locales.previousPage[e],n.icons.left,"icon hint left-hint")+"\n        "+n.makeIconTemplate("right-icon",i.locales.nextPage[e],n.icons.right,"icon hint right-hint")+'\n    </div>\n    <div class="info bottom">\n      <span class="chapter-position"></span>\n      <span class="chapter-title"></span>\n    </div>    \n  </main>\n  <nav class="publication" aria-labelledby="chapters">\n    <div class="controls">\n      <ul class="links bottom active" aria-hidden="true">\n        <li>\n          <a rel="prev" class="disabled" role="button" aria-labelledby="previous-label">\n          '+n.makeIconTemplate("previous-icon",i.locales.previousChapter[e],n.icons.previous)+'\n          <span class="chapter-control" id="previous-label">'+i.locales.previousChapter[e]+'</span>\n          </a>\n        </li>\n        <li id="chapters">'+i.locales.chapters[e]+'</li>\n        <li>\n          <a rel="next" class="disabled" role="button" aria-labelledby="next-label">\n            <span class="chapter-control" id ="next-label">'+i.locales.nextChapter[e]+"</span>\n            "+n.makeIconTemplate("next-icon",i.locales.nextChapter[e],n.icons.next)+'\n          </a>\n        </li>\n      </ul>\n    </div>\n    <!-- /controls -->\n  </nav>\n  <div class="bookinfo inactive" id="bookinfo" role="contentinfo" aria-hidden="true">\n  </div>\n'},t.FXLNavigatorTemplate=function(e){return void 0===e&&(e="en"),'<nav class="publication" aria-label="'+i.locales.controlPanel[e]+'">\n<div class="controls-trigger">\n  <button class="trigger" aria-haspopup="true" aria-expanded="true">\n    '+n.makeIconTemplate("menu-icon",i.locales.menuIcon[e],n.icons.menu,"icon menu open inactive-icon")+'\n  </button>\n</div>\n<div class="controls">\n    '+n.makeIconSymbol("close-icon",i.locales.closeIcon[e],n.icons.close)+"\n    "+n.makeIconSymbol("check-icon",i.locales.checkedIcon[e],n.icons.check)+'\n  <ul class="links top active">\n    <li class="toc-wrapper">\n      <button class="contents disabled" aria-labelledby="contents-label" aria-haspopup="true" aria-expanded="false">\n        '+n.makeIconTemplate("toc-icon",i.locales.tocIcon[e],n.icons.toc,"icon open")+"\n        "+n.makeIconUse("close-icon","icon close inactive-icon")+'\n        <span class="setting-text contents" id="contents-label">'+i.locales.contents[e]+'</span>\n      </button>\n      <div class="contents-view controls-view inactive" aria-hidden="true"></div>\n    </li>\n    <li class="info top">\n      <span class="book-title" role="heading" aria-level="1"></span>\n    </li>\n    <li class="settings-wrapper">\n          <button id="settings-control" class="settings" aria-labelledby="settings-label" aria-expanded="false" aria-haspopup="true">\n            '+n.makeIconTemplate("settings-icon",i.locales.settings[e],n.icons.settings,"icon open")+"\n            "+n.makeIconUse("close-icon","icon close inactive-icon")+'\n            <span class="setting-text settings" id="settings-label">'+i.locales.settings[e]+'</span>\n          </button>\n          <div class="settings-view controls-view inactive" aria-hidden="true"></div>\n        </li>\n  </ul>\n</div>\n<!-- /controls -->\n</nav>\n<main style="overflow: hidden" tabindex="-1">\n<div class="loading" style="display:none;">\n  '+n.makeIconTemplate("loading-icon",i.locales.loadingIcon[e],n.icons.loading)+'\n</div>\n<div class="error" style="display:none;">\n  <span>\n    '+n.makeIconTemplate("error-icon",i.locales.errorIcon[e],n.icons.error)+"\n  </span>\n  <span>"+i.locales.errorLabel[e]+'</span>\n  <button class="go-back">'+i.locales.goBack[e]+'</button>\n  <button class="try-again">'+i.locales.tryAgain[e]+'</button>\n</div>\n<div id="renderer"></div>\n<div class="desktop-hints" aria-hidden="true">\n  '+n.makeIconTemplate("left-icon",i.locales.previousPage[e],n.icons.left,"icon hint left-hint")+"\n  "+n.makeIconTemplate("right-icon",i.locales.nextPage[e],n.icons.right,"icon hint right-hint")+'\n  </div>\n</main>\n<nav class="publication" aria-label="'+i.locales.pages[e]+'">\n<div class="controls">\n  <ul class="links bottom active" aria-hidden="true">\n    <li>\n      <a rel="prev" class="disabled" role="button" aria-labelledby="previous-label">\n      '+n.makeIconTemplate("previous-icon",i.locales.previousPage[e],n.icons.previous)+'\n      <span class="chapter-control" id="previous-label">'+i.locales.previousPage[e]+'</span>\n      </a>\n    </li>\n    <li class="info bottom">\n      <span class="chapter-position"></span>\n    </li>\n    <li>\n      <a rel="next" class="disabled" role="button" aria-labelledby="next-label">\n        <span class="chapter-control" id ="next-label">'+i.locales.nextPage[e]+"</span>\n        "+n.makeIconTemplate("next-icon",i.locales.nextPage[e],n.icons.next)+'\n      </a>\n    </li>\n  </ul>\n</div>\n<!-- /controls -->\n</nav>\n<div class="bookinfo inactive" id="bookinfo" role="contentinfo" aria-hidden="true">\n</div>'}}.apply(t,i))!==undefined&&(e.exports=r)},"./src/Toast.ts":function(e,t,n){var i,r,o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/HTMLUtilities.ts")],(r=function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=o(n);var i=function(){function e(e,t,n,i){void 0===t&&(t="bottom"),void 0===n&&(n=6e3),this.dialog=null,this.toastDeleteCallback=function(){},this.linkClickCallback=function(){},this.delay=n,this.link=i,this.hideToastOnClick=this.hideToastOnClick.bind(this),this.hideToastOnEscape=this.hideToastOnEscape.bind(this),this.create(e,t),this.setup()}return e.prototype.create=function(e,t){var i=n.findElement(document.body,"#toast");null!==i&&i.click();var r=document.createElement("div");if(r.className="toast-ui "+t,r.id="toast",r.setAttribute("role","status"),r.textContent=e,this.link){var o=document.createElement("a");o.href=this.link.href,o.textContent=this.link.text,r.appendChild(o)}document.body.appendChild(r)},e.prototype.setup=function(){var e=this;this.dialog=n.findRequiredElement(document.body,"#toast"),this.dialog.addEventListener("click",this.hideToastOnClick),window.addEventListener("keydown",this.hideToastOnEscape),setTimeout(function(){e.deleteToast()},this.delay)},e.prototype.deleteToast=function(){this.dialog&&(document.body.removeChild(this.dialog),this.dialog.removeEventListener("click",this.hideToastOnClick),window.removeEventListener("keydown",this.hideToastOnEscape),this.dialog=null,this.toastDeleteCallback())},e.prototype.hideToastOnClick=function(e){e.preventDefault(),e.stopPropagation();var t=e.target;this.link&&"a"===t.tagName.toLowerCase()&&this.linkClickCallback(t),this.deleteToast()},e.prototype.hideToastOnEscape=function(e){this.dialog&&27===e.keyCode&&this.deleteToast()},e.prototype.onToastDelete=function(e){this.toastDeleteCallback=e},e.prototype.onToastLinkClick=function(e){this.linkClickCallback=e},e}();t["default"]=i}.apply(t,i))!==undefined&&(e.exports=r)},"./src/Tracker/Lifecycle.ts":function(e,t,n){var i,r,o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();i=[n,t],(r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e.Started="started",e.Paused="paused",e.Resumed="resumed",e.Stopped="stopped",e.Completed="completed",e.Terminated="terminated"}(t.TrackerState||(t.TrackerState={}));var n=function(){function e(e){this.type=e}return e}(),i=function(){function e(){this._registry={}}return e.prototype.addEventListener=function(e,t){this.getRegistry(e).push(t)},e.prototype.removeEventListener=function(e,t){var n=this.getRegistry(e),i=n.indexOf(t);i>-1&&n.splice(i,1)},e.prototype.dispatchEvent=function(e){return e.target=this,Object.freeze(e),this.getRegistry(e.type).forEach(function(t){return t(e)}),!0},e.prototype.getRegistry=function(e){return this._registry[e]=this._registry[e]||[]},e}(),r=function(e){function t(t,n){var i=e.call(this,t)||this;return i.newState=n.newState,i.oldState=n.oldState,i.originalEvent=n.originalEvent,i}return o(t,e),t}(n);t.StateChangeEvent=r;var s="onpageshow"in self,a="object"==typeof window.safari&&window.safari.pushNotification,l=function(e){return e.reduce(function(e,t,n){return e[t]=n,e},{})},c=function(e){function t(){var n=e.call(this)||this;return n.getLegalStateTransitionPath=function(e,n){for(var i=void 0,r=0;i=t.LEGAL_STATE_TRANSITIONS[r];++r){var o=i[e],s=i[n];if(o>=0&&s>=0&&s>o)return Object.keys(i).slice(o,s+1)}return[]},n.getCurrentState=function(){return document.visibilityState===t.HIDDEN?t.HIDDEN:t.ACTIVE},n._state=n.getCurrentState(),n.handleEvents=n.handleEvents.bind(n),t.EVENTS.forEach(function(e){return addEventListener(e,n.handleEvents,!0)}),a&&addEventListener("beforeunload",function(e){n._safariBeforeUnloadTimeout=setTimeout(function(){!e.defaultPrevented&&e.returnValue&&n.dispatchChangesIfNeeded(e,t.HIDDEN)},0)}),n}return o(t,e),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageWasDiscarded",{get:function(){return document.wasDiscarded||!1},enumerable:!0,configurable:!0}),t.prototype.dispatchChangesIfNeeded=function(e,t){if(t!==this._state)for(var n=this._state,i=this.getLegalStateTransitionPath(n,t),o=0;o<i.length-1;++o){var s=i[o],a=i[o+1];this._state=a,this.dispatchEvent(new r("statechange",{oldState:s,newState:a,originalEvent:e}))}},t.prototype.handleEvents=function(e){switch(a&&clearTimeout(this._safariBeforeUnloadTimeout),e.type){case"pageshow":case"resume":this.dispatchChangesIfNeeded(e,this.getCurrentState());break;case"focus":this._state!==t.ACTIVE&&this.dispatchChangesIfNeeded(e,t.ACTIVE);break;case"blur":this._state===t.ACTIVE&&this.dispatchChangesIfNeeded(e,this.getCurrentState());break;case"pagehide":case"unload":this.dispatchChangesIfNeeded(e,e.persisted?t.FROZEN:t.TERMINATED);break;case"visibilitychange":this._state!==t.FROZEN&&this._state!==t.TERMINATED&&this.dispatchChangesIfNeeded(e,this.getCurrentState());break;case"freeze":this.dispatchChangesIfNeeded(e,t.FROZEN)}},t.ACTIVE="active",t.HIDDEN="hidden",t.FROZEN="frozen",t.TERMINATED="terminated",t.LEGAL_STATE_TRANSITIONS=[[t.ACTIVE,t.HIDDEN,t.TERMINATED],[t.ACTIVE,t.HIDDEN,t.FROZEN],[t.HIDDEN,t.ACTIVE],[t.FROZEN,t.HIDDEN],[t.FROZEN,t.ACTIVE]].map(l),t.EVENTS=["focus","blur","visibilitychange","freeze","resume","pageshow",s?"pagehide":"unload"],t}(i);t.Lifecycle=c}.apply(t,i))!==undefined&&(e.exports=r)},"./src/Tracker/Records.ts":function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i["throw"](e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}l((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t};i=[n,t,n("./src/Tracker/TrackerUtilities.ts"),n("./src/Tracker/Lifecycle.ts")],(r=function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a(n);var r=function(){function e(e,t,n){this.chapterId=e,this.store=t,this.epub_id=n,this.chapterId=this.epub_id+this.chapterId,this.store}return e.prototype.getIncrement=function(){return o(this,void 0,void 0,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return[4,this.store.get(this.chapterId)];case 1:return e=n.sent(),t=0,e?t=parseInt(e,10):this.setRecordItem(this.chapterId,"0"),[2,new Promise(function(e){return e(t)})]}})})},e.prototype.incrementSession=function(){return o(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return[4,this.getIncrement()];case 1:return e=t.sent(),e=1+e,this.setRecordItem(this.chapterId,e.toString()),[2]}})})},e.prototype.startSession=function(e){return o(this,void 0,void 0,function(){var t,n;return s(this,function(r){switch(r.label){case 0:return this.startHearbeat(),[4,this.getIncrement()];case 1:return t=r.sent(),[4,this.store.get(this.chapterId+t.toString())];case 2:return n=r.sent(),
null===n?[3,5]:[4,this.endSession(i.TrackerState.Terminated)];case 3:return r.sent(),[4,this.getIncrement()];case 4:t=r.sent(),r.label=5;case 5:return this.setRecordItem(this.chapterId+t.toString(),JSON.stringify(e)),[2]}})})},e.prototype.getSessions=function(){return o(this,void 0,void 0,function(){var e,t,n,i,r;return s(this,function(o){switch(o.label){case 0:return[4,this.getIncrement()];case 1:e=o.sent(),t=[],n=0,o.label=2;case 2:return n<=e?[4,this.store.get(this.chapterId+n.toString())]:[3,5];case 3:i=o.sent(),null!==i&&(r=JSON.parse(i),t.push(r)),o.label=4;case 4:return n++,[3,2];case 5:return[2,t]}})})},e.prototype.updateSession=function(e,t,n){return o(this,void 0,void 0,function(){var i,r,o;return s(this,function(s){switch(s.label){case 0:return[4,this.getIncrement()];case 1:return i=s.sent(),[4,this.store.get(this.chapterId+i.toString())];case 2:return r=s.sent(),null!==r&&(o=JSON.parse(r),o[e]||!0!==n||(o[e]=[]),!0===n?o[e].push(t):o[e]=t,this.setRecordItem(this.chapterId+i.toString(),JSON.stringify(o))),[2]}})})},e.prototype.endSession=function(e){return o(this,void 0,void 0,function(){var t,i,r;return s(this,function(o){switch(o.label){case 0:return[4,this.getIncrement()];case 1:return t=o.sent(),[4,this.store.get(this.chapterId+t.toString())];case 2:return null===(i=o.sent())?[3,4]:(r=JSON.parse(i),r.eT=n.createTimestamp(),e&&(r.tE=e),this.setRecordItem(this.chapterId+t.toString(),JSON.stringify(r)),[4,this.incrementSession()]);case 3:o.sent(),o.label=4;case 4:return[2]}})})},e.prototype.getHeartbeat=function(){return o(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return[4,this.store.get(this.chapterId+e.HEARTBEAT_KEY)];case 1:return t=n.sent(),[2,t]}})})},e.prototype.setHeartbeat=function(t){t.increment=1+t.increment,t.time=n.createTimestamp(),this.setRecordItem(this.chapterId+e.HEARTBEAT_KEY,JSON.stringify(t))},e.prototype.startHearbeat=function(){var t={increment:1,time:n.createTimestamp()};this.setRecordItem(this.chapterId+e.HEARTBEAT_KEY,JSON.stringify(t)),this.setRecordItem(this.chapterId+e.START_KEY,JSON.stringify(n.createTimestamp()))},e.prototype.setRecordItem=function(e,t){return o(this,void 0,void 0,function(){return s(this,function(){return[2,this.store.set(e,t)]})})},e.HEARTBEAT_KEY="Heartbeat",e.START_KEY="HeartbeatStart",e}();t["default"]=r}.apply(t,i))!==undefined&&(e.exports=r)},"./src/Tracker/Report.ts":function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i["throw"](e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}l((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};i=[n,t,n("./src/Tracker/Records.ts"),n("./src/Tracker/Lifecycle.ts")],(r=function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a(n);var r=function(){function e(e,t,n,i,r,o,s,a,l,c){this.epub_id=e,this.v=t,this.chapterid=n,this.dT=i,this.heartbeat=r,this.stream=o,this.app=s,this.appVersion=a,this.deviceId=l,this.rT=c,this.epub_id=e,this.v=t,this.chapterid=n,this.dT=i,this.heartbeat=r,this.stream=o,this.app=s,this.appVersion=a,this.screen={width:window.screen.width,height:window.screen.height},this.pixelRatio=window.devicePixelRatio,this.deviceId=l,this.rT=c}return e}(),l=function(){function e(e,t,n,r,o,s,a,l,c,u,h){var d=this;this.tracks=e,this.store=t,this.epub_id=n,this.v=r,this.chapterid=o,this.dT=s,this.heartbeat=a,this.app=l,this.appVersion=c,this.deviceId=u,this.rT=h,this.streamFilter=function(e){var t,n=d.heartbeat;return t=e.eT?new Date(e.eT).getTime()-new Date(e.sT).getTime():-1,e.eT=undefined,e.tE===i.TrackerState.Completed||e.tE===i.TrackerState.Terminated||e.I!==undefined||e.rE!==undefined||e.sE!==undefined||e.pE!==undefined?(e.h===undefined&&(e.h=1),!0):!(t<=1e3||e.h===undefined||!t||isNaN(e.h)&&(e.h=t/n,0))},this.tracks=e,this.store=t,this.epub_id=n,this.v=r,this.chapterid=o,this.dT=s,this.heartbeat=a,this.app=l,this.appVersion=c,this.deviceId=u,this.rT=h}return e.prototype.generateStream=function(e,t,i){return o(this,void 0,void 0,function(){var r,o,a,l,c;return s(this,function(s){switch(s.label){case 0:r=[],o=0,s.label=1;case 1:return o<e.length?(a=new n["default"](e[o],t,i),c=(l=r).concat,[4,a.getSessions()]):[3,4];case 2:r=c.apply(l,[s.sent()]),s.label=3;case 3:return o++,[3,1];case 4:return[2,r=r.filter(this.streamFilter)]}})})},e.prototype.wrapStream=function(){return o(this,void 0,void 0,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return[4,this.generateStream(this.tracks,this.store,this.epub_id)];case 1:return e=n.sent(),e.length>0?(t=new r(this.epub_id,this.v,this.chapterid,this.dT,this.heartbeat,e,this.app,this.appVersion,this.deviceId,this.rT),[2,t]):[2,null]}})})},e}();t.Report=l}.apply(t,i))!==undefined&&(e.exports=r)},"./src/Tracker/Session.ts":function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i["throw"](e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}l((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};i=[n,t,n("./src/Tracker/TrackerUtilities.ts"),n("./src/Tracker/Records.ts")],(r=function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a(n),i=l(i);var r=function(){function e(e,t,i,r,o){this.id=e,this.t=t,this.xpath=i,this.href=r,this.src=o,this.id=e,this.t=t,this.sT=n.createTimestamp(),this.xpath=i,this.href=r,this.src=o}return e}();t.Interact=r;var c=function(){function e(e,t,i){this.t=e,this.p=t,this.sp=i,this.t=e,this.sT=n.createTimestamp(),this.p=t,this.sp=i}return e}();t.ReaderEvent=c;var u=function(){function e(e,t){this.t=e,this.v=t,this.t=e,this.v=t,this.sT=n.createTimestamp()}return e}();t.PreferenceEvent=u;var h=function(){function e(e,t){this.t=e,this.n=t,this.t=e,this.n=t,this.sT=n.createTimestamp()}return e}();t.ShareEvent=h;var d=function(){function e(e,t,a,l){var d=this;this.id=e,this.heartbeat_rate=t,this.store=a,this.epub_id=l,this.startSession=function(e){return o(d,void 0,void 0,function(){var t;return s(this,function(i){switch(i.label){case 0:return[4,this.chapterRecords.startSession({sT:n.createTimestamp(),id:this.id,tE:e})];case 1:return i.sent(),t=setTimeout,[4,this.updateHeartbeat];case 2:return t.apply(void 0,[i.sent(),this.heartbeat_rate]),this.heartbeat=!0,this.trackerState=e,[2]}})})},this.updateHeartbeat=function(){return o(d,void 0,void 0,function(){var e,t,n,i,r,o,a;return s(this,function(s){switch(s.label){case 0:return s.trys.push([0,7,,8]),[4,this.chapterRecords.getHeartbeat()];case 1:return null===(e=s.sent())?[3,6]:(t=JSON.parse(e),n=new Date(t.time).getTime(),i=(new Date).getTime(),r=i-n,r>=9e5?[4,this.startSession(this.trackerState)]:[3,3]);case 2:return s.sent(),[3,6];case 3:return this.heartbeat?(this.chapterRecords.setHeartbeat(t),[4,this.chapterRecords.updateSession("h",t.increment)]):[3,6];case 4:return s.sent(),o=setTimeout,[4,this.updateHeartbeat];case 5:o.apply(void 0,[s.sent(),this.heartbeat_rate]),s.label=6;case 6:return[3,8];case 7:return a=s.sent(),[3,8];case 8:return[2]}})})},this.click=function(e){return o(d,void 0,void 0,function(){var t,n;return s(this,function(i){switch(i.label){case 0:return"a"!==e.tagName.toLowerCase()&&"img"!==e.tagName.toLowerCase()?[3,2]:(t=new r(e.tagName.toLowerCase()+"#"+e.id,"cl"),n=this.getXPathForElement(e),n.length>0&&(t.xpath=n),e.href?t.href=e.href:e.parentElement.href?t.href=e.parentElement.href:e.closest&&e.closest("a[href]")&&(t.href=e.closest("a[href]").href),[4,this.chapterRecords.updateSession("I",t,!0)]);case 1:i.sent(),i.label=2;case 2:return[2]}})})},this.progress=function(e,t,n){return o(d,void 0,void 0,function(){var i;return s(this,function(r){switch(r.label){case 0:return i=n!==undefined?new c(e,t,n):new c(e,t),[4,this.chapterRecords.updateSession("rE",i,!0)];case 1:return r.sent(),[2]}})})},this.preference=function(e,t){return o(d,void 0,void 0,function(){var n;return s(this,function(i){switch(i.label){case 0:return n=new u(e,t),[4,this.chapterRecords.updateSession("pE",n,!0)];case 1:return i.sent(),[2]}})})},this.share=function(e,t){return o(d,void 0,void 0,function(){var n;return s(this,function(i){switch(i.label){case 0:return n=new h(e,t),[4,this.chapterRecords.updateSession("sE",n,!0)];case 1:return i.sent(),[2]}})})},this.unload=function(e){return o(d,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),this.stopHeartbeat(),e?[4,this.chapterRecords.endSession(e)]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,this.chapterRecords.endSession()];case 3:n.sent(),n.label=4;case 4:return[3,6];case 5:return t=n.sent(),[3,6];case 6:return[2]}})})},this.id,this.heartbeat,this.epub_id,this.trackerState,this.chapterRecords=new i["default"](this.id,this.store,this.epub_id),this.heartbeat_rate=1e3*this.heartbeat_rate}return e.prototype.stopHeartbeat=function(){this.heartbeat&&(this.heartbeat=!1)},e.prototype.getXPathForElement=function(e,t){void 0===t&&(t=null);var n,i,r="";for(t||(t=document);e!==t.documentElement&&e.parentNode;){for(n=0,i=e;i;)1===i.nodeType&&i.nodeName===e.nodeName&&(n+=1),i=i.previousSibling;r=e.nodeName.toLowerCase()+"["+n+"]/"+r,e=e.parentNode}return r="/"+r,r=r.replace(/\/$/,"")},e}();t.Session=d}.apply(t,i))!==undefined&&(e.exports=r)},"./src/Tracker/Tracker.ts":function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i["throw"](e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}l((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};i=[n,t,n("./src/Tracker/Session.ts"),n("./src/Tracker/Report.ts"),n("./src/Tracker/TrackerUtilities.ts"),n("./node_modules/uuid/index.js"),n("./src/EpubReadingSystem.ts"),n("./src/HTMLUtilities.ts"),n("./src/Locales.ts"),n("./src/Tracker/Lifecycle.ts")],(r=function(e,t,n,i,r,c,u,h,d,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a(r),c=l(c),h=a(h),d=a(d);var p=function(){function e(t){var i=this;this.bookplates=["jellybooks_bookplate.xhtml","jellybooks_bookplate_pineapple_p1.xhtml","jellybooks_bookplate_pineapple_p2.xhtml"],this.initTracking=function(e,t,r,a){return o(i,void 0,void 0,function(){var i,l=this;return s(this,function(c){switch(c.label){case 0:return this.bookElements=t,r&&(this.locale=r),[4,this.checkDataCollection()];case 1:return c.sent(),[4,this.createDeviceId()];case 2:return c.sent(),[4,this.createTracks(e)];case 3:return c.sent(),this.popEvent("trackerLoaded",{deviceId:this.deviceId}),i=new f.Lifecycle,i.addEventListener("statechange",function(e){return o(l,void 0,void 0,function(){var t,i,r,o;return s(this,function(s){switch(s.label){case 0:return t=this.session,(i=this.track,t.id===i&&this.dataCollection)?"active"!==e.newState?[3,2]:(this.session=new n.Session(i,this.heartbeat_rate,this.store,this.epub_id),[4,this.session.startSession(f.TrackerState.Resumed)]):[3,7];case 1:return s.sent(),[3,7];case 2:if("hidden"!==e.newState)return[3,7];s.label=3;case 3:return s.trys.push([3,6,,7]),[4,t.unload(f.TrackerState.Paused)];case 4:return s.sent(),[4,this.createPayload()];case 5:return r=s.sent(),null!==r&&this.postPayload(r),[3,7];case 6:return o=s.sent(),console.log(o),[3,7];case 7:return[2]}})})}),this.bookplatePage&&this.bookplates.push(this.bookplatePage),a&&(a.href=this.appendDeviceId(a.href,!0)),[2]}})})},this.startTracking=function(e){return o(i,void 0,void 0,function(){var t,i,o,a,l,c,u,o,a,l,p;return s(this,function(s){switch(s.label){case 0:if(this.track=r.getFilename(e),!this.shouldBeTracked(this.track,this.tracks))return[3,2];if(this.track===this.buyPage)for(t=0,i=this.bookElements;t<i.length;t++)o=i[t],a="#"+this.buyButton,(l=h.findIframeElement(o.contentDocument,a))&&(l.href=this.appendDeviceId(l.href));else if(-1!==this.bookplates.indexOf(this.track))for(c=0,u=this.bookElements;c<u.length;c++)o=u[c],a="#"+this.bookplateButton,(l=h.findIframeElement(o.contentDocument,a))&&(p=l.querySelector("span")||l,this.dataCollection?p.textContent=d.locales.trackingOff[this.locale]:p.textContent=d.locales.trackingOn[this.locale],l.addEventListener("touchend",this.handleDataCollection.bind(this,p)),l.addEventListener("click",this.handleDataCollection.bind(this,p)));return this.dataCollection?(this.session=new n.Session(this.track,this.heartbeat_rate,this.store,this.epub_id),[4,this.session.startSession(f.TrackerState.Started)]):[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})},this.stopTracking=function(e){return void 0===e&&(e=f.TrackerState.Stopped),o(i,void 0,void 0,function(){var t,n;return s(this,function(i){switch(i.label){case 0:if(!this.dataCollection)return[3,6];i.label=1;case 1:return i.trys.push([1,5,,6]),this.session==undefined?[3,4]:[4,this.session.unload(e)];case 2:return i.sent(),[4,this.createPayload()];case 3:t=i.sent(),null!==t&&this.postPayload(t),i.label=4;case 4:return[3,6];case 5:return n=i.sent(),console.log(n),[3,6];case 6:return[2]}})})},this.handleEvents=function(e){return o(i,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.dataCollection&&this.session!=undefined?[4,this.session.click(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},this.handleProgression=function(e,t,n){return o(i,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return this.dataCollection&&this.session!=undefined?n===undefined?[3,2]:[4,this.session.progress(e,t,n)]:[3,4];case 1:return i.sent(),[3,4];case 2:return[4,this.session.progress(e,t)];case 3:i.sent(),i.label=4;case 4:return[2]}})})},this.handlePreference=function(e,t){return o(i,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return this.dataCollection&&this.session!=undefined?[4,this.session.preference(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})},this.handleShare=function(e,t){return o(i,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return this.dataCollection&&this.session!=undefined?[4,this.session.share(e,t)]:[3,2];case 1:n.sent(),this.makeSyncNow(),n.label=2;case 2:return[2]}})})},this.handleDataCollection=function(t,n){return o(i,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return this.dataCollection?(this.storeTrackerItems(this.epub_id+e.DATA_COLLECTION,JSON.stringify(!1)),this.dataCollection=!1,t.textContent=d.locales.trackingOn[this.locale],this.session?[4,this.session.unload()]:[3,2]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,4];case 3:this.storeTrackerItems(this.epub_id+e.DATA_COLLECTION,JSON.stringify(!0)),this.dataCollection=!0,t.textContent=d.locales.trackingOff[this.locale],i.label=4;case 4:return this.popEvent("trackerUpdate",{dataCollection:this.dataCollection,deviceId:this.deviceId}),n.preventDefault(),n.stopPropagation(),[2]}})})},this.makeSyncNow=function(){return o(i,void 0,void 0,function(){var e,t;return s(this,function(n){switch(n.label){case 0:if(!this.dataCollection||this.session==undefined)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.createPayload()];case 2:return e=n.sent(),null!==e&&this.postPayload(e),[3,4];case 3:return t=n.sent(),console.log(t),[3,4];case 4:return[2]}})})},this.createTracks=function(t){return o(i,void 0,void 0,function(){var n,i,o,a;return s(this,function(s){switch(s.label){case 0:return[4,this.store.get(this.epub_id+e.TRACKS)];case 1:if(n=s.sent())this.tracks=JSON.parse(n);else{for(i=0;i<t.length;i++)o=t[i],o.href&&(a=r.getFilename(o.href),this.tracks.push(a));this.storeTrackerItems(this.epub_id+e.TRACKS,JSON.stringify(this.tracks))}return[2,this.tracks]}})})},this.shouldBeTracked=function(e,t){return t.indexOf(e)>=0},this.store=t.store,this.post_url=t.post_url,this.epub_id=t.epub_id,this.heartbeat_rate=t.heartbeat_rate,this.reader_type=t.reader_type||"cassis-sample",this.version=t.version||"1.0",this.session,this.payload,this.deviceId,this.track,this.tracks=[],this.dataCollection,this.bookElements,this.locale="en",this.bookplatePage=t.bookplatePage,this.bookplateButton=t.bookplateButton||"no-tracking-button",this.buyPage=t.buyPage||"jellybooks_buy.xhtml",this.buyButton=t.buyButton||"jb-buy"}return e.prototype.createDeviceId=function(){return o(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return[4,this.store.get(e.DEVICE_ID)];case 1:return t=n.sent(),t?this.deviceId=t:(this.deviceId=c["default"].v4(),this.storeTrackerItems(e.DEVICE_ID,this.deviceId)),[2,this.deviceId]}})})},e.prototype.checkDataCollection=function(){return o(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return[4,this.store.get(this.epub_id+e.DATA_COLLECTION)];case 1:return t=n.sent(),t?this.dataCollection=JSON.parse(t):(this.dataCollection=!0,this.storeTrackerItems(this.epub_id+e.DATA_COLLECTION,JSON.stringify(!0))),[2,this.dataCollection]}})})},e.prototype.popEvent=function(e,t){var n=new CustomEvent(e,{bubbles:!0,detail:t});document.dispatchEvent(n)},e.prototype.appendDeviceId=function(e,t){return void 0===t&&(t=!1),r.addParamToUrl(e,"s",this.deviceId,t)},e.prototype.createPayload=function(){return o(this,void 0,void 0,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return e=new i.Report(this.tracks,this.store,this.epub_id,this.version,this.track,r.createTimestamp(),this.heartbeat_rate,u.epubReadingSystemObject.name,u.epubReadingSystemObject.version,this.deviceId,this.reader_type),t=this,[4,e.wrapStream()];case 1:return t.payload=n.sent(),[2,this.payload]}})})},e.prototype.postPayload=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,fetch(this.post_url,{method:"POST",body:JSON.stringify(e),mode:"cors",headers:{"Content-Type":"application/json"}})];case 1:return t.sent(),[2]}})})},e.prototype.storeTrackerItems=function(e,t){return o(this,void 0,void 0,function(){return s(this,function(){return[2,this.store.set(e,t)]})})},e.DATA_COLLECTION="data-collection",e.DEVICE_ID="device-id",e.TRACKS="tracks",e}();t["default"]=p}.apply(t,i))!==undefined&&(e.exports=r)},"./src/Tracker/TrackerUtilities.ts":function(e,t,n){var i,r;i=[n,t],(r=function(e,t){"use strict";function n(){var e=function(e){return e<10?"0"+e:e.toString()},t=function(t){var n=t>0?"-":"+";return t=Math.abs(t),n+e(Math.floor(t/60))+":"+e(t%60)};return function(n){return n.getFullYear()+"-"+e(n.getMonth()+1)+"-"+e(n.getDate())+"T"+e(n.getHours())+":"+e(n.getMinutes())+":"+e(n.getSeconds())+t(n.getTimezoneOffset())}(new Date)}function i(e){var t=new URL(e,window.location.href).pathname,n=t.lastIndexOf("/");return-1!==n?t.substring(n+1):t}function r(e){void 0===e&&(e=11);var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";if(window.crypto){var n=new Uint8Array(e);return window.crypto.getRandomValues(n),n=n.map(function(e){return t.charCodeAt(e%t.length)}),String.fromCharCode.apply(null,n)}for(var i="",r=0;r<e;r++)i+=t.charAt(Math.floor(Math.random()*t.length));return i}function o(e,t,n,i){void 0===i&&(i=!1);var r=new URL(e);if(i){if(!(window.location.protocol===r.protocol&&window.location.port===r.port&&window.location.hostname===r.hostname))return e}return r.search.length>0?"?"!==r.search?r.search+="&"+t+"="+n:r.search="?"+t+"="+n:r.search+="?"+t+"="+n,r.href}Object.defineProperty(t,"__esModule",{value:!0}),t.createTimestamp=n,t.getFilename=i,t.generateNonce=r,t.addParamToUrl=o}.apply(t,i))!==undefined&&(e.exports=r)},"./src/app.ts":function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i["throw"](e))}catch(e){o(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(s,a)}l((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(s=2&n[0]?o["return"]:n[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){l.label=n[1];break}if(6===n[0]&&l.label<s[1]){l.label=s[1],s=n;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(n);break}s[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};i=[n,t,n("./src/LocalStorageStore.ts"),n("./src/ReflowNavigator.ts"),n("./src/FXLNavigator.ts"),n("./src/PublisherFont.ts"),n("./src/SerifFont.ts"),n("./src/SansFont.ts"),n("./src/DayTheme.ts"),n("./src/SepiaTheme.ts"),n("./src/NightTheme.ts"),n("./src/ColumnsPaginatedBookView.ts"),n("./src/ScrollingBookView.ts"),n("./src/BookSettings.ts"),n("./src/LocalAnnotator.ts"),n("./src/Tracker/Tracker.ts"),n("./src/BookInfo.ts")],(r=function(e,t,n,i,r,l,c,u,h,d,f,p,g,b,m,v,y){"use strict";var k=this;Object.defineProperty(t,"__esModule",{value:!0}),n=a(n),i=a(i),r=a(r),l=a(l),c=a(c),u=a(u),h=a(h),d=a(d),f=a(f),p=a(p),g=a(g),b=a(b),m=a(m),v=a(v),y=a(y),t.start=function(e){return o(k,void 0,void 0,function(){var t,o,a,k,w,E,S,T,C,I,_,L,x,P,R,B,A,O,F,M,H,D,L;return s(this,function(s){switch(s.label){case 0:return e.startPath&&(t=e.startPath),e.startPage&&(o=e.startPage),a=new n["default"]({prefix:e.manifestUrl.href}),k=new m["default"]({store:a}),e.tracker&&(w=new v["default"]({store:new n["default"]({prefix:e.tracker.prefix}),post_url:e.tracker.post_url,epub_id:e.tracker.epub_id,heartbeat_rate:e.tracker.heartbeat_rate,reader_type:e.tracker.reader_type,version:e.tracker.version})),e.libHandler&&(E=e.libHandler),e.tosLink&&(S=e.tosLink),e.locale&&(T=e.locale),e.bookInfo&&(C=new y["default"]({title:e.bookInfo.title,author:e.bookInfo.author,publisher:e.bookInfo.publisher,isbn13:e.bookInfo.isbn13,genre:e.bookInfo.genre,publication_date_string:e.bookInfo.publication_date_string,buy_link:e.bookInfo.buy_link,buy_link_nav:e.bookInfo.buy_link_nav,buy_links:e.bookInfo.buy_links,share_link:e.bookInfo.share_link}),e.bookInfo.buy_links&&e.bookInfo.buy_links.length>0&&e.retailers&&e.retailers.length>0&&(I=e.retailers)),_=new n["default"]({prefix:"cassis-reader"}),e.rendition&&"fxl"===e.rendition?[4,b["default"].create({store:_,bookFonts:[],fontSizesInPixels:[],bookThemes:[],bookViews:[],retailers:I})]:[3,3];case 1:return L=s.sent(),[4,r["default"].create({element:e.element,manifestUrl:e.manifestUrl,assetsUrl:e.assetsUrl,store:a,settings:L,annotator:k,tracker:w,libHandler:E,tosLink:S,allowFullscreen:!0,locale:T,bookInfo:C,startPage:o,startPath:t})];case 2:return[2,s.sent()];case 3:return x=new l["default"],P=new c["default"],R=new u["default"],B=[12,14,16,18,20,22,24,26,28,30,32],A=16,e.defaultFontSize&&-1!==B.indexOf(e.defaultFontSize)&&(A=e.defaultFontSize),O=new h["default"],F=new d["default"],M=new f["default"],H=new p["default"],D=new g["default"],[4,b["default"].create({store:_,bookFonts:[x,P,R],fontSizesInPixels:B,defaultFontSizeInPixels:A,bookThemes:[O,F,M],bookViews:[H,D],retailers:I})];case 4:return L=s.sent(),[4,i["default"].create({element:e.element,manifestUrl:e.manifestUrl,assetsUrl:e.assetsUrl,store:a,settings:L,annotator:k,publisher:x,serif:P,sans:R,day:O,sepia:F,night:M,paginator:H,scroller:D,tracker:w,libHandler:E,tosLink:S,allowFullscreen:!0,locale:T,bookInfo:C,startPage:o,startPath:t})];case 5:return[2,s.sent()]}})})}}.apply(t,i))!==undefined&&(e.exports=r)},0:function(e,t,n){n("./node_modules/whatwg-fetch/fetch.js"),e.exports=n("./src/app.ts")}});