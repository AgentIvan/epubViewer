<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<title>Narrativas</title>
	<!-- BOOTSTRAP -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<!-- FONTAWESOME -->
	<script src="https://kit.fontawesome.com/d3825ec2ab.js"></script>
	<!-- FONT FEATHER -->
	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
	<!-- GOOGLE FONTS -->
	<link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600,700,800,900&display=swap" rel="stylesheet">
	<!-- ESTILOS BASE -->
	<link rel="stylesheet" href="css/estilos_base.css">
	<!-- ESTILOS -->
	<link rel="stylesheet" href="css/estilos.css">
	<!-- ESTILOS EPUBS -->
	<link rel="stylesheet" type="text/css" href="css/examples.css">
	<link rel="stylesheet" type="text/css" href="css/estilos_ss.css">
</head>
<body class="bgbody2">

	<div class="buttonCircle d-flex justify-content-center align-items-center pTopLeft">
		<i data-feather="chevron-left" class="fa"></i>
	</div>

	<div class="container-fluid p-0">

		<div class="header p-3 pb-1 ">
			<div class="row no-gutters">
				<div class="col-md-6 pb-3">
					<div class="caractBook text-md-left text-sm-center text-center">
						<!--h2 class="titleBookName ellipsis">Pucuy y Kitan: La batalla contra Smog.</h2-->
						<h2 class="titleBookName ellipsis">Lolin y los chuches mágicos.</h2>
						<h3 class="titleBookChapter ellipsis">Aventura 1. El secreto de Smog.</h3>
					</div>
				</div>

				<div class="toolsContainer col-md-6 pb-3 d-flex flex-row justify-content-center justify-content-md-end justify-content-sm-center
 align-items-center flex-wrap">
					<div class="setTool"><img class="tool" src="images/tool1.png" alt=""></div>
					<div class="setTool"><img class="tool" src="images/tool2.png" alt=""></div>
					<div class="setTool"><img class="tool" src="images/tool3.png" alt=""></div>
					<div class="setTool"><img class="tool" src="images/tool4.png" alt=""></div>
				</div>
			</div>

			

		</div>

		<div class="row position-relative no-gutters">
			<div class="col-md-12 p-3 d-flex flex-column flex-wrap justify-content-center align-items-center ">

				<div class="container">
					<div class="row">

						<div class="col-md-12  d-flex flex-column justify-content-center align-items-center ">
								<select id="toc"></select>
								<div id="viewer" class="pageContent spreads"></div>

							  <!-- <div id="viewer" class="spreads"></div> -->
							  <a id="prev" href="#prev" class="arrow">‹</a>
							  <a id="next" href="#next" class="arrow">›</a>
							
						</div>
						
					</div>

					<div class="row">
						<div class="col-md-12  d-flex flex-column justify-content-center align-items-center ">
							<input type="range" min="1" max="100" step="1" value="0" class="rangebar">
						</div>
					</div>
				</div>
				
				
			</div>
		</div>

		<div class="row">
			<div class="col-md-12 p-2">
				<div id="controls">
					<input id="current-percent" size="3" value="0" /> %
				</div>
			</div>
		</div>
		
	</div>
	

	<!-- BOOTSTRAP -->
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	<!-- FONT FEATHER -->
	<script>
      feather.replace()
    </script>
    <!-- COLUMNIZER -->
    <script src="js/jquery.columnizer.js"></script>
    <!-- CODE -->
    <script src="js/code_base.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>
    <!--script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script-->
    <script src="js/epub.js"></script>

	<script>
	  // var book = ePub("epubs/alice.epub");
	  // var rendition = book.renderTo("pageContent");
	  // rendition.display();

	 //  	var $viewer = $(".pageContent");

	 //    var book = ePub("epubs/alice.epub");
	    
	 //    // var book = ePub("url/to/book/package.opf");
		//   var rendition = book.renderTo("area", {
		//   	width: "100%", 
		//   	height: 400,
		//    spread: "always"
		// });
		//   var displayed = rendition.display();

	var params = URLSearchParams && new URLSearchParams(document.location.search.substring(1));
    var url = params && params.get("url") && decodeURIComponent(params.get("url"));
    var currentSectionIndex = (params && params.get("loc")) ? params.get("loc") : undefined;

    // Load the opf
    var book = ePub(url || "epubs/wm5_adjust.epub");
    var rendition = book.renderTo("viewer", {
      width: "100%",
      height: 600,
      
    });

    rendition.display(currentSectionIndex);

    book.ready.then(function() {

      var next = document.getElementById("next");

      next.addEventListener("click", function(e){
        book.package.metadata.direction === "rtl" ? rendition.prev() : rendition.next();
        e.preventDefault();
      }, false);

      var prev = document.getElementById("prev");
      prev.addEventListener("click", function(e){
        book.package.metadata.direction === "rtl" ? rendition.next() : rendition.prev();
        e.preventDefault();
      }, false);

      var keyListener = function(e){

        // Left Key
        if ((e.keyCode || e.which) == 37) {
          book.package.metadata.direction === "rtl" ? rendition.next() : rendition.prev();
        }

        // Right Key
        if ((e.keyCode || e.which) == 39) {
          book.package.metadata.direction === "rtl" ? rendition.prev() : rendition.next();
        }

      };

      rendition.on("keyup", keyListener);
      document.addEventListener("keyup", keyListener, false);

    })

    book.generatePagination().then(function () {
	    console.log("The pagination has been generated");
	});

    var title = document.getElementById("title");

    rendition.on("rendered", function(section){
      var current = book.navigation && book.navigation.get(section.href);

      if (current) {
        var $select = document.getElementById("toc");
        var $selected = $select.querySelector("option[selected]");
        if ($selected) {
          $selected.removeAttribute("selected");
        }

        var $options = $select.querySelectorAll("option");
        for (var i = 0; i < $options.length; ++i) {
          let selected = $options[i].getAttribute("ref") === current.href;
          if (selected) {
            $options[i].setAttribute("selected", "");
          }
        }
      }

    });

    rendition.on("relocated", function(location){
      console.log(location);
      //console.log(location.start.displayed.page);
      $(".rangebar").attr("max", location.start.displayed.total - 1);
      $(".rangebar").attr("value", location.end.displayed.page - 1);
      relocateBar( $(".rangebar").eq(0) );

      var next = book.package.metadata.direction === "rtl" ?  document.getElementById("prev") : document.getElementById("next");
      var prev = book.package.metadata.direction === "rtl" ?  document.getElementById("next") : document.getElementById("prev");

      if (location.atEnd) {
        next.style.visibility = "hidden";
      } else {
        next.style.visibility = "visible";
      }

      if (location.atStart) {
        prev.style.visibility = "hidden";
      } else {
        prev.style.visibility = "visible";
      }

    });

    rendition.on("layout", function(layout) {
      let viewer = document.getElementById("viewer");

      if (layout.spread) {
        viewer.classList.remove('single');
      } else {
        viewer.classList.add('single');
      }
    });

    window.addEventListener("unload", function () {
      console.log("unloading");
      this.book.destroy();
    });

    book.loaded.navigation.then(function(toc){
			var $select = document.getElementById("toc"),
					docfrag = document.createDocumentFragment();

			toc.forEach(function(chapter) {
				var option = document.createElement("option");
				option.textContent = chapter.label;
				option.setAttribute("ref", chapter.href);

				docfrag.appendChild(option);
			});

			$select.appendChild(docfrag);

			$select.onchange = function(){
					var index = $select.selectedIndex,
							url = $select.options[index].getAttribute("ref");
					rendition.display(url);
					return false;
			};


			

		});





	</script>

	<script src="js/read.js"></script>

    <!-- <script>
		$(function(){
			// $('h1').addClass("dontend");
			$('.pageA').columnize({
				width:180,
				lastNeverTallest: true 
			});

			$('.pageB').columnize({
				width:180,
				lastNeverTallest: true 
			});
			// $('.thin').columnize({
			// 	width:180
			// });
		});
	</script> -->

</body>
</html>